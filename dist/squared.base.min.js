!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e=e||self).squared=e.squared||{},e.squared.base={}))}(this,function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){this.wrapped=e}function i(e){var t,i;function r(t,i){try{var a=e[t](i),h=a.value,c=h instanceof n;Promise.resolve(c?h.wrapped:h).then(function(e){c?r("next",e):s(a.done?"return":"normal",e)},function(e){r("throw",e)})}catch(e){s("throw",e)}}function s(e,n){switch(e){case"return":t.resolve({value:n,done:!0});break;case"throw":t.reject(n);break;default:t.resolve({value:n,done:!1})}(t=t.next)?r(t.key,t.arg):i=null}this._invoke=function(e,n){return new Promise(function(s,a){var h={key:e,arg:n,resolve:s,reject:a,next:null};i?i=i.next=h:(t=i=h,r(e,n))})},"function"!=typeof e.return&&(this.return=void 0)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}function g(e,t,n){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=f(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}"function"==typeof Symbol&&Symbol.asyncIterator&&(i.prototype[Symbol.asyncIterator]=function(){return this}),i.prototype.next=function(e){return this._invoke("next",e)},i.prototype.throw=function(e){return this._invoke("throw",e)},i.prototype.return=function(e){return this._invoke("return",e)};function d(e,t){return p(e)||function(e,t){var n=[],i=!0,r=!1,s=void 0;try{for(var a,h=e[Symbol.iterator]();!(i=(a=h.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==h.return||h.return()}finally{if(r)throw s}}return n}(e,t)||k()}function v(e){return function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function p(e){if(Array.isArray(e))return e}function y(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function k(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var b,S,A;!function(e){e[e.NONE=0]="NONE",e[e.DOM_TRAVERSE=2]="DOM_TRAVERSE",e[e.EXTENSION=4]="EXTENSION",e[e.RENDER=8]="RENDER",e[e.ALL=14]="ALL"}(b||(b={})),function(e){e[e.NONE=0]="NONE",e[e.BOX_STYLE=2]="BOX_STYLE",e[e.BOX_SPACING=4]="BOX_SPACING",e[e.FONT_STYLE=8]="FONT_STYLE",e[e.VALUE_STRING=16]="VALUE_STRING",e[e.IMAGE_SOURCE=32]="IMAGE_SOURCE",e[e.ASSET=56]="ASSET",e[e.ALL=126]="ALL"}(S||(S={})),function(e){e[e.NONE=0]="NONE",e[e.CONSTRAINT=2]="CONSTRAINT",e[e.LAYOUT=4]="LAYOUT",e[e.ALIGNMENT=8]="ALIGNMENT",e[e.AUTOFIT=16]="AUTOFIT",e[e.OPTIMIZATION=32]="OPTIMIZATION",e[e.CUSTOMIZATION=64]="CUSTOMIZATION",e[e.ACCESSIBILITY=128]="ACCESSIBILITY",e[e.LOCALIZATION=256]="LOCALIZATION",e[e.POSITIONAL=46]="POSITIONAL",e[e.NONPOSITIONAL=464]="NONPOSITIONAL",e[e.ALL=510]="ALL"}(A||(A={}));var w=Object.freeze({get APP_SECTION(){return b},get NODE_RESOURCE(){return S},get NODE_PROCEDURE(){return A}}),T=squared.lib.dom,E=squared.lib.util,B=function(e){function t(e){var n;return r(this,t),(n=u(this,l(t).call(this,e)))._currentId=0,n}return c(t,squared.lib.base.Container),a(t,[{key:"append",value:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return g(l(t.prototype),"append",this).call(this,e),n&&this.afterAppend&&this.afterAppend.call(this,e),this}},{key:"reset",value:function(){return this._currentId=0,this.clear(),this}},{key:"visible",get:function(){return this.children.filter(function(e){return e.visible})}},{key:"elements",get:function(){return this.children.filter(function(e){return e.visible&&e.styleElement})}},{key:"nextId",get:function(){return++this._currentId}}],[{key:"actualParent",value:function(e){for(var t=Array.isArray(i=e),n=0,i=t?i:i[Symbol.iterator]();;){var r;if(t){if(n>=i.length)break;r=i[n++]}else{if((n=i.next()).done)break;r=n.value}if(r.naturalElement&&r.actualParent)return r.actualParent}}},{key:"baseline",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.filter(function(e){if(e.baseline||E.isUnit(e.verticalAlign)&&"0px"!==e.verticalAlign){var t=e.cssInitial("position");return"absolute"!==t&&"fixed"!==t}return!1});n.length&&(e=n),n=e.filter(function(e){return e.textElement||"text-top"!==e.verticalAlign&&"text-bottom"!==e.verticalAlign}),n.length&&(e=n),t&&(e=e.filter(function(e){return e.baseElement&&!e.imageElement}));var i=E.maxArray(e.map(function(e){return e.lineHeight})),r=E.maxArray(e.map(function(e){return e.bounds.height}));return e.filter(function(e){return i>r?e.lineHeight===i:e.bounds.height===r}).sort(function(e,t){if(e.groupParent||e.length>0||!e.baseline&&t.baseline)return 1;if(t.groupParent||t.length>0||e.baseline&&!t.baseline)return-1;if(!e.imageElement||!t.imageElement){if(e.multiLine||t.multiLine){if(e.lineHeight&&t.lineHeight)return e.lineHeight<=t.lineHeight?1:-1;if(e.fontSize===t.fontSize)return e.htmlElement||!t.htmlElement?-1:1}if(e.containerType!==t.containerType)return e.textElement||e.imageElement?-1:t.textElement||t.imageElement?1:e.containerType<t.containerType?-1:1;if(t.imageElement)return-1;if(e.imageElement)return 1;if(e.fontSize===t.fontSize)return e.htmlElement&&!t.htmlElement?-1:!e.htmlElement&&t.htmlElement?1:e.siblingIndex>=t.siblingIndex?1:-1;if(e.fontSize!==t.fontSize&&e.fontSize>0&&t.fontSize>0)return e.fontSize>t.fontSize?-1:1}return 0})}},{key:"floated",value:function(e){return new Set(e.map(function(e){return e.float}).filter(function(e){return"none"!==e}))}},{key:"cleared",value:function(e){if((!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&e.length>1){e.slice().sort(this.siblingIndex);var t=this.actualParent(e);if(t){for(var n=[],i=e[e.length-1],r=!1,s=0;s<t.element.childNodes.length;s++){var a=T.getElementAsNode(t.element.childNodes[s]);if(a&&(a===e[0]&&(r=!0),r&&n.push(a),a===i))break}n.length>=e.length&&(e=n)}}for(var h=new Map,c=new Set,l={left:null,right:null},o=function(){if(u){if(f>=g.length)return"break";d=g[f++]}else{if((f=g.next()).done)return"break";d=f.value}var e=d;if(e.pageFlow){var t=e.css("clear");if(c.size)("both"===t?[l.left,l.right]:"left"===t?[l.left,null]:"right"===t?[null,l.right]:[]).forEach(function(t){t&&!e.floating&&e.linear.top>t.linear.bottom&&c.has(t.float)&&(c.delete(t.float),l[t.float]=null)}),"both"===t?(h.set(e,2===c.size?"both":c.values().next().value),c.clear(),l.left=null,l.right=null):c.has(t)&&(h.set(e,t),c.delete(t),l[t]=null);e.floating&&(c.add(e.float),l[e.float]=e)}},u=Array.isArray(g=e),f=0,g=u?g:g[Symbol.iterator]();;){var d;if("break"===o())break}return h}},{key:"floatedAll",value:function(e){return this.floated(e.actualChildren.filter(function(e){return e.pageFlow}))}},{key:"clearedAll",value:function(e){return this.cleared(e.actualChildren.filter(function(e){return e.pageFlow}),!1)}},{key:"linearX",value:function(e){var n=e.filter(function(e){return e.pageFlow}).sort(t.siblingIndex);switch(n.length){case 0:return!1;case 1:return!0;default:var i=this.actualParent(n);if(i){for(var r=this.clearedAll(i),s=1;s<n.length;s++)if(n[s].alignedVertically(n[s].previousSiblings(),void 0,r))return!1;for(var a=E.minArray(n.map(function(e){return e.linear.left})),h=E.maxArray(n.map(function(e){return e.linear.right})),c=E.maxArray(n.filter(function(e){return"left"===e.float}).map(function(e){return e.linear.right})),l=E.minArray(n.filter(function(e){return"right"===e.float}).map(function(e){return e.linear.left})),o=0,u=0,f=0,g=0,d=0;o<n.length;o++){var v=n[o];if(Math.floor(v.linear.left)<=a&&u++,Math.ceil(v.linear.right)>=h&&f++,v.floating||(v.linear.left===c&&g++,v.linear.right===l&&d++),0!==o){if(2===u||2===f||2===g||2===d)return!1;var p=n[o-1];if(p.floating&&v.linear.top>=p.linear.bottom||E.withinFraction(v.linear.left,p.linear.left))return!1}}return!0}return!1}}},{key:"linearY",value:function(e){var n=e.filter(function(e){return e.pageFlow}).sort(t.siblingIndex);switch(n.length){case 0:return!1;case 1:return!0;default:var i=this.actualParent(n);if(i){for(var r=this.clearedAll(i),s=1;s<n.length;s++)if(!n[s].alignedVertically(n[s].previousSiblings(),n,r))return!1;return!0}return!1}}},{key:"partitionRows",value:function(e){for(var t,n=this,i=d((t=n.actualParent(e))?[t.actualChildren,n.clearedAll(t)]:[e,n.cleared(e)],2),r=i[0],s=i[1],a=[],h=[],c=0;c<r.length;c++){var l=r[c],o=l.previousSiblings();0===c||0===o.length?e.includes(l)&&h.push(l):l.alignedVertically(o,h,s)?(h.length&&a.push(h),h=e.includes(l)?[l]:[]):e.includes(l)&&h.push(l),c===r.length-1&&h.length&&a.push(h)}return a}},{key:"siblingIndex",value:function(e,t){return e.siblingIndex>=t.siblingIndex?1:-1}}]),t}(),R=squared.lib.util,x=function(e){function t(e,n){var i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,c=arguments.length>5?arguments[5]:void 0;return r(this,t),(i=u(this,l(t).call(this,c))).parent=e,i.node=n,i.containerType=s,i.alignmentType=a,i.itemCount=h,i.rowCount=0,i.columnCount=0,i.renderType=0,i.renderPosition=!1,i}return c(t,squared.lib.base.Container),a(t,[{key:"init",value:function(){this.floated=this.getFloated(),this.cleared=this.getCleared(),this.linearX=this.isLinearX()}},{key:"initParent",value:function(){this.floated=this.getFloated(!0),this.cleared=this.getCleared(!0),this.linearX=this.isLinearX()}},{key:"setType",value:function(e){this.containerType=e;for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0;r<n.length;r++){this.add(n[r])}}},{key:"add",value:function(e){return this.alignmentType|=e,this.alignmentType}},{key:"retain",value:function(e){return g(l(t.prototype),"retain",this).call(this,e),this.itemCount=e.length,this}},{key:"delete",value:function(e){return R.hasBit(this.alignmentType,e)&&(this.alignmentType^=e),this.alignmentType}},{key:"getFloated",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?B.floatedAll(this.parent):B.floated(this.children)}},{key:"getCleared",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?B.clearedAll(this.parent):B.cleared(this.children)}},{key:"isLinearX",value:function(){return B.linearX(this.children)}},{key:"isLinearY",value:function(){return B.linearY(this.children)}},{key:"floated",set:function(e){e.size?this.add(64):this.delete(64),this.every(function(e){return"right"===e.float})?this.add(512):this.delete(512),this._floated=e},get:function(){return this._floated||this.getFloated()}},{key:"cleared",set:function(e){this._cleared=e},get:function(){return this._cleared||this.getCleared()}},{key:"visible",get:function(){return this.children.filter(function(e){return e.visible})}},{key:"linearX",set:function(e){this._linearX=e},get:function(){return this._linearX||this.isLinearX()}},{key:"linearY",set:function(e){this._linearY=e},get:function(){return this._linearY||this.isLinearY()}}]),t}(),I=squared.lib.color,C=squared.lib.dom,L=squared.lib.util,H=squared.lib.xml,P=function(){function e(t,n){r(this,e),this.application=t,this.cache=n}return a(e,[{key:"finalize",value:function(e){}},{key:"reset",value:function(){for(var t in e.ASSETS)e.ASSETS[t]=new Map;for(var n in e.STORED)e.STORED[n]=new Map;this.fileHandler&&this.fileHandler.reset()}},{key:"setBoxStyle",value:function(){for(var t=Array.isArray(i=this.cache.elements),n=0,i=t?i:i[Symbol.iterator]();;){var r;if(t){if(n>=i.length)break;r=i[n++]}else{if((n=i.next()).done)break;r=n.value}var s=r,a={background:null,borderTop:null,borderRight:null,borderBottom:null,borderLeft:null,borderRadius:null,backgroundColor:null,backgroundSize:null,backgroundImage:null,backgroundRepeat:null,backgroundPositionX:null,backgroundPositionY:null};for(var h in a){var c=s.css(h);switch(h){case"borderTop":case"borderRight":case"borderBottom":case"borderLeft":var l=s.css("".concat(h,"Color"));switch(l.toLowerCase()){case"initial":l="#000000";break;case"inherit":case"currentcolor":l=C.cssInherit(s.element,"".concat(h,"Color"))}var o=s.css("".concat(h,"Width"))||"1px",u=s.css("".concat(h,"Style"))||"none";"inset"===u&&"0px"===o&&(o="1px");var f=I.parseRGBA(l,s.css("opacity"));a[h]={width:o,style:u,color:"none"!==u&&f?f.valueRGBA:""};break;case"borderRadius":var g=[s.css("borderTopLeftRadius"),s.css("borderTopRightRadius"),s.css("borderBottomLeftRadius"),s.css("borderBottomRightRadius")],d=g[0],v=g[1],p=g[2],y=g[3];a.borderRadius=d===v&&v===p&&p===y?0===L.convertInt(d)?void 0:[d]:[d,v,p,y];break;case"backgroundColor":if(!s.has("backgroundColor")&&(c===s.cssParent("backgroundColor",!1,!0)||s.documentParent.visible&&C.cssFromParent(s.element,"backgroundColor")))a.backgroundColor="";else{var k=I.parseRGBA(c,s.css("opacity"));a.backgroundColor=k?k.valueRGBA:""}break;case"background":case"backgroundImage":"none"===c||s.hasBit("excludeResource",S.IMAGE_SOURCE)||function(){for(var e=function(e){return"".concat(e?"":"(?:",",?\\s*(").concat(e?"":"?:","rgba?\\(\\d+, \\d+, \\d+(?:, [\\d.]+)?\\)|[a-z]+)\\s*(").concat(e?"":"?:","\\d+%)?").concat(e?"":")")},t=[],n=RegExp("([a-z-]+)-gradient\\(([\\w\\s%]+)?(".concat(e(!1),"+)\\)"),"g"),i=void 0;null!==(i=n.exec(c));){var r=void 0;"linear"===i[1]?(/^to/.test(i[2])||/deg$/.test(i[2])||(i[3]=i[2]+i[3],i[2]="180deg"),r={type:"linear",angle:function(){switch(i[2]){case"to top":return 0;case"to right top":return 45;case"to right":return 90;case"to right bottom":return 135;case"to bottom":return 180;case"to left bottom":return 225;case"to left":return 270;case"to left top":return 315;default:return L.convertInt(i[2])}}(),colorStop:[]}):r={type:"radial",shapePosition:function(){var e=["ellipse","center"];if(i[2]){var t=i[2].split("at").map(function(e){return e.trim()});switch(t[0]){case"ellipse":case"circle":case"closest-side":case"closest-corner":case"farthest-side":case"farthest-corner":e[0]=t[0];break;default:e[1]=t[0]}t[1]&&(e[1]=t[1])}return e}(),colorStop:[]};for(var h=i[3].trim().split(RegExp(e(!0),"g")),l=s.css("opacity"),o=0;o<h.length;o+=3){var u=h[o+1];if(u){var f=I.parseRGBA(u,l);f&&f.visible&&r.colorStop.push({color:f.valueRGBA,offset:h[o+2]||"0%",opacity:f.alpha})}}r.colorStop.length>1&&t.push(r)}if(t.length)a.backgroundGradient=t;else{var g=[];for(n=RegExp(L.REGEX_PATTERN.CSS_URL,"g"),i=null;null!==(i=n.exec(c));)i&&g.push(i[0]);g.length&&(a.backgroundImage=g)}}();break;case"backgroundSize":case"backgroundRepeat":case"backgroundPositionX":case"backgroundPositionY":a[h]=c}}var b=JSON.stringify(a.borderTop);b===JSON.stringify(a.borderRight)&&b===JSON.stringify(a.borderBottom)&&b===JSON.stringify(a.borderLeft)&&(a.border=a.borderTop),s.data(e.KEY_NAME,"boxStyle",a)}}},{key:"setFontStyle",value:function(){for(var t=Array.isArray(i=this.cache),n=0,i=t?i:i[Symbol.iterator]();;){var r;if(t){if(n>=i.length)break;r=i[n++]}else{if((n=i.next()).done)break;r=n.value}var s=r,a=e.hasDrawableBackground(s.data(e.KEY_NAME,"boxStyle"));if(!(s.renderChildren.length||void 0===s.baseElement||s.imageElement||s.svgElement||"HR"===s.tagName||s.inlineText&&!a&&!s.preserveWhiteSpace&&""===s.element.innerHTML.trim())){var h=s.css("opacity"),c=I.parseRGBA(s.css("color"),h),l=void 0;l=a||s.cssParent("backgroundColor",!1,!0)===s.css("backgroundColor")&&(s.plainText||s.style.backgroundColor!==s.cssInitial("backgroundColor"))||!s.has("backgroundColor")&&s.documentParent.visible&&C.cssFromParent(s.element,"backgroundColor")?null:I.parseRGBA(s.css("backgroundColor"),h);var o=s.css("fontFamily"),u=s.css("fontSize"),f=s.css("fontWeight");if(C.isUserAgent(8)&&!s.has("fontFamily"))switch(s.tagName){case"TT":case"CODE":case"KBD":case"SAMP":o="monospace"}if(0===L.convertInt(u))switch(u){case"xx-small":u="8px";break;case"x-small":u="10px";break;case"small":u="13px";break;case"medium":u="16px";break;case"large":u="18px";break;case"x-large":u="24px";break;case"xx-large":u="32px"}if(!L.isNumber(f))switch(f){case"lighter":f="200";break;case"bold":f="700";break;case"bolder":f="900";break;default:f="400"}var g={fontFamily:o,fontStyle:s.css("fontStyle"),fontSize:u,fontWeight:f,color:c?c.valueRGBA:"",backgroundColor:l?l.valueRGBA:""};s.data(e.KEY_NAME,"fontStyle",g)}}}},{key:"setValueString",value:function(){function t(e,t){var n=e.renderParent;switch(e.multiLine&&n&&!n.layoutVertical&&(t=t.replace(/^\s*\n/,"")),e.css("whiteSpace")){case"nowrap":t=t.replace(/\n/g," ");break;case"pre":case"pre-wrap":n&&!n.layoutVertical&&(t=t.replace(/^\n/,"")),t=(t=t.replace(/\n/g,"\\n")).replace(/\s/g,"&#160;");break;case"pre-line":t=(t=t.replace(/\n/g,"\\n")).replace(/\s+/g," ");break;default:var i=e.baseElement;return i&&(i.previousSibling&&C.isLineBreak(i.previousSibling)&&(t=t.replace(/^\s+/,"")),i.nextSibling&&C.isLineBreak(i.nextSibling)&&(t=t.replace(/\s+$/,""))),[t,!1]}return[t,!0]}for(var n=Array.isArray(r=this.cache.visible),i=0,r=n?r:r[Symbol.iterator]();;){var s;if(n){if(i>=r.length)break;s=r[i++]}else{if((i=r.next()).done)break;s=i.value}var a=s,h=a.baseElement;if(h){var c="",l="",o=!1,u=!0;if(h instanceof HTMLInputElement)switch(h.type){case"text":case"number":case"email":case"search":case"submit":case"reset":case"button":l=h.value.trim();break;default:a.companion&&!a.companion.visible&&(l=a.companion.textContent.trim())}else if(h instanceof HTMLTextAreaElement)l=h.value.trim();else if(h instanceof HTMLElement)if("BUTTON"===h.tagName)l=h.innerText;else if(a.inlineText){c=a.textContent.trim();var f=d(t(a,l="CODE"===h.tagName?H.replaceEntity(h.innerHTML):C.hasLineBreak(h,!0)?(l=(l=H.replaceEntity(h.innerHTML)).replace(/\s*<br[^>]*>\s*/g,"\\n")).replace(/(<([^>]+)>)/gi,""):H.replaceEntity(a.textContent)),2);l=f[0],o=f[1]}else""===h.innerText.trim()&&e.hasDrawableBackground(a.data(e.KEY_NAME,"boxStyle"))&&(l=H.replaceEntity(h.innerText),u=!1);else if(a.plainText){c=a.textContent.trim();var g=d(t(a,l=(l=H.replaceEntity(a.textContent)).replace(/&[A-Za-z]+;/g,function(e){return e.replace("&","&amp;")})),2);l=g[0],o=g[1]}if(""!==l){if(u){var v=a.previousSiblings().pop(),p=a.nextSiblings().shift(),y=!1;if(void 0===v||v.multiLine||v.lineBreak||v.plainText&&/\s+$/.test(v.textContent)?l=l.replace(/^\s+/,""):v.baseElement&&(y=/\s+$/.test(v.baseElement.innerText||v.textContent)),o){var k=l;l=l.trim(),!v||v.block||v.lineBreak||y||!/^\s+/.test(k)||(l="&#160;"+l),p&&!p.lineBreak&&/\s+$/.test(k)&&(l+="&#160;")}else/^\s+$/.test(l)?l.length&&(l="&#160;"+l.substring(1)):l=(l=l.replace(/^\s+/,v&&(v.block||v.lineBreak||y&&v.htmlElement&&v.textContent.length>1||a.multiLine&&C.hasLineBreak(h))?"":"&#160;")).replace(/\s+$/,"table-cell"===a.display||p&&p.lineBreak||a.blockStatic?"":"&#160;")}""!==l&&a.data(e.KEY_NAME,"valueString",{name:c,value:l})}}}}},{key:"stored",get:function(){return e.STORED}}],[{key:"generateId",value:function(e,t,n){var i=t,r=n;1===n&&(t+="_".concat(""+r));for(var s=this.ASSETS.ids.get(e)||[];;){if(!s.includes(t)){s.push(t);break}t="".concat(i,"_").concat(""+ ++r)}return this.ASSETS.ids.set(e,s),t}},{key:"getStoredName",value:function(t,n){var i=e.STORED[t].entries(),r=Array.isArray(i),s=0;for(i=r?i:i[Symbol.iterator]();;){var a;if(r){if(s>=i.length)break;a=i[s++]}else{if((s=i.next()).done)break;a=s.value}var h=d(a,2),c=h[0],l=h[1];if(JSON.stringify(n)===JSON.stringify(l))return c}return""}},{key:"insertStoredAsset",value:function(t,n,i){var r=e.STORED[t];if(r){var s=this.getStoredName(t,i);if(""===s&&((L.isNumber(n)||/^\d/.test(n))&&(n="__".concat(n)),L.hasValue(i))){var a=0;do{s=n,a>0&&(s+="_".concat(a)),r.has(s)||r.set(s,i),a++}while(r.has(s)&&r.get(s)!==i)}return s}return""}},{key:"isBorderVisible",value:function(e){return!!e&&!("none"===e.style||"0px"===e.width||""===e.color||9===e.color.length&&e.color.endsWith("00"))}},{key:"hasDrawableBackground",value:function(e){return!!e&&(this.isBorderVisible(e.borderTop)||this.isBorderVisible(e.borderRight)||this.isBorderVisible(e.borderBottom)||this.isBorderVisible(e.borderLeft)||!!e.backgroundImage||!!e.borderRadius||!!e.backgroundGradient)}}]),e}();P.KEY_NAME="squared.resource",P.ASSETS={ids:new Map,images:new Map},P.STORED={strings:new Map,arrays:new Map,fonts:new Map,colors:new Map,styles:new Map,dimens:new Map,drawables:new Map,images:new Map};var O=squared.lib.dom,D=squared.lib.util,V=squared.lib.xml;function q(e,t,n){var i=[],r=t;do{r.dataset.use&&i.push.apply(i,v(r.dataset.use.split(",").map(function(e){return e.trim()}))),r=r!==e?r.parentElement:null}while(r);if(i.length){for(var s=[],a=[],h=Array.isArray(l=n),c=0,l=h?l:l[Symbol.iterator]();;){var o;if(h){if(c>=l.length)break;o=l[c++]}else{if((c=l.next()).done)break;o=c.value}var u=o,f=i.indexOf(u.name);-1!==f?s[f]=u:a.push(u)}return[].concat(v(s.filter(function(e){return e})),a)}return n}function W(e,t){var n=e.previousSiblings(),i=e.nextSiblings();return!(!e.positionAuto||0!==n.length&&n.some(function(e){return e.multiLine>0||e.excluded&&!e.blockStatic})||0!==i.length&&!i.every(function(e){return e.blockStatic||e.lineBreak||e.excluded})&&e.element!==O.getLastChildElement(t.element))&&(e.css({position:"static",display:"inline-block",verticalAlign:"top"},"",!0),!0)}var F=function(){function e(t,n,i,s,a){r(this,e),this.framework=t,this.nodeConstructor=a,this.initialized=!1,this.closed=!1,this.builtInExtensions={},this.extensions=new Set,this.parseElements=new Set,this.session={cache:new B,image:new Map,renderQueue:new Map,excluded:new B},this.processing={cache:new B,depthMap:new Map,node:null,layout:null,excluded:new B},this._renderPosition=new Map,this._views=[],this._includes=[],this.controllerHandler=new n(this,this.processing.cache),this.resourceHandler=new i(this,this.processing.cache),this.extensionManager=new s(this,this.processing.cache)}return a(e,[{key:"registerController",value:function(e){e.application=this,e.cache=this.processing.cache,this.controllerHandler=e}},{key:"registerResource",value:function(e){e.application=this,e.cache=this.processing.cache,this.resourceHandler=e}},{key:"finalize",value:function(){for(var e=this.rendered,t=Array.isArray(i=e),n=0,i=t?i:i[Symbol.iterator]();;){var r;if(t){if(n>=i.length)break;r=i[n++]}else{if((n=i.next()).done)break;r=n.value}var s=r;s.hasBit("excludeProcedure",A.LAYOUT)||s.setLayout(),s.hasBit("excludeProcedure",A.ALIGNMENT)||s.setAlignment()}for(var a=Array.isArray(c=e),h=0,c=a?c:c[Symbol.iterator]();;){var l;if(a){if(h>=c.length)break;l=c[h++]}else{if((h=c.next()).done)break;l=h.value}var o=l;o.hasBit("excludeProcedure",A.OPTIMIZATION)||o.applyOptimizations(),o.hasBit("excludeProcedure",A.CUSTOMIZATION)||o.applyCustomizations()}for(var u=Array.isArray(g=this.extensions),f=0,g=u?g:g[Symbol.iterator]();;){var d;if(u){if(f>=g.length)break;d=g[f++]}else{if((f=g.next()).done)break;d=f.value}for(var v=d,p=Array.isArray(k=v.subscribers),y=0,k=p?k:k[Symbol.iterator]();;){var b;if(p){if(y>=k.length)break;b=k[y++]}else{if((y=k.next()).done)break;b=y.value}v.postProcedure(b)}}for(var w=Array.isArray(E=this.rendered),T=0,E=w?E:E[Symbol.iterator]();;){var B;if(w){if(T>=E.length)break;B=E[T++]}else{if((T=E.next()).done)break;B=T.value}var R=B;R.hasBit("excludeResource",S.BOX_SPACING)||R.setBoxSpacing()}for(var x=Array.isArray(C=this.extensions),I=0,C=x?C:C[Symbol.iterator]();;){var L;if(x){if(I>=C.length)break;L=C[I++]}else{if((I=C.next()).done)break;L=I.value}L.afterProcedure()}this.processRenderQueue(),this.resourceHandler.finalize(this.sessionData),this.controllerHandler.finalize(this.sessionData);for(var H=Array.isArray(D=this.extensions),P=0,D=H?D:D[Symbol.iterator]();;){var V;if(H){if(P>=D.length)break;V=D[P++]}else{if((P=D.next()).done)break;V=P.value}V.afterFinalize()}O.removeElementsByClassName("__css.placeholder"),this.closed=!0}},{key:"saveAllToDisk",value:function(){this.resourceHandler.fileHandler&&this.resourceHandler.fileHandler.saveAllToDisk(this.sessionData)}},{key:"reset",value:function(){this.session.cache.each(function(e){return e.baseElement&&O.deleteElementCache(e.baseElement,"node","style","styleMap")});for(var e=Array.isArray(n=this.parseElements),t=0,n=e?n:n[Symbol.iterator]();;){var i;if(e){if(t>=n.length)break;i=n[t++]}else{if((t=n.next()).done)break;i=t.value}var r=i;delete r.dataset.iteration,delete r.dataset.layoutName}this.appName="",this.session.renderQueue.clear(),this.session.image.clear(),this.session.cache.reset(),this.session.excluded.reset(),this.processing.cache.reset(),this.controllerHandler.reset(),this.resourceHandler.reset(),this._views.length=0,this._includes.length=0,this._renderPosition.clear();for(var s=Array.isArray(h=this.extensions),a=0,h=s?h:h[Symbol.iterator]();;){var c;if(s){if(a>=h.length)break;c=h[a++]}else{if((a=h.next()).done)break;c=a.value}var l=c;l.subscribers.clear(),l.subscribersChild.clear()}this.closed=!1}},{key:"parseDocument",value:function(){var e,t=this;this.parseElements.clear(),this.initialized=!1,this.setStyleMap();for(var n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];""===this.appName&&0===i.length&&i.push(document.body);for(var s=0;s<i.length;s++){var a=i[s],h="string"==typeof a?document.getElementById(a):a;O.hasComputedStyle(h)&&this.parseElements.add(h)}var c=this.parseElements.values().next().value,l=function(){t.initialized=!1,t.userSettings.preloadImages&&O.removeElementsByClassName("__css.preload");var n=t.session.image.entries(),i=Array.isArray(n),r=0;for(n=i?n:n[Symbol.iterator]();;){var s;if(i){if(r>=n.length)break;s=n[r++]}else{if((r=n.next()).done)break;s=r.value}var a=d(s,2);P.ASSETS.images.set(a[0],a[1])}for(var h=Array.isArray(l=t.extensions),c=0,l=h?l:l[Symbol.iterator]();;){var o;if(h){if(c>=l.length)break;o=l[c++]}else{if((c=l.next()).done)break;o=c.value}o.beforeParseDocument()}for(var u=Array.isArray(g=t.parseElements),f=0,g=u?g:g[Symbol.iterator]();;){var v;if(u){if(f>=g.length)break;v=g[f++]}else{if((f=g.next()).done)break;v=f.value}var p=v;""===t.appName&&(t.appName=p.id||"untitled");var y=D.trimNull(p.dataset.filename).replace(RegExp(".".concat(t.controllerHandler.localSettings.layout.fileExtension,"$")),"");""===y&&(y=p.id||"document_".concat(t.size));var k=parseInt(p.dataset.iteration||"0")+1;p.dataset.iteration=""+k,p.dataset.layoutName=D.convertWord(k>1?"".concat(y,"_").concat(k):y),t.createCache(p)&&(t.setBaseLayout(),t.setConstraints(),t.setResources())}for(var b=Array.isArray(A=t.extensions),S=0,A=b?A:A[Symbol.iterator]();;){var w;if(b){if(S>=A.length)break;w=A[S++]}else{if((S=A.next()).done)break;w=S.value}for(var T=w,E=Array.isArray(R=T.subscribers),B=0,R=E?R:R[Symbol.iterator]();;){var x;if(E){if(B>=R.length)break;x=R[B++]}else{if((B=R.next()).done)break;x=B.value}T.postParseDocument(x)}}for(var I=Array.isArray(L=t.extensions),C=0,L=I?L:L[Symbol.iterator]();;){var H;if(I){if(C>=L.length)break;H=L[C++]}else{if((C=L.next()).done)break;H=C.value}H.afterParseDocument()}"function"==typeof e&&e.call(t)};if(this.userSettings.preloadImages){Array.from(this.parseElements).forEach(function(e){e.querySelectorAll("svg image").forEach(function(e){var n=D.resolvePath(e.href.baseVal);t.session.image.set(n,{width:e.width.baseVal.value,height:e.height.baseVal.value,uri:n})})});var o=this.session.image.values(),u=Array.isArray(o),f=0;for(o=u?o:o[Symbol.iterator]();;){var g;if(u){if(f>=o.length)break;g=o[f++]}else{if((f=o.next()).done)break;g=f.value}var v=g;if(0===v.width&&0===v.height&&v.uri){var p=document.createElement("img");p.src=v.uri,p.complete&&p.naturalWidth>0&&p.naturalHeight>0?(v.width=p.naturalWidth,v.height=p.naturalHeight):(p.className="__css.preload",p.style.display="none",c.appendChild(p))}}}for(var y=[],k=Array.isArray(S=this.parseElements),b=0,S=k?S:S[Symbol.iterator]();;){var A;if(k){if(b>=S.length)break;A=S[b++]}else{if((b=S.next()).done)break;A=b.value}Array.from(A.querySelectorAll("IMG")).forEach(function(e){e instanceof SVGImageElement||(e.complete?t.addImagePreload(e):y.push(e))})}return 0===y.length?l():(this.initialized=!0,Promise.all(y.map(function(e){return new Promise(function(t,n){e.onload=t,e.onerror=n})})).then(function(e){if(Array.isArray(e))for(var n=Array.isArray(r=e),i=0,r=n?r:r[Symbol.iterator]();;){var s;if(n){if(i>=r.length)break;s=r[i++]}else{if((i=r.next()).done)break;s=i.value}var a=s;try{t.addImagePreload(a.target)}catch(e){}}l()}).catch(function(e){var t=e.target?e.target.src:"";D.hasValue(t)&&!confirm("FAIL: ".concat(t))||l()})),{then:function(n){t.initialized?e=n:n()}}}},{key:"renderNode",value:function(e){return 0===e.itemCount?this.controllerHandler.renderNode(e):(this.saveRenderPosition(e.node,e.renderPosition),this.controllerHandler.renderNodeGroup(e))}},{key:"renderLayout",value:function(e){var t="",n=D.hasBit(e.renderType,64);return n&&D.hasBit(e.renderType,8)?t=this.processFloatHorizontal(e):n&&D.hasBit(e.renderType,16)?t=this.processFloatVertical(e):0!==e.containerType&&(t=this.renderNode(e)),t}},{key:"addLayoutFile",value:function(e,t,n){var i={pathname:n=n||this.controllerHandler.localSettings.layout.pathName,filename:e,content:t};arguments.length>3&&void 0!==arguments[3]&&arguments[3]&&this._views.length&&""===this._views[0].content?this._views[0]=i:this._views.push(i),this.processing.layout=i}},{key:"addIncludeFile",value:function(e,t){this._includes.push({filename:e,content:t,pathname:this.controllerHandler.localSettings.layout.pathName})}},{key:"addRenderTemplate",value:function(e,t,n){var i=this;if(""!==n){if(arguments.length>3&&void 0!==arguments[3]&&arguments[3]&&t.renderChildren.some(function(e){var n=i.processing.depthMap.values(),r=Array.isArray(n),s=0;for(n=r?n:n[Symbol.iterator]();;){var a;if(r){if(s>=n.length)break;a=n[s++]}else{if((s=n.next()).done)break;a=s.value}var h=a,c=e.renderPositionId,l=h.get(c);if(l){var o=t.renderDepth+1;return e.renderDepth!==o&&h.set(c,i.controllerHandler.replaceIndent(l,o,i.processing.cache.children)),!0}}return!1}),!this.parseElements.has(t.element))if(t.dataset.target){var r=document.getElementById(t.dataset.target);if(r&&r!==e.element)return this.addRenderQueue(t.dataset.target,n),void(t.positioned=!0)}else if(e.dataset.target){if(document.getElementById(e.dataset.target))return this.addRenderQueue(e.controlId,n),void(t.dataset.target=e.controlId)}this.processing.depthMap.has(e.id)||this.processing.depthMap.set(e.id,new Map);var s=this.processing.depthMap.get(e.id);s&&s.set(t.renderPositionId,n)}}},{key:"addRenderQueue",value:function(e,t){var n=this.session.renderQueue.get(e)||[];n.push(t),this.session.renderQueue.set(e,n)}},{key:"addImagePreload",value:function(e){e&&e.complete&&D.hasValue(e.src)&&this.session.image.set(e.src,{width:e.naturalWidth,height:e.naturalHeight,uri:e.src})}},{key:"saveRenderPosition",value:function(e,t){var n;if(e.groupParent){var i=e.parent;if(i){var r,s=i.id,a=this._renderPosition.get(s);if(a){var h=a.children.filter(function(t){return!e.contains(t)});if(e.siblingIndex<h.length){h.splice(e.siblingIndex,0,e);for(var c=e.siblingIndex+1;c<h.length;c++)h[c].siblingIndex=c;r=h}else e.siblingIndex=h.length,h.push(e);this._renderPosition.set(s,{parent:i,children:h})}else r=i.children;if(r)for(var l=e.siblingIndex+1;l<r.length;l++)r[l]&&(r[l].siblingIndex=l)}}if(t){var o,u=this._renderPosition.get(e.id);if(u)(o=n=u.children.filter(function(t){return!e.contains(t)})).push.apply(o,v(e.children));else n=e.duplicate();this._renderPosition.set(e.id,{parent:e,children:n})}}},{key:"toString",value:function(){return this._views.length?this._views[0].content:""}},{key:"createCache",value:function(e){var t=this,n=function(){if(e===document.body){var n=0;return document.querySelectorAll(Array.from(document.body.childNodes).some(function(e){return t.conditionElement(e)&&++n>1})?"body, body *":"body *")}return e.querySelectorAll("*")}();this.processing.cache.afterAppend=void 0,this.processing.cache.clear(),this.processing.excluded.clear(),this.processing.node=null;for(var i=Array.isArray(s=this.extensions),r=0,s=i?s:s[Symbol.iterator]();;){var a;if(i){if(r>=s.length)break;a=s[r++]}else{if((r=s.next()).done)break;a=r.value}a.beforeInit(e)}var h=this.insertNode(e);if(!h)return!1;h.parent=new this.nodeConstructor(0,e.parentElement||document.body,this.controllerHandler.afterInsertNode),h.documentRoot=!0,h.documentParent=h.parent,this.processing.node=h;for(var c=this.controllerHandler.localSettings,l=Array.from(n),o=function(){var n=l[u];if(!t.parseElements.has(n)&&(q(e,n,Array.from(t.extensions)).some(function(e){return e.init(n)}),!t.parseElements.has(n)&&!(c.unsupported.tagName.has(n.tagName)||n instanceof HTMLInputElement&&c.unsupported.tagName.has("".concat(n.tagName,":").concat(n.type))))){for(var i=!0,r=n.parentElement;r&&r!==e;){if(t.parseElements.has(r)){i=!1;break}r=r.parentElement}i&&t.insertNode(n)}},u=0;u<l.length;u++)o();if(this.processing.cache.length){for(var f=function(){if(g){if(d>=v.length)return"break";p=v[d++]}else{if((d=v.next()).done)return"break";p=d.value}var e=p;if("SELECT"!==e.element.tagName){var n=[],i=!1;Array.from(e.element.childNodes).forEach(function(e){if("#text"===e.nodeName)n.push(e);else if("BR"!==e.tagName){var t=O.getElementAsNode(e);t&&!t.excluded&&(i=!0)}}),i&&n.forEach(function(n){return t.insertNode(n,e)})}},g=Array.isArray(v=this.processing.cache),d=0,v=g?v:v[Symbol.iterator]();;){var p;if("break"===f())break}for(var y={},k=new Set,b=function(){if(S){if(A>=w.length)return"break";T=w[A++]}else{if((A=w.next()).done)return"break";T=A.value}var e=T;if(e.styleElement){var t=e.element,n={};if("BUTTON"!==t.tagName&&"button"!==t.type){var i=e.css("textAlign");switch(i){case"center":case"right":case"end":n.textAlign=i,t.style.textAlign="left"}}e.positionRelative&&!e.positionStatic&&["top","right","bottom","left"].forEach(function(i){e.has(i)&&(n[i]=e.css(i),t.style[i]="auto")}),"rtl"===t.dir&&(t.dir="ltr",k.add(t)),y[e.id]=n}},S=Array.isArray(w=this.processing.cache),A=0,w=S?w:w[Symbol.iterator]();;){var T;if("break"===b())break}h.parent.setBounds();for(var E=Array.isArray(x=this.processing.cache),R=0,x=E?x:x[Symbol.iterator]();;){var I;if(E){if(R>=x.length)break;I=x[R++]}else{if((R=x.next()).done)break;I=R.value}I.setBounds()}for(var C=Array.isArray(H=this.processing.excluded),L=0,H=C?H:H[Symbol.iterator]();;){var P;if(C){if(L>=H.length)break;P=H[L++]}else{if((L=H.next()).done)break;P=L.value}P.lineBreak||P.setBounds()}for(var V=Array.isArray(G=this.processing.cache),F=0,G=V?G:G[Symbol.iterator]();;){var N;if(V){if(F>=G.length)break;N=G[F++]}else{if((F=G.next()).done)break;N=F.value}if(N.styleElement){var U=y[N.id];if(U){var Y=N.element;for(var z in U)Y.style[z]=U[z];k.has(Y)&&(Y.dir="rtl")}}}for(var M=Array.isArray(X=this.processing.cache),Q=0,X=M?X:X[Symbol.iterator]();;){var Z;if(M){if(Q>=X.length)break;Z=X[Q++]}else{if((Q=X.next()).done)break;Z=Q.value}var K=Z;if(!K.documentRoot){var J=K.actualParent;switch(K.position){case"fixed":if(!K.positionAuto){J=h;break}case"absolute":if(J&&W(K,J))break;if(this.userSettings.supportNegativeLeftTop){for(var j=K.absoluteParent,$=void 0,m=!1;J&&(J!==h||0!==J.id);){if(void 0===$){if(j===J){if($=J,"hidden"===J.css("overflow"))break;if(!(K.left<0&&K.outsideX(J.box)||!K.has("left")&&K.right<0&&K.outsideX(J.box)||K.top<0&&K.outsideY(J.box)||!K.has("top")&&K.bottom<0&&K.outsideX(J.box)))break;m=!0}}else if(m&&(J.documentRoot||"hidden"===J.css("overflow")||K.withinX(J.box)&&K.withinY(J.box))){$=J;break}J=J.actualParent}$&&(J=$);break}J=K.absoluteParent}K.pageFlow||void 0!==J&&0!==J.id||(J=h),J?(K.parent=J,K.documentParent=J):K.hide()}}for(var _=function(){if(ee){if(te>=ne.length)return"break";ie=ne[te++]}else{if((te=ne.next()).done)return"break";ie=te.value}var e=ie;if(e.htmlElement&&e.length){var t=0;Array.from(e.element.childNodes).forEach(function(n){var i=O.getElementAsNode(n);!i||i.excluded||!i.pageFlow&&i.documentParent!==e||(i.siblingIndex=t++)});var n=[];e.each(function(t){if(t.siblingIndex===Number.MAX_VALUE)for(var i=function(){if(r){if(s>=a.length)return"break";h=a[s++]}else{if((s=a.next()).done)return"break";h=s.value}var e=h;if(e.actualChildren.includes(t)||t.ascend().some(function(t){return e.cascade().includes(t)})){var i=-1;return void 0===n[i=t.zIndex>=0||e!==t.actualParent?e.siblingIndex+1:e.siblingIndex-1]&&(n[i]=[]),n[i].push(t),"break"}},r=Array.isArray(a=e.children),s=0,a=r?a:a[Symbol.iterator]();;){var h;if("break"===i())break}});for(var i=function(t){var i=n[t];if(i){i.sort(function(e,t){return e.zIndex===t.zIndex?e.id<t.id?-1:1:e.zIndex<t.zIndex?-1:1}),e.each(function(e){e.siblingIndex!==Number.MAX_VALUE&&e.siblingIndex>=t&&(e.siblingIndex+=i.length)});for(var r=0;r<i.length;r++)i[r].siblingIndex=t+r}},r=0;r<n.length;r++)i(r);e.sort(B.siblingIndex)}e.saveAsInitial()},ee=Array.isArray(ne=this.processing.cache),te=0,ne=ee?ne:ne[Symbol.iterator]();;){var ie;if("break"===_())break}D.sortAsc(this.processing.cache.children,"depth","id");for(var re=Array.isArray(ae=this.extensions),se=0,ae=re?ae:ae[Symbol.iterator]();;){var he;if(re){if(se>=ae.length)break;he=ae[se++]}else{if((se=ae.next()).done)break;he=se.value}he.afterInit(e)}return!0}return!1}},{key:"setBaseLayout",value:function(){var e,t,n=this,i=this.userSettings,r=this.controllerHandler.localSettings,s=this.processing.node,a=Array.from(this.extensions).filter(function(e){return!e.eventOnly}),h=new Map,c=r.baseTemplate,l=!0;function o(e,t,n){var i=h.get(e)||new Map;i.set(t,n),h.set(e,i)}function u(e){var t=h.values(),n=Array.isArray(t),i=0;for(t=n?t:t[Symbol.iterator]();;){var r;if(n){if(i>=t.length)break;r=t[i++]}else{if((i=t.next()).done)break;r=i.value}var s=r,a=s.values(),c=Array.isArray(a),l=0;for(a=c?a:a[Symbol.iterator]();;){var o;if(c){if(l>=a.length)break;o=a[l++]}else{if((l=a.next()).done)break;o=l.value}if(o.id===e)return void s.delete(o.id)}}}o(-1,0,s.parent);for(var f=0,g=Array.isArray(y=this.processing.cache.visible),p=0,y=g?y:y[Symbol.iterator]();;){var k;if(g){if(p>=y.length)break;k=y[p++]}else{if((p=y.next()).done)break;k=p.value}var S=k;o(S.depth,S.id,S),f=Math.max(S.depth,f)}for(var A=0;A<f;A++)h.set(-1*A-2,new Map);this.processing.cache.afterAppend=function(e){u(e.id),o(-1*e.depth-2,e.id,e),e.cascade().forEach(function(e){u(e.id),o(-1*e.depth-2,e.id,e)})};var w=h.values(),T=Array.isArray(w),E=0;for(w=T?w:w[Symbol.iterator]();;){var R;if(T){if(E>=w.length)break;R=w[E++]}else{if((E=w.next()).done)break;R=E.value}var I=R;this.processing.depthMap.clear();var C=function(){if(H){if(P>=L.length)return"break";O=L[P++]}else{if((P=L.next()).done)return"break";O=P.value}var e=O;if(0===e.length||e.every(function(e){return e.rendered}))return"continue";for(var t=e.duplicate(),r=t.some(function(e){return e.floating}),h=r?B.clearedAll(e):new Map,c=a.filter(function(e){return e.subscribersChild.size}),l=-1,o=function(){var e=t[l];if(e.rendered||!e.visible||n.parseElements.has(e.baseElement)&&!e.documentRoot&&!e.documentBody)return"continue";var o=e.parent,u=o.hasAlign(2),f=e.hasAlign(8192);if(e.pageFlow&&t.length>1&&l<t.length-1&&!o.hasAlign(4)&&(0===o.alignmentType||u||f)&&!e.hasBit("excludeSection",b.DOM_TRAVERSE)){var g,d,p=function(e){return!S.length&&!w&&(k.push(e),!0)},y=function(e){if(o.layoutVertical&&S.length){var t=S[S.length-1];if(t.layoutVertical)return e.parent=t,!0}return S.push(e),!0},k=[],S=[],A=new Set,w=!1,T=l,E=0;f&&o.layoutVertical&&(k.push(e),T++,E++);e:for(;T<t.length;T++,E++){var R=t[T];if(R.pageFlow){if(r){var I=h.get(R);I&&("both"===I?A.clear():A.delete(I)),R.floating&&A.add(R.float)}var C=R.previousSiblings(),L=C[C.length-1],H=R.nextSiblings().shift();if(0===E&&H)R.blockStatic||H.alignedVertically([R],[R],h)?S.push(R):k.push(R);else{if(!L)break e;if(r){var P=R.alignedVertically(C,[].concat(k,S,[R]),h,!1);if(P||i.floatOverlapDisabled&&L.floating&&R.blockStatic&&2===A.size){if(k.length){if(!i.floatOverlapDisabled&&A.size&&!L.autoMargin.horizontal&&!C.some(function(e){return e.lineBreak&&!h.has(e)})&&"both"!==h.get(R)){var O=D.maxArray(k.filter(function(e){return e.floating}).map(function(e){return e.linear.bottom}));if(!R.floating||R.linear.top<O){var V=B.floated(k);if(h.has(R)){if(!R.floating&&A.size<2&&2===V.size){R.alignmentType|=8192,w=!0,k.push(R);continue}break e}if(!P||1===V.size&&(!R.floating||A.has(R.float))){if(k.push(R),R.linear.bottom>O)break e;continue}}}break e}y(R)}else if(!p(R))break e}else if(R.alignedVertically(C))y(R);else if(!p(R))break e}}}if(k.length>1){var W=new x(o,e,0,0,k.length,k);W.init(),g=n.controllerHandler.processTraverseHorizontal(W,t),d=k[k.length-1]}else if(S.length>1){var F=new x(o,e,0,0,S.length,S);F.init(),g=n.controllerHandler.processTraverseVertical(F,t),(d=S[S.length-1]).blockStatic||d===t[t.length-1]||(d.alignmentType|=8192)}if(u&&d===t[t.length-1]&&(o.alignmentType^=2,u=!1),g){var G=g.layout,N=n.renderLayout(G);""!==N&&(n.addRenderTemplate(o,G.node,N,!0),o=e.parent)}}if(u&&l===t.length-1&&(o.alignmentType^=2),f&&(e.alignmentType^=8192),e.renderAs&&o.appendTry(e,e.renderAs,!1)&&(e.hide(),(e=e.renderAs).positioned&&(o=e.parent)),!e.rendered&&!e.hasBit("excludeSection",b.EXTENSION)){var U=!1;if(o.renderExtension.size||c.length)for(var Y=[].concat(v(o.renderExtension),v(c.filter(function(t){return t.subscribersChild.has(e)}))),z=0;z<Y.length;z++){var M=Y[z].processChild(e,o);if(M.output&&n.addRenderTemplate(o,e,M.output),M.renderAs&&M.outputAs&&n.addRenderTemplate(o,M.renderAs,M.outputAs),M.parent&&(o=M.parent),U=!0===M.next,M.complete||M.next)break}if(U)return"continue";if(e.styleElement&&(q(s.element,e.element,a).some(function(t){if(t.is(e)&&t.condition(e,o)){var i=t.processNode(e,o);if(i.output&&n.addRenderTemplate(o,e,i.output),i.renderAs&&i.outputAs&&n.addRenderTemplate(o,i.renderAs,i.outputAs),i.parent&&(o=i.parent),(i.output||!0===i.include)&&(t.subscribers.add(e),e.renderExtension.add(t)),U=!0===i.next,i.complete||i.next)return!0}return!1}),U))return"continue"}if(!e.rendered&&!e.hasBit("excludeSection",b.RENDER)){var Q=new x(o,e,e.containerType,e.alignmentType,e.length,e.children);if(0===Q.containerType){var X;if(!0===(X=e.length?n.controllerHandler.processUnknownParent(Q):n.controllerHandler.processUnknownChild(Q)).next)return"continue";if(X.renderAs)return t[l]=X.renderAs,l--,"continue";Q=X.layout}var Z=n.renderLayout(Q);""!==Z&&n.addRenderTemplate(o,e,Z)}};++l<t.length;)o()};var L=I.values(),H=Array.isArray(L),P=0;e:for(L=H?L:L[Symbol.iterator]();;){var O;switch(C()){case"break":break e;case"continue":continue}}var W=function(){if(G){if(N>=F.length)return"break";U=F[N++]}else{if((N=F.next()).done)return"break";U=N.value}var e=d(U,2),t=e[0],i=e[1],r=n._renderPosition.get(t),s=void 0;if(r)s=n.controllerHandler.sortRenderPosition(r.parent,r.children);else if(0!==t){var a=n.processing.cache.find("id",t);s=a?n.controllerHandler.sortRenderPosition(a,a.children):[]}if(s&&s.length){var h=new Map;s.forEach(function(e){var t=e.renderPositionId,n=i.get(t)||(e.companion?i.get(e.companion.renderPositionId):null);n&&h.set(t,n)}),h.size===i.size&&n.processing.depthMap.set(t,h)}},F=this.processing.depthMap.entries(),G=Array.isArray(F),N=0;for(F=G?F:F[Symbol.iterator]();;){var U;if("break"===W())break}for(var Y=Array.isArray(M=this.extensions),z=0,M=Y?M:M[Symbol.iterator]();;){var Q;if(Y){if(z>=M.length)break;Q=M[z++]}else{if((z=M.next()).done)break;Q=z.value}Q.afterDepthLevel()}var X=this.processing.depthMap.entries(),Z=Array.isArray(X),K=0;for(X=Z?X:X[Symbol.iterator]();;){var J;if(Z){if(K>=X.length)break;J=X[K++]}else{if((K=X.next()).done)break;J=K.value}var j=d(J,2),$=j[0],m=j[1].entries(),_=Array.isArray(m),ee=0;for(m=_?m:m[Symbol.iterator]();;){var te;if(_){if(ee>=m.length)break;te=m[ee++]}else{if((ee=m.next()).done)break;te=ee.value}var ne=d(te,2),ie=ne[0],re=ne[1],se=V.formatPlaceholder(-1!==ie.indexOf("^")?ie:$);-1!==c.indexOf(se)?(c=V.replacePlaceholder(c,se,re),l=!1):this.addRenderQueue(-1!==ie.indexOf("^")?"".concat($,"|").concat(ie):""+$,re)}}}!s.dataset.layoutName||D.hasValue(s.dataset.target)&&0!==s.renderExtension.size||this.addLayoutFile(s.dataset.layoutName,l?"":c,D.trimString(D.trimNull(s.dataset.pathname),"/"),s.renderExtension.size>0&&Array.from(s.renderExtension).some(function(e){return e.documentRoot})),l&&0===s.renderExtension.size&&s.hide(),this.processing.cache.sort(function(e,t){return e.visible&&e.rendered?e.renderDepth!==t.renderDepth?e.renderDepth<t.renderDepth?-1:1:e.renderParent!==t.renderParent?e.documentParent.id<t.documentParent.id?-1:1:e.siblingIndex<t.siblingIndex?-1:1:1}),(e=this.session.cache.children).push.apply(e,v(this.processing.cache)),(t=this.session.excluded.children).push.apply(t,v(this.processing.excluded));for(var ae=Array.isArray(ce=this.extensions),he=0,ce=ae?ce:ce[Symbol.iterator]();;){var le;if(ae){if(he>=ce.length)break;le=ce[he++]}else{if((he=ce.next()).done)break;le=he.value}for(var oe=le,ue=Array.isArray(ge=oe.subscribers),fe=0,ge=ue?ge:ge[Symbol.iterator]();;){var de;if(ue){if(fe>=ge.length)break;de=ge[fe++]}else{if((fe=ge.next()).done)break;de=fe.value}oe.postBaseLayout(de)}}for(var ve=Array.isArray(ye=this.extensions),pe=0,ye=ve?ye:ye[Symbol.iterator]();;){var ke;if(ve){if(pe>=ye.length)break;ke=ye[pe++]}else{if((pe=ye.next()).done)break;ke=pe.value}ke.afterBaseLayout()}}},{key:"setConstraints",value:function(){this.controllerHandler.setConstraints();for(var e=Array.isArray(n=this.extensions),t=0,n=e?n:n[Symbol.iterator]();;){var i;if(e){if(t>=n.length)break;i=n[t++]}else{if((t=n.next()).done)break;i=t.value}for(var r=i,s=Array.isArray(h=r.subscribers),a=0,h=s?h:h[Symbol.iterator]();;){var c;if(s){if(a>=h.length)break;c=h[a++]}else{if((a=h.next()).done)break;c=a.value}r.postConstraints(c)}}for(var l=Array.isArray(u=this.extensions),o=0,u=l?u:u[Symbol.iterator]();;){var f;if(l){if(o>=u.length)break;f=u[o++]}else{if((o=u.next()).done)break;f=o.value}f.afterConstraints()}}},{key:"setResources",value:function(){this.resourceHandler.setBoxStyle(),this.resourceHandler.setFontStyle(),this.resourceHandler.setValueString();for(var e=Array.isArray(n=this.extensions),t=0,n=e?n:n[Symbol.iterator]();;){var i;if(e){if(t>=n.length)break;i=n[t++]}else{if((t=n.next()).done)break;i=t.value}i.afterResources()}}},{key:"processRenderQueue",value:function(){var e={},t=this.session.renderQueue.entries(),n=Array.isArray(t),i=0;for(t=n?t:t[Symbol.iterator]();;){var r;if(n){if(i>=t.length)break;r=t[i++]}else{if((i=t.next()).done)break;r=i.value}var s=d(r,2),a=s[1],h=d((A=s[0]).split("|"),2),c=h[0],l=h[1],o=c;if(!D.isNumber(o)){var u=document.getElementById(o);if(u){var f=O.getElementAsNode(u);f&&(o=""+f.id)}}var g=a.join("\n");if(o!==c){var v=this.session.cache.find("id",parseInt(o));v&&(g=this.controllerHandler.replaceIndent(g,v.renderDepth+1,this.session.cache.children))}e[l||o]=g}for(var p=Array.isArray(k=this.viewData),y=0,k=p?k:k[Symbol.iterator]();;){var b;if(p){if(y>=k.length)break;b=k[y++]}else{if((y=k.next()).done)break;b=y.value}var S=b;for(var A in e)S.content=S.content.replace(V.formatPlaceholder(A),e[A]);S.content=this.controllerHandler.replaceRenderQueue(S.content)}}},{key:"processFloatHorizontal",value:function(e){var t=this,n=this.userSettings,i=[],r="";if(0===e.cleared.size&&!e.some(function(e){return e.autoMargin.horizontal})){for(var s=[],a=[],h=[],c=Array.isArray(o=e),l=0,o=c?o:o[Symbol.iterator]();;){var u;if(c){if(l>=o.length)break;u=o[l++]}else{if((l=o.next()).done)break;u=l.value}var f=u;"right"===f.float?h.push(f):"left"===f.float?a.push(f):s.push(f)}var g=new x(e.parent,e.node,0,0,e.itemCount,e.children);if(g.init(),s.length===g.itemCount||a.length===g.itemCount||h.length===g.itemCount)return this.controllerHandler.processLayoutHorizontal(g),this.renderNode(g);if((0===a.length||0===h.length)&&(this.userSettings.floatOverlapDisabled||!s.some(function(e){return e.blockStatic}))){var d=[];if(0===h.length){d.push.apply(d,a.concat(s));var p=this.controllerHandler.containerTypeHorizontal;g.setType(p.containerType,p.alignmentType),i=[a,s]}else{d.push.apply(d,s.concat(h));var y=this.controllerHandler.containerTypeVerticalMargin;g.setType(y.containerType,y.alignmentType),i=[s,h]}g.retain(d),r=this.renderNode(g)}}var k=[],b=[],S=[],A=[],w=[],T=[],E=[],R=[];if(0===i.length){for(var I="",C=0,L=0;L<e.length;L++){var H=e.item(L);if(e.cleared.has(H)){var P=e.cleared.get(H);if(D.hasBit(C,"right"===P?4:2)||0!==C&&"both"===P)switch(P){case"left":C^=2,I="left";break;case"right":C^=4,I="right";break;case"both":switch(C){case 2:I="left";break;case 4:I="right";break;default:I="both"}C=0}}if(""===I)"right"===H.float?(A.push(H),H.floating&&(C|=4)):"left"===H.float?(S.push(H),H.floating&&(C|=2)):H.autoMargin.horizontal?H.autoMargin.left?A.length?T.push(H):A.push(H):H.autoMargin.right?S.length?w.push(H):S.push(H):k.length?0===S.length?S.push(H):A.push(H):k.push(H):k.push(H);else if("right"===H.float)0===T.length&&(C|=4),!n.floatOverlapDisabled&&"right"!==I&&A.length?A.push(H):T.push(H);else if("left"===H.float)0===w.length&&(C|=2),!n.floatOverlapDisabled&&"left"!==I&&S.length?S.push(H):w.push(H);else if(H.autoMargin.horizontal)H.autoMargin.left&&T.length?T.push(H):H.autoMargin.right&&w.length?w.push(H):b.push(H);else switch(I){case"left":w.push(H);break;case"right":T.push(H);break;default:b.push(H)}}S.length&&w.length?E=[S,w]:S.length?E=S:w.length&&(E=w),A.length&&T.length?R=[A,T]:A.length?R=A:T.length&&(R=T);var O=new x(e.parent,e.node,0,A.length+T.length===e.length?512:0);if(n.floatOverlapDisabled){if(e.node.groupParent&&e.parent.layoutVertical)e.node.alignmentType|=O.alignmentType,r=V.formatPlaceholder(e.node.id),e.node.render(e.parent),e.node.renderDepth--;else{var q=this.controllerHandler.containerTypeVertical;O.setType(q.containerType,q.alignmentType),r=this.renderNode(O)}k.length&&i.push(k),(S.length||A.length)&&i.push([S,A]),(w.length||T.length)&&i.push([w,T]),b.length&&i.push(b),O.itemCount=i.length}else{var W;k.length?T.length?i.push(E=[k,S],R):w.length?i.push(R=[k,A],E):i.push(k,E,R):E===w&&R===A||E===S&&R===T?i.push(0===w.length?[S,T]:[A,w]):i.push(E,R),i=i.filter(function(e){return e.length>0}),O.itemCount=i.length,O.setType((W=0!==k.length||0!==E.length&&0!==R.length?this.controllerHandler.containerTypeVerticalMargin:this.controllerHandler.containerTypeVertical).containerType,W.alignmentType),r=this.renderNode(O)}}if(i.length){var F,G=[k,S,w,A,T];i.forEach(function(i,s){if(Array.isArray(i[0])){var a=[];i.forEach(function(e){return a.push.apply(a,v(e))}),a.sort(B.siblingIndex),F=t.controllerHandler.createNodeGroup(a[0],a,e.node);var h,c=new x(e.node,F,0,i.some(function(e){return e===R||e===A})?512:0,i.length);n.floatOverlapDisabled?h=t.controllerHandler.containerTypeVerticalMargin:e.node.layoutVertical?F=e.node:h=t.controllerHandler.containerTypeVertical,h&&(c.setType(h.containerType,h.alignmentType),r=V.replacePlaceholder(r,e.node.id,t.renderNode(c)))}else F=null;(Array.isArray(i[0])?i:[i]).forEach(function(i){var a,h=e.node;if(F&&G.includes(i)&&(h=F),i.length>1){a=t.controllerHandler.createNodeGroup(i[0],i,h);var c=new x(h,a,0,128,i.length,i);if(c.linearY){var l=t.controllerHandler.containerTypeVertical;c.setType(l.containerType,l.alignmentType)}else c.init(),t.controllerHandler.processLayoutHorizontal(c);r=V.replacePlaceholder(r,h.id,t.renderNode(c))}else i.length&&((a=i[0]).alignmentType|=2048,a.renderPosition=s,r=V.replacePlaceholder(r,h.id,V.formatPlaceholder(a.renderPositionId)));if(!n.floatOverlapDisabled&&a&&i===k&&i.some(function(e){return e.blockStatic&&!e.hasWidth})){var o=t.controllerHandler.containerTypeVertical,u=a.of(o.containerType,o.alignmentType)?a.children:[a];if(S.length){var f=D.maxArray(S.map(function(e){return e.linear.right})),g=D.minArray(i.map(function(e){return e.bounds.left}));u.forEach(function(e){return e.modifyBox(256,f-g)})}if(A.length){var d=D.minArray(A.map(function(e){return e.linear.left})),v=D.maxArray(i.map(function(e){return e.bounds.right}));u.forEach(function(e){return e.modifyBox(64,v-d)})}}})})}return r}},{key:"processFloatVertical",value:function(e){for(var t=this,n=this.controllerHandler,i=n.containerTypeVertical,r=e.node,s=new x(e.parent,r,i.containerType,i.alignmentType,e.length),a=this.renderNode(s),h=[],c=[],l=[],o=[],u=!1,f=!1,g=!0,d=Array.isArray(p=e),v=0,p=d?p:p[Symbol.iterator]();;){var y;if(d){if(v>=p.length)break;y=p[v++]}else{if((v=p.next()).done)break;y=v.value}var k=y;k.blockStatic&&0===o.length?(l.push(k),f=!0):(e.cleared.has(k)&&(k.floating?u=!0:(k.modifyBox(2,null),h.push(l.slice()),l.length=0,c.push(o.slice()),o.length=0)),k.floating?(f&&(h.push(l.slice()),c.push(null),l.length=0,o.length=0,f=!1),o.push(k)):(u&&!e.cleared.has(k)&&(g=!1),l.push(k)))}return o.length&&c.push(o),l.length&&h.push(l),g||function(){for(var s="",l=0;l<Math.max(c.length,h.length);l++){var o=h[l]||[];if(null===c[l]&&o.length)if(o.length>1){var u=n.containerTypeVertical;u.alignmentType|=128;var f=new x(r,n.createNodeGroup(o[0],o,r),u.containerType,u.alignmentType,o.length,o);s+=t.renderNode(f)}else{var g=o[0];g.alignmentType|=2048,g.renderPosition=l,a=V.replacePlaceholder(a,r.id,V.formatPlaceholder(g.renderPositionId))}else{var d=c[l]||[];(o.length||d.length)&&function(){var a=n.createNodeGroup(d[0]||o[0],[],r),h=n.containerTypeVerticalMargin,c=new x(r,a,h.containerType,h.alignmentType),l=[],u=void 0;d.length&&(d.length>1?(u=n.createNodeGroup(d[0],d,a),c.add(64),0===o.length&&d.every(function(e){return"right"===e.float})&&c.add(512)):(u=d[0]).parent=a),u&&(l.push(u),u=void 0),o.length&&(o.length>1?u=n.createNodeGroup(o[0],o,a):(u=o[0]).parent=a),u&&l.push(u),a.init(),c.itemCount=l.length,s+=t.renderNode(c),l.forEach(function(n){if(e.contains(n)||0===n.length)s=V.replacePlaceholder(s,a.id,V.formatPlaceholder(n.id));else{var r=new x(a,n,i.containerType,128|i.alignmentType,n.length,n.children);s=V.replacePlaceholder(s,a.id,t.renderNode(r))}})}()}}a=V.replacePlaceholder(a,r.id,s)}(),a}},{key:"insertNode",value:function(e,t){var n=null;if(O.hasComputedStyle(e)){var i=new this.nodeConstructor(this.nextId,e,this.controllerHandler.afterInsertNode);!this.controllerHandler.localSettings.unsupported.excluded.has(e.tagName)&&this.conditionElement(e)?(n=i).setExclusions():(i.visible=!1,i.excluded=!0,this.processing.excluded.append(i))}else"#"===e.nodeName.charAt(0)&&"#text"===e.nodeName&&(O.isPlainText(e,!0)||O.cssParent(e,"whiteSpace","pre","pre-wrap"))&&(n=new this.nodeConstructor(this.nextId,e,this.controllerHandler.afterInsertNode),t?n.inherit(t,"textStyle"):n.css("whiteSpace",O.getStyle(e.parentElement).whiteSpace||"normal"),n.css({position:"static",display:"inline",verticalAlign:"baseline",cssFloat:"none",clear:"none"}));return n&&this.processing.cache.append(n),n}},{key:"conditionElement",value:function(e){if(e.parentElement instanceof SVGSVGElement)return!1;if(O.hasComputedStyle(e)){if(D.hasValue(e.dataset.use))return!0;if(O.withinViewportOrigin(e))return!0;for(var t=e.parentElement,n=!0;t;){if("none"===O.getStyle(t).display){n=!1;break}t=t.parentElement}return!(!n||!e.children.length)&&Array.from(e.children).some(function(e){var t=O.getStyle(e),n=t.cssFloat,i=t.position;return"absolute"===i||"fixed"===i||"left"===n||"right"===n})}return O.isPlainText(e)}},{key:"setStyleMap",value:function(){for(var e=this,t=this.userSettings.resolutionDPI,n=O.isUserAgent(16),i=!1,r=0;r<document.styleSheets.length;r++){var s=document.styleSheets[r];if(s.cssRules)for(var a=0;a<s.cssRules.length;a++)try{s.cssRules[a]instanceof CSSStyleRule&&function(){var i=s.cssRules[a],r=new Set;Array.from(i.style).forEach(function(e){return r.add(D.convertCamelCase(e))}),Array.from(document.querySelectorAll(i.selectorText)).forEach(function(s){var a=new Set(r);Array.from(s.style).forEach(function(e){return a.add(D.convertCamelCase(e))});for(var h=O.getStyle(s),c=parseInt(D.convertPX(h.fontSize||"16px",t,0)),l={},o=Array.isArray(f=a),u=0,f=o?f:f[Symbol.iterator]();;){var g;if(o){if(u>=f.length)break;g=f[u++]}else{if((u=f.next()).done)break;g=u.value}var d=g;if(s.style[d])l[d]=s.style[d];else{var v=i.style[d];if("initial"!==v){var p=h[d]||"";if(v===p)l[d]=v;else switch(d){case"backgroundColor":case"borderTopColor":case"borderRightColor":case"borderBottomColor":case"borderLeftColor":case"color":case"fontSize":case"fontWeight":l[d]=p||v;break;case"width":case"height":case"minWidth":case"maxWidth":case"minHeight":case"maxHeight":case"lineHeight":case"verticalAlign":case"textIndent":case"columnGap":case"top":case"right":case"bottom":case"left":case"marginTop":case"marginRight":case"marginBottom":case"marginLeft":case"paddingTop":case"paddingRight":case"paddingBottom":case"paddingLeft":l[d]=/^[A-Za-z\-]+$/.test(v)||D.isPercent(v)?v:D.convertPX(v,t,c);break;default:void 0===l[d]&&(l[d]=v)}}}}if(e.userSettings.preloadImages&&D.hasValue(l.backgroundImage)&&"initial"!==l.backgroundImage&&l.backgroundImage.split(",").map(function(e){return e.trim()}).forEach(function(t){var n=O.cssResolveUrl(t);""===n||e.session.image.has(n)||e.session.image.set(n,{width:0,height:0,uri:n})}),n&&void 0===l.display)switch(s.tagName){case"INPUT":case"TEXTAREA":case"SELECT":case"BUTTON":l.display="inline-block"}var y=O.getElementCache(s,"styleMap");y?Object.assign(y,l):(O.setElementCache(s,"style",h),O.setElementCache(s,"styleMap",l))})}()}catch(e){i||(alert("External CSS files cannot be parsed with Chrome 64+ when loading HTML pages directly from your hard drive [file://]. Either use a local web server [http://], embed your CSS into a &lt;style&gt; element, or use a different browser. See the README for more detailed instructions.\n\n"+"".concat(s.href,"\n\n").concat(e)),i=!0)}}}},{key:"appName",set:function(e){this.resourceHandler.fileHandler&&(this.resourceHandler.fileHandler.appName=e)},get:function(){return this.resourceHandler.fileHandler?this.resourceHandler.fileHandler.appName:""}},{key:"userSettings",set:function(e){this._userSettings=e},get:function(){return this._userSettings||{}}},{key:"viewData",get:function(){return[].concat(v(this._views),v(this._includes))}},{key:"sessionData",get:function(){return{cache:this.session.cache,views:this._views,includes:this._includes}}},{key:"rendered",get:function(){return this.session.cache.filter(function(e){return e.visible&&e.rendered})}},{key:"nextId",get:function(){return this.processing.cache.nextId}},{key:"size",get:function(){return this._views.length+this._includes.length}}]),e}(),G=squared.lib.util,N=squared.lib.xml,U=function(){function e(t,n){r(this,e),this.application=t,this.cache=n,this._before={},this._after={}}return a(e,[{key:"reset",value:function(){this._before={},this._after={}}},{key:"replaceRenderQueue",value:function(e){for(var t in this._before)e=e.replace("{<".concat(t,"}"),this._before[t].join(""));for(var n in this._after)e=e.replace("{>".concat(n,"}"),this._after[n].join(""));return e}},{key:"prependBefore",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;void 0===this._before[e]&&(this._before[e]=[]),-1!==n&&n<this._before[e].length?this._before[e].splice(n,0,t):this._before[e].push(t)}},{key:"appendAfter",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;void 0===this._after[e]&&(this._after[e]=[]),-1!==n&&n<this._after[e].length?this._after[e].splice(n,0,t):this._after[e].push(t)}},{key:"hasAppendProcessing",value:function(e){return void 0!==this._before[e]||void 0!==this._after[e]}},{key:"getEnclosingTag",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=G.repeat(Math.max(0,n)),s="{<".concat(t,"}");return s+=""!==i?r+"<".concat(e).concat(0===n?"{#0}":"","{@").concat(t,"}>\n")+i+r+"</".concat(e,">\n"):r+"<".concat(e).concat(0===n?"{#0}":"","{@").concat(t,"} />\n"),s+="{>".concat(t,"}")}},{key:"removePlaceholders",value:function(e){return e.replace(/{[<:@#>]\d+(\^\d+)?}/g,"").trim()}},{key:"replaceIndent",value:function(e,t,n){if(e=N.replaceIndent(e,t,/^({.*?})(\t*)(<.*)/),n)for(var i,r=/{@(\d+)}/g,s=0,a=function(){var e=parseInt(i[1]),r=n.find(function(t){return t.id===e});r&&(0==s++?r.renderDepth=t:r.renderParent&&(r.renderDepth=r.renderParent.renderDepth+1))};null!==(i=r.exec(e));)a();return e}}]),e}(),Y=squared.lib.dom,z=squared.lib.util,M=function(){function e(t,n,i,s){r(this,e),this.name=t,this.framework=n,this.tagNames=[],this.documentRoot=!1,this.eventOnly=!1,this.preloaded=!1,this.options={},this.dependencies=[],this.subscribers=new Set,this.subscribersChild=new Set,Array.isArray(i)&&(this.tagNames=i.map(function(e){return e.trim().toUpperCase()})),s&&Object.assign(this.options,s)}return a(e,[{key:"is",value:function(e){return!!e.styleElement&&(0===this.tagNames.length||this.tagNames.includes(e.element.tagName))}},{key:"require",value:function(e){this.dependencies.push({name:e,preload:arguments.length>1&&void 0!==arguments[1]&&arguments[1]})}},{key:"included",value:function(e){return z.includes(e.dataset.use,this.name)}},{key:"beforeInit",value:function(e){var t=this;!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&this.included(e)&&this.dependencies.filter(function(e){return e.preload}).forEach(function(n){var i=t.application.extensionManager.retrieve(n.name);i&&!i.preloaded&&(i.beforeInit(e,!0),i.preloaded=!0)})}},{key:"init",value:function(e){return!1}},{key:"afterInit",value:function(e){var t=this;!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&this.included(e)&&this.dependencies.filter(function(e){return e.preload}).forEach(function(n){var i=t.application.extensionManager.retrieve(n.name);i&&i.preloaded&&(i.afterInit(e,!0),i.preloaded=!1)})}},{key:"condition",value:function(e,t){return!!Y.hasComputedStyle(e.element)&&(e.dataset.use?this.included(e.element):this.tagNames.length>0)}},{key:"processNode",value:function(e,t){return{output:"",complete:!1}}},{key:"processChild",value:function(e,t){return{output:"",complete:!1}}},{key:"postBaseLayout",value:function(e){}},{key:"postConstraints",value:function(e){}},{key:"postParseDocument",value:function(e){}},{key:"postProcedure",value:function(e){}},{key:"beforeParseDocument",value:function(){}},{key:"afterDepthLevel",value:function(){}},{key:"afterBaseLayout",value:function(){}},{key:"afterConstraints",value:function(){}},{key:"afterResources",value:function(){}},{key:"afterParseDocument",value:function(){}},{key:"afterProcedure",value:function(){}},{key:"afterFinalize",value:function(){}},{key:"application",set:function(e){this._application=e},get:function(){return this._application||{}}},{key:"installed",get:function(){return!!this.application.extensions&&this.application.extensions.has(this)}}],[{key:"findNestedByName",value:function(e,t){return Y.hasComputedStyle(e)&&Array.from(e.children).find(function(e){return z.includes(e.dataset.use,t)})||null}}]),e}(),Q=squared.lib.util,X=function(){function e(t){r(this,e),this.application=t}return a(e,[{key:"include",value:function(e){var t=this,n=this.retrieve(e.name);return n?(Array.isArray(e.tagNames)&&(n.tagNames=e.tagNames),Object.assign(n.options,e.options),!0):!(0!==e.framework&&!Q.hasBit(e.framework,this.application.framework)||!e.dependencies.every(function(e){return!!t.retrieve(e.name)}))&&(e.application=this.application,this.application.extensions.add(e),!0)}},{key:"exclude",value:function(e){return this.application.extensions.delete(e)}},{key:"retrieve",value:function(e){return Array.from(this.application.extensions).find(function(t){return t.name===e})||null}},{key:"optionValue",value:function(e,n){var i=this.retrieve(e);if(i&&"object"===t(i.options))return i.options[n]}},{key:"optionValueAsObject",value:function(e,n){var i=this.optionValue(e,n);return"object"===t(i)?i:null}},{key:"optionValueAsString",value:function(e,t){var n=this.optionValue(e,t);return"string"==typeof n?n:""}},{key:"optionValueAsNumber",value:function(e,t){var n=this.optionValue(e,t);return"number"==typeof n?n:0}},{key:"optionValueAsBoolean",value:function(e,t){var n=this.optionValue(e,t);return"boolean"==typeof n&&n}}]),e}(),Z=squared.lib.util,K=function(){function e(t){r(this,e),this.resource=t,this.appName="",this.assets=[],t.fileHandler=this}return a(e,[{key:"addAsset",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(""!==n||""!==i){var r=this.assets.findIndex(function(n){return n.pathname===e&&n.filename===t});-1!==r?(this.assets[r].content=n||"",this.assets[r].uri=i||""):this.assets.push({pathname:e,filename:t,content:n,uri:i})}}},{key:"reset",value:function(){this.assets.length=0}},{key:"saveToDisk",value:function(t){var n=this.userSettings;location.protocol.startsWith("http")?t.length&&(t.push.apply(t,v(this.assets)),fetch("/api/savetodisk"+"?directory=".concat(encodeURIComponent(Z.trimString(n.outputDirectory,"/")))+"&appname=".concat(encodeURIComponent(this.appName.trim()))+"&filetype=".concat(n.outputArchiveFileType.toLowerCase())+"&processingtime=".concat((""+n.outputMaxProcessingTime).trim()),{method:"POST",body:JSON.stringify(t),headers:new Headers({Accept:"application/json, text/plain, */*","Content-Type":"application/json"})}).then(function(e){return e.json()}).then(function(t){t&&(t.zipname?fetch("/api/downloadtobrowser?filename=".concat(encodeURIComponent(t.zipname))).then(function(e){return e.blob()}).then(function(n){return e.downloadToDisk(n,Z.lastIndexOf(t.zipname))}):t.system&&alert("".concat(t.application,"\n\n").concat(t.system)))}).catch(function(e){return alert("ERROR: ".concat(e))})):alert("SERVER (required): See README for instructions")}},{key:"stored",get:function(){return this.resource.stored}}],[{key:"downloadToDisk",value:function(e,t){var n=new Blob([e],{type:(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")||"application/octet-stream"});if(void 0===window.navigator.msSaveBlob){var i=window.URL.createObjectURL(n),r=document.createElement("a");r.style.display="none",r.href=i,r.setAttribute("download",t),void 0===r.download&&r.setAttribute("target","_blank"),document.body.appendChild(r),r.click(),document.body.removeChild(r),setTimeout(function(){return window.URL.revokeObjectURL(i)},1)}else window.navigator.msSaveBlob(n,t)}}]),e}(),J=new Map([[2,"marginTop"],[4,"marginRight"],[8,"marginBottom"],[16,"marginLeft"],[32,"paddingTop"],[64,"paddingRight"],[128,"paddingBottom"],[256,"paddingLeft"]]),j={ACCESSIBILITY:"squared.accessibility",CSS_GRID:"squared.css-grid",EXTERNAL:"squared.external",FLEXBOX:"squared.flexbox",GRID:"squared.grid",LIST:"squared.list",RELATIVE:"squared.relative",SPRITE:"squared.sprite",SUBSTITUTE:"squared.substitute",TABLE:"squared.table",VERTICAL_ALIGN:"squared.verticalalign",WHITESPACE:"squared.whitespace"},$=Object.freeze({CSS_SPACING:J,EXT_NAME:j}),m=squared.lib.dom,_=squared.lib.util,ee=function(e){function n(e,t){var i;return r(this,n),(i=u(this,l(n).call(this))).id=e,i.alignmentType=0,i.depth=-1,i.siblingIndex=Number.MAX_VALUE,i.renderPosition=-1,i.documentRoot=!1,i.visible=!0,i.excluded=!1,i.rendered=!1,i.baselineActive=!1,i.positioned=!1,i.renderExtension=new Set,i.controlId="",i._cached={},i._styleMap={},i._initial={iteration:-1,children:[],styleMap:{}},i._initialized=!1,i._renderDepth=-1,i._data={},i._excludeSection=0,i._excludeProcedure=0,i._excludeResource=0,i._element=null,t&&(i._element=t,i.init()),i.style=m.hasComputedStyle(t)?m.getElementCache(t,"style")||getComputedStyle(t):{},i}return c(n,squared.lib.base.Container),a(n,[{key:"init",value:function(){if(!this._initialized){if(this.styleElement){var e=this._element,t=m.getElementCache(e,"styleMap")||{};Array.from(e.style).forEach(function(n){return t[_.convertCamelCase(n)]=e.style[n]}),this._styleMap=Object.assign({},t)}this._element&&m.setElementCache(this._element,"node",this),this._initialized=!0}}},{key:"saveAsInitial",value:function(){-1===this._initial.iteration&&(this._initial.children=this.duplicate(),this._initial.styleMap=Object.assign({},this._styleMap),this._initial.documentParent=this._documentParent),this._bounds&&(this._initial.bounds=m.assignBounds(this._bounds),this._initial.linear=m.assignBounds(this.linear),this._initial.box=m.assignBounds(this.box)),this._initial.iteration++}},{key:"is",value:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.some(function(t){return e.containerType===t})}},{key:"of",value:function(e){for(var t=this,n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.containerType===e&&i.some(function(e){return t.hasAlign(e)})}},{key:"unsafe",value:function(e){return this["_".concat(e)]||void 0}},{key:"attr",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r="__".concat(e);if(_.hasValue(n)){if(void 0===this[r]&&(this._namespaces.add(e),this[r]={}),!i&&void 0!==this[r][t])return"";this[r][t]=""+n}return this[r][t]||""}},{key:"namespace",value:function(e){return this["__".concat(e)]||{}}},{key:"delete",value:function(e){var t="__".concat(e);if(this[t]){for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(var s=0;s<i.length;s++){var a=i[s];if(-1!==a.indexOf("*")){var h=_.searchObject(this[t],a),c=Array.isArray(h),l=0;for(h=c?h:h[Symbol.iterator]();;){var o;if(c){if(l>=h.length)break;o=h[l++]}else{if((l=h.next()).done)break;o=l.value}var u=d(o,1);delete this[t][u[0]]}}else delete this[t][a]}}}},{key:"apply",value:function(e){if("object"===t(e))for(var n in e){var i=e[n];if("object"===t(i)){for(var r in i)this.attr(n,r,i[r]);delete e[n]}}}},{key:"each",value:function(e){return(arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.renderChildren.filter(function(e){return e.visible}):this.children).forEach(e),this}},{key:"render",value:function(e){this.renderParent=e,this.renderDepth=this.documentRoot||this===e||_.hasValue(e.dataset.target)?0:e.renderDepth+1,this.rendered=!0}},{key:"hide",value:function(e){this.rendered=!0,this.visible=!1}},{key:"data",value:function(e,n,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return _.hasValue(i)?(void 0===this._data[e]&&(this._data[e]={}),"object"===t(this._data[e])&&(r||void 0===this._data[e][n])&&(this._data[e][n]=i)):null===i&&delete this._data[e],void 0===this._data[e]||void 0===this._data[e][n]?void 0:this._data[e][n]}},{key:"unsetCache",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.length)for(var i=0;i<t.length;i++){var r=t[i];switch(r){case"position":return void(this._cached={});case"width":case"minWidth":this._cached.hasWidth=void 0;break;case"height":case"minHeight":this._cached.hasHeight=void 0;break;case"verticalAlign":this._cached.baseline=void 0;break;case"display":this._cached.inline=void 0,this._cached.inlineVertical=void 0,this._cached.inlineFlow=void 0,this._cached.block=void 0,this._cached.blockDimension=void 0,this._cached.blockStatic=void 0,this._cached.autoMargin=void 0;break;default:r.startsWith("margin")&&(this._cached.autoMargin=void 0)}this._cached[r]=void 0}else this._cached={}}},{key:"ascend",value:function(){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,t=[],n=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.renderParent?"renderParent":"parent":"actualParent",i=this[n],r=-1;i&&0!==i.id&&!t.includes(i)&&(t.push(i),++r!==e);)i=i[n];return t}},{key:"cascade",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];function t(n){for(var i=[],r=Array.isArray(a=n.children),s=0,a=r?a:a[Symbol.iterator]();;){var h;if(r){if(s>=a.length)break;h=a[s++]}else{if((s=a.next()).done)break;h=s.value}var c=h;e&&!c.baseElement||i.push(c),c.length&&i.push.apply(i,v(t(c)))}return i}return t(this)}},{key:"inherit",value:function(e){for(var t=this,n=e.unsafe("initial"),i=arguments.length,r=Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];for(var a=0;a<r.length;a++){switch(r[a]){case"initial":Object.assign(this._initial,n);break;case"base":this._documentParent=e.documentParent,this._bounds=m.assignBounds(e.bounds),this._linear=m.assignBounds(e.linear),this._box=m.assignBounds(e.box);var h=e.actualParent;h&&this.css("direction",h.dir);break;case"alignment":["position","top","right","bottom","left","display","verticalAlign","cssFloat","clear","zIndex"].forEach(function(i){t._styleMap[i]=e.css(i),t._initial.styleMap[i]=n.styleMap[i]}),["marginTop","marginRight","marginBottom","marginLeft"].forEach(function(n){"auto"===e.cssInitial(n)&&(t._initial.styleMap[n]="auto"),"auto"===e.cssInitial(n,!0)&&(t._styleMap[n]="auto")});break;case"styleMap":_.assignWhenNull(this._styleMap,e.unsafe("styleMap"));break;case"textStyle":var c={whiteSpace:e.css("whiteSpace")};for(var l in e.style)if(l.startsWith("font")||l.startsWith("color")){var o=_.convertCamelCase(l);c[o]=e.style[o]}this.css(c)}}}},{key:"alignedVertically",value:function(e,t,n){var i=this,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(this.lineBreak)return!0;if(this.pageFlow&&e.length){if(_.isArray(t)&&this!==t[0]){if(n&&n.has(this))return!0;if(r)if(this.floating&&(this.linear.top>=t[t.length-1].linear.bottom||"left"===this.float&&t.filter(function(e){return e.siblingIndex<i.siblingIndex&&_.withinFraction(i.linear.left,e.linear.left)}).length>0||"right"===this.float&&t.filter(function(e){return e.siblingIndex<i.siblingIndex&&_.withinFraction(i.linear.right,e.linear.right)}).length>0))return!0}for(var s=this.actualParent,a=Array.isArray(c=e),h=0,c=a?c:c[Symbol.iterator]();;){var l;if(a){if(h>=c.length)break;l=c[h++]}else{if((h=c.next()).done)break;l=h.value}var o=l;if(o.blockStatic||this.blockStatic&&(!o.inlineFlow||n&&n.has(o))||n&&"both"===n.get(o)&&(!_.isArray(t)||t[0]!==o)||!o.floating&&(this.blockStatic||!this.floating&&!this.inlineFlow)||s&&o.bounds.width>(s.has("width",2)?s.width:s.box.width)&&(!o.textElement||o.textElement&&"nowrap"===o.css("whiteSpace"))||o.lineBreak||o.autoMargin.leftRight||"left"===o.float&&this.autoMargin.right||"right"===o.float&&this.autoMargin.left)return!0}}return!1}},{key:"intersectX",value:function(e){var t=this[arguments.length>1&&void 0!==arguments[1]?arguments[1]:"linear"];return e.top>=t.top&&e.top<t.bottom||e.bottom>t.top&&e.bottom<=t.bottom||t.top>=e.top&&t.bottom<=e.bottom||e.top>=t.top&&e.bottom<=t.bottom}},{key:"intersectY",value:function(e){var t=this[arguments.length>1&&void 0!==arguments[1]?arguments[1]:"linear"];return e.left>=t.left&&e.left<t.right||e.right>t.left&&e.right<=t.right||t.left>=e.left&&t.right<=e.right||e.left>=t.left&&e.right<=t.right}},{key:"withinX",value:function(e){var t=this[arguments.length>1&&void 0!==arguments[1]?arguments[1]:"linear"];return Math.ceil(t.top)>=Math.floor(e.top)&&Math.floor(t.bottom)<=Math.ceil(e.bottom)}},{key:"withinY",value:function(e){var t=this[arguments.length>1&&void 0!==arguments[1]?arguments[1]:"linear"];return Math.ceil(t.left)>=Math.floor(e.left)&&Math.floor(t.right)<=Math.ceil(e.right)}},{key:"outsideX",value:function(e){var t=this[arguments.length>1&&void 0!==arguments[1]?arguments[1]:"linear"];return Math.ceil(t.left)<Math.floor(e.left)||Math.ceil(t.left)>=Math.floor(e.right)}},{key:"outsideY",value:function(e){var t=this[arguments.length>1&&void 0!==arguments[1]?arguments[1]:"linear"];return Math.ceil(t.top)<Math.floor(e.top)||Math.ceil(t.top)>=Math.floor(e.bottom)}},{key:"css",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("object"===t(e)){if(Object.assign(this._styleMap,e),i)for(var r in e)this.unsetCache(r);return""}return arguments.length>=2&&(this._styleMap[e]=_.hasValue(n)?n:"",i&&this.unsetCache(e)),this._styleMap[e]||this.style&&this.style[e]||""}},{key:"cssInitial",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];-1!==this._initial.iteration||t||(n=!0);var i=t?this._styleMap[e]:this._initial.styleMap[e];return n&&!_.hasValue(i)&&(i=this.style[e]),i||""}},{key:"cssParent",value:function(e){for(var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n="",i=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this:this.actualParent;i;){if((n=i.cssInitial(e))||i.documentBody){t&&!i.visible&&(n="");break}i=i.actualParent}return n}},{key:"cssSort",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this.duplicate():this.children;return n.sort(function(n,i){var r=n.toInt(e),s=i.toInt(e);return r===s?0:t?r>s?-1:1:r<s?-1:1}),n}},{key:"cssPX",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=this._styleMap[e];if(r&&r.endsWith("px")&&_.isUnit(r)){t+=parseInt(r),n||(t=Math.max(0,t));var s=_.formatPX(t);return this.css(e,s),i&&this.unsetCache(e),s}return""}},{key:"cssTry",value:function(e,t){if(this.styleElement){var n=this._element,i=this.css(e);if(n.style[e]=t,n.style[e]===t)return m.setElementCache(n,e,i),!0}return!1}},{key:"cssFinally",value:function(e){if(this.styleElement){var t=this._element,n=m.getElementCache(t,e);if(n)return t.style[e]=n,m.deleteElementCache(t,e),!0}return!1}},{key:"toInt",value:function(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return parseInt((arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this._initial.styleMap:this._styleMap)[e])||t}},{key:"convertPX",value:function(e){return this.convertPercent(e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1],!(arguments.length>2&&void 0!==arguments[2])||arguments[2])||_.convertPX(e,this.dpi,this.fontSize)}},{key:"convertPercent",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(_.isPercent(e)){var i,r=(n?this.absoluteParent:null)||this,s=t?"width":"height";return i=r.has(s,2)?r.toInt(s):r[n?"box":"bounds"][s],"".concat(Math.round((parseFloat(e)>=1?parseInt(e)/100:parseFloat(e))*i),"px")}return""}},{key:"has",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=(n&&"initial"===n.map?this._initial.styleMap:this._styleMap)[e];if(_.hasValue(i))switch(i){case"0px":if(_.hasBit(t,64))return!0;switch(e){case"top":case"right":case"bottom":case"left":return!0}case"left":if(_.hasBit(t,8))return!0;case"baseline":if(_.hasBit(t,16))return!0;case"auto":if(_.hasBit(t,4))return!0;case"none":case"initial":case"normal":case"transparent":case"rgba(0, 0, 0, 0)":return!1;default:if(n&&n.not)if(Array.isArray(n.not))for(var r=Array.isArray(a=n.not),s=0,a=r?a:a[Symbol.iterator]();;){var h;if(r){if(s>=a.length)break;h=a[s++]}else{if((s=a.next()).done)break;h=s.value}if(i===h)return!1}else if(i===n.not)return!1;var c=0===t;return _.hasBit(t,2)&&_.isUnit(i)&&(c=!0),_.hasBit(t,32)&&_.isPercent(i)&&(c=!0),_.hasBit(t,4)&&(c=!1),c}return!1}},{key:"hasBit",value:function(e,t){return void 0!==this[e]&&_.hasBit(this[e],t)}},{key:"hasAlign",value:function(e){return _.hasBit(this.alignmentType,e)}},{key:"exclude",value:function(e){var t=e.section,n=void 0===t?0:t,i=e.procedure,r=void 0===i?0:i,s=e.resource,a=void 0===s?0:s;n&&(this._excludeSection|=n),r&&(this._excludeProcedure|=r),a&&(this._excludeResource|=a)}},{key:"setExclusions",value:function(){var e=this;if(this.styleElement){var t=function(t,n){var i=e.actualParent,r=[_.trimNull(e.dataset["exclude".concat(t)]),i?_.trimNull(i.dataset["exclude".concat(t,"Child")]):""].filter(function(e){return e}).join("|"),s=0;r.split("|").map(function(e){return e.toUpperCase().trim()}).forEach(function(e){void 0!==n[e]&&(s|=n[e])}),s>0&&e.exclude(h({},t.toLowerCase(),s))};t("Section",b),t("Procedure",A),t("Resource",S)}}},{key:"setBounds",value:function(){var e=this._element;if(e&&!(arguments.length>0&&void 0!==arguments[0]&&arguments[0]))if(this.styleElement){if(this._bounds=m.assignBounds(e.getBoundingClientRect()),this.documentBody){if(this.marginTop>0){var t=this.firstChild;t&&!t.lineBreak&&t.blockStatic&&t.marginTop>=this.marginTop&&this.css("marginTop","0px",!0)}this._bounds.top=this.marginTop}}else if(this.plainText){var n=m.getRangeClientRect(e);this._bounds=m.assignBounds(n)}}},{key:"appendTry",value:function(e,t){for(var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=0;i<this.length;i++)if(e===this.item(i))return t.siblingIndex=e.siblingIndex,this.item(i,t),t.parent=this,!0;if(n){var r=-1;return this.each(function(e){e.siblingIndex!==Number.MAX_VALUE&&(r=Math.max(e.siblingIndex,r))}),t.siblingIndex=r+1,t.parent=this,!0}return!1}},{key:"modifyBox",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0!==t){var i=J.get(e);i&&(null===t?this._boxReset[i]=1:(this._boxAdjustment[i]+=t,!n&&this._boxAdjustment[i]<0&&(this._boxAdjustment[i]=0)))}}},{key:"valueBox",value:function(e){var t=J.get(e);return t?[this._boxReset[t],this._boxAdjustment[t]]:[0,0]}},{key:"resetBox",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Array.from(J.keys()),s=function(e,s,a){var h=0,c=Array.from(J.values()).slice(e,s),l=Array.isArray(c),o=0;for(c=l?c:c[Symbol.iterator]();;){var u;if(l){if(o>=c.length)break;u=c[o++]}else{if((o=c.next()).done)break;u=o.value}if(n._boxReset[u]=1,t){var f=J.get(a?r[h]:r[h+4]);f&&t.modifyBox(i?r[h]:r[h+4],n[f])}h++}};_.hasBit(e,30)&&s(0,4,!0),_.hasBit(e,480)&&s(4,8,!1)}},{key:"inheritBox",value:function(e,t){var n=this,i=Array.from(J.keys()),r=function(e,r,s){var a=s?0:4,h=Array.from(J.values()).slice(e,r),c=Array.isArray(h),l=0;for(h=c?h:h[Symbol.iterator]();;){var o;if(c){if(l>=h.length)break;o=h[l++]}else{if((l=h.next()).done)break;o=l.value}var u=o;n._boxAdjustment[u]>0&&(t.modifyBox(i[a],n._boxAdjustment[u],!1),n._boxAdjustment[u]=0),a++}};_.hasBit(e,30)&&r(0,4,!0),_.hasBit(e,480)&&r(4,8,!1)}},{key:"previousSiblings",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=null,r=[];if(this._element)i=this._element.previousSibling;else if(this._initial.children.length){var s=this._initial.children.filter(function(e){return e.pageFlow});i=s.length?s[0].element.previousSibling:null}for(;i;){var a=m.getElementAsNode(i);if(a)if(e&&a.lineBreak||t&&a.excluded)r.push(a);else if(!a.excluded&&a.pageFlow&&(r.push(a),!n||a.visible&&!a.floating))break;i=i.previousSibling}return r}},{key:"nextSiblings",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=null,r=[];if(this._element)i=this._element.nextSibling;else if(this._initial.children.length){var s=this._initial.children.filter(function(e){return e.pageFlow});i=s.length?s[0].element.nextSibling:null}for(;i;){var a=m.getElementAsNode(i);if(a)if(e&&a.lineBreak||t&&a.excluded)r.push(a);else if(!a.excluded&&a.pageFlow&&(r.push(a),!n||a.visible&&!a.floating))break;i=i.nextSibling}return r}},{key:"actualRight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"linear";return(this.companion&&!this.companion.visible&&this.companion[e].right>this[e].right?this.companion:this)[e].right}},{key:"setDimensions",value:function(e){var t=this.unsafe(e);if(t){if(t.width=this.bounds.width,t.height=t.bottom-t.top,this.styleElement)switch(e){case"linear":t.width+=(this.marginLeft>0?this.marginLeft:0)+this.marginRight;break;case"box":t.width-=this.contentBoxWidth}void 0===this._initial[e]&&(this._initial[e]=m.assignBounds(t))}}},{key:"convertPosition",value:function(e){var t=0;if(!this.positionStatic){var n=this.cssInitial(e);(_.isUnit(n)||_.isPercent(n))&&(t=_.convertInt(this.percentValue(e,n,"left"===e||"right"===e)))}return t}},{key:"convertBox",value:function(e,t){var n=e+t;return _.convertInt(this.percentValue(n,this.css(n),"Left"===t||"Right"===t))}},{key:"percentValue",value:function(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return _.isPercent(t)?_.isUnit(this.style[e])?this.style[e]:this.convertPercent(t,n,i):t}},{key:"parent",set:function(e){e&&(e!==this._parent&&(this._parent&&this._parent.remove(this),this._parent=e),e.contains(this)||e.append(this),-1===this.depth&&(this.depth=e.depth+1))},get:function(){return this._parent}},{key:"tagName",set:function(e){this._cached.tagName=e.toUpperCase()},get:function(){if(void 0===this._cached.tagName){var e=this._element,t="";e&&(this.styleElement?t=("INPUT"===e.tagName?e.type:e.tagName).toUpperCase():"#text"===e.nodeName&&(t="PLAINTEXT")),this._cached.tagName=t}return this._cached.tagName}},{key:"element",get:function(){if(this._element)return this._element;var e=m.createElement(null,this.block);return m.setElementCache(e,"node",this),e}},{key:"baseElement",get:function(){return this._element}},{key:"htmlElement",get:function(){return this._element instanceof HTMLElement&&("none"!==this.display||""!==this._element.innerHTML)}},{key:"svgElement",get:function(){return this._element instanceof SVGSVGElement}},{key:"styleElement",get:function(){return m.hasComputedStyle(this._element)}},{key:"naturalElement",get:function(){return this.styleElement&&("none"!==this.display||""!==this.element.innerHTML)||this.plainText}},{key:"imageElement",get:function(){return"IMG"===this.tagName}},{key:"flexElement",get:function(){return"flex"===this.display||"inline-flex"===this.display}},{key:"gridElement",get:function(){return"grid"===this.display}},{key:"textElement",get:function(){return this.plainText||this.inlineText}},{key:"tableElement",get:function(){return"TABLE"===this.tagName||"table"===this.display}},{key:"groupParent",get:function(){return!1}},{key:"plainText",get:function(){return"PLAINTEXT"===this.tagName}},{key:"lineBreak",get:function(){return"BR"===this.tagName}},{key:"documentBody",get:function(){return this._element===document.body}},{key:"bounds",get:function(){return this._bounds||m.newRectDimensions()}},{key:"linear",get:function(){if(void 0===this._linear&&this._bounds){if(this._element){var e=this._bounds;this._linear={top:e.top-(this.marginTop>0?this.marginTop:0),right:e.right+this.marginRight,bottom:e.bottom+this.marginBottom,left:e.left-(this.marginLeft>0?this.marginLeft:0),width:0,height:0}}else this._linear=m.assignBounds(this._bounds);this.setDimensions("linear")}return this._linear||m.newRectDimensions()}},{key:"box",get:function(){if(void 0===this._box&&this._bounds){if(this._element){var e=this._bounds;this._box={top:e.top+(this.paddingTop+this.borderTopWidth),right:e.right-(this.paddingRight+this.borderRightWidth),bottom:e.bottom-(this.paddingBottom+this.borderBottomWidth),left:e.left+(this.paddingLeft+this.borderLeftWidth),width:0,height:0}}else this._box=m.assignBounds(this._bounds);this.setDimensions("box")}return this._box||m.newRectDimensions()}},{key:"renderAs",set:function(e){this.rendered||!e||e.rendered||(this._renderAs=e)},get:function(){return this._renderAs}},{key:"renderDepth",set:function(e){this._renderDepth=e},get:function(){return-1!==this._renderDepth?this._renderDepth:0}},{key:"dataset",get:function(){return this._element instanceof HTMLElement?this._element.dataset:{}}},{key:"excludeSection",get:function(){return this._excludeSection}},{key:"excludeProcedure",get:function(){return this._excludeProcedure}},{key:"excludeResource",get:function(){return this._excludeResource}},{key:"extensions",get:function(){return this.dataset.use?this.dataset.use.split(",").map(function(e){return e.trim()}).filter(function(e){return e}):[]}},{key:"flexbox",get:function(){if(void 0===this._cached.flexbox){var e=this.actualParent;this._cached.flexbox={order:_.convertInt(this.css("order")),wrap:this.css("flexWrap"),direction:this.css("flexDirection"),alignSelf:!this.has("alignSelf")&&e&&e.has("alignItems")?e.css("alignItems"):this.css("alignSelf"),justifyContent:this.css("justifyContent"),basis:this.css("flexBasis"),grow:_.convertInt(this.css("flexGrow")),shrink:_.convertInt(this.css("flexShrink"))}}return this._cached.flexbox}},{key:"width",get:function(){if(void 0===this._cached.width){for(var e=0,t=[this._styleMap.width,this._styleMap.minWidth],n=0;n<t.length;n++){var i=t[n];if((_.isUnit(i)||_.isPercent(i))&&(e=_.convertInt(this.convertPX(i)))>0)break}this._cached.width=e}return this._cached.width}},{key:"height",get:function(){if(void 0===this._cached.height){for(var e=0,t=[this._styleMap.height,this._styleMap.minHeight],n=0;n<t.length;n++){var i=t[n];if((_.isUnit(i)||this.hasHeight&&_.isPercent(i))&&(e=_.convertInt(this.convertPX(i,!0)))>0)break}this._cached.height=e}return this._cached.height}},{key:"hasWidth",get:function(){var e=this;if(void 0===this._cached.hasWidth){var t=this.cssInitial("width",!0);this._cached.hasWidth=!e.inlineStatic&&(_.isPercent(t)?"0%"!==t:!!(_.isUnit(t)&&"0px"!==t||e.toInt("minWidth")>0))}return this._cached.hasWidth}},{key:"hasHeight",get:function(){var e=this;if(void 0===this._cached.hasHeight){var t=this.cssInitial("height",!0);this._cached.hasHeight=function(){if(e.inlineStatic)return!1;if(_.isPercent(t)){var n=e.actualParent;if(n&&n.hasHeight)return"0%"!==t}else if(_.isUnit(t)&&"0px"!==t||e.toInt("minHeight")>0)return!0;return!1}()}return this._cached.hasHeight}},{key:"lineHeight",get:function(){return void 0===this._cached.lineHeight&&(this._cached.lineHeight=this.textElement||0===this.length?this.toInt("lineHeight"):_.convertInt(this.cssParent("lineHeight",!0))),this._cached.lineHeight}},{key:"display",get:function(){return this.css("display")}},{key:"position",get:function(){return this.css("position")}},{key:"positionStatic",get:function(){var e=this;return void 0===this._cached.positionStatic&&(this._cached.positionStatic=function(){switch(e.position){case"fixed":case"absolute":return!1;case"sticky":case"relative":return 0===e.toInt("top")&&0===e.toInt("right")&&0===e.toInt("bottom")&&0===e.toInt("left");case"inherit":var t=e.actualParent;return!!t&&!("absolute"===t.position||"fixed"===t.position);default:return!0}}()),this._cached.positionStatic}},{key:"positionRelative",get:function(){var e=this.position;return"relative"===e||"sticky"===e}},{key:"positionAuto",get:function(){if(void 0===this._cached.positionAuto){var e=-1===this._initial.iteration?this._styleMap:this._initial.styleMap;this._cached.positionAuto=!(this.pageFlow||"auto"!==e.top&&e.top||"auto"!==e.right&&e.right||"auto"!==e.bottom&&e.bottom||"auto"!==e.left&&e.left)}return this._cached.positionAuto}},{key:"top",get:function(){return void 0===this._cached.top&&(this._cached.top=this.convertPosition("top")),this._cached.top}},{key:"right",get:function(){return void 0===this._cached.right&&(this._cached.right=this.convertPosition("right")),this._cached.right}},{key:"bottom",get:function(){return void 0===this._cached.bottom&&(this._cached.bottom=this.convertPosition("bottom")),this._cached.bottom}},{key:"left",get:function(){return void 0===this._cached.left&&(this._cached.left=this.convertPosition("left")),this._cached.left}},{key:"marginTop",get:function(){return void 0===this._cached.marginTop&&(this._cached.marginTop=this.inlineStatic&&!this.baselineActive?0:this.convertBox("margin","Top")),this._cached.marginTop}},{key:"marginRight",get:function(){return void 0===this._cached.marginRight&&(this._cached.marginRight=this.convertBox("margin","Right")),this._cached.marginRight}},{key:"marginBottom",get:function(){return void 0===this._cached.marginBottom&&(this._cached.marginBottom=this.inlineStatic&&!this.baselineActive?0:this.convertBox("margin","Bottom")),this._cached.marginBottom}},{key:"marginLeft",get:function(){return void 0===this._cached.marginLeft&&(this._cached.marginLeft=this.convertBox("margin","Left")),this._cached.marginLeft}},{key:"borderTopWidth",get:function(){return"none"!==this.css("borderTopStyle")?_.convertInt(this.css("borderTopWidth")):0}},{key:"borderRightWidth",get:function(){return"none"!==this.css("borderRightStyle")?_.convertInt(this.css("borderRightWidth")):0}},{key:"borderBottomWidth",get:function(){return"none"!==this.css("borderBottomStyle")?_.convertInt(this.css("borderBottomWidth")):0}},{key:"borderLeftWidth",get:function(){return"none"!==this.css("borderLeftStyle")?_.convertInt(this.css("borderLeftWidth")):0}},{key:"paddingTop",get:function(){return void 0===this._cached.paddingTop&&(this._cached.paddingTop=this.convertBox("padding","Top")),this._cached.paddingTop}},{key:"paddingRight",get:function(){return void 0===this._cached.paddingRight&&(this._cached.paddingRight=this.convertBox("padding","Right")),this._cached.paddingRight}},{key:"paddingBottom",get:function(){return void 0===this._cached.paddingBottom&&(this._cached.paddingBottom=this.convertBox("padding","Bottom")),this._cached.paddingBottom}},{key:"paddingLeft",get:function(){return void 0===this._cached.paddingLeft&&(this._cached.paddingLeft=this.convertBox("padding","Left")),this._cached.paddingLeft}},{key:"contentBoxWidth",get:function(){return this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderLeftWidth+this.paddingLeft+this.paddingRight+this.borderRightWidth}},{key:"contentBoxHeight",get:function(){return this.tableElement&&"collapse"===this.css("borderCollapse")?0:this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth}},{key:"inline",get:function(){if(void 0===this._cached.inline){var e=this.display;this._cached.inline="inline"===e||("initial"===e||"unset"===e)&&m.ELEMENT_INLINE.includes(this.tagName)}return this._cached.inline}},{key:"inlineStatic",get:function(){return void 0===this._cached.inlineStatic&&(this._cached.inlineStatic=this.inline&&!this.floating&&!this.imageElement),this._cached.inlineStatic}},{key:"inlineVertical",get:function(){if(void 0===this._cached.inlineVertical){var e=this.display;this._cached.inlineVertical=(e.startsWith("inline")||"table-cell"===e)&&!this.floating&&!this.plainText}return this._cached.inlineVertical}},{key:"inlineText",get:function(){if(void 0===this._cached.inlineText){var e=this._element,t=!1;if(e)switch(e.tagName){case"INPUT":case"BUTTON":case"IMG":case"SELECT":case"TEXTAREA":break;default:t=this.htmlElement&&m.hasFreeFormText(e)&&(0===e.children.length||Array.from(e.children).every(function(e){var t=m.getElementAsNode(e);return!(t&&!t.excluded||m.hasComputedStyle(e)&&_.hasValue(e.dataset.use))}))}this._cached.inlineText=t}return this._cached.inlineText}},{key:"block",get:function(){if(void 0===this._cached.block){var e=this.display;this._cached.block="block"===e||"list-item"===e||"initial"===e&&m.ELEMENT_BLOCK.includes(this.tagName)}return this._cached.block}},{key:"blockStatic",get:function(){return void 0===this._cached.blockStatic&&(this._cached.blockStatic=this.block&&this.pageFlow&&(!this.floating||"100%"===this.cssInitial("width"))),this._cached.blockStatic}},{key:"blockDimension",get:function(){if(void 0===this._cached.blockDimension){var e=this.display;this._cached.blockDimension=this.block||"inline-block"===e||"table-cell"===e}return this._cached.blockDimension}},{key:"pageFlow",get:function(){return void 0===this._cached.pageFlow&&(this._cached.pageFlow=this.positionStatic||this.positionRelative),this._cached.pageFlow}},{key:"inlineFlow",get:function(){if(void 0===this._cached.inlineFlow){var e=this.display;this._cached.inlineFlow=this.inline||e.startsWith("inline")||"table-cell"===e||this.imageElement||this.floating}return this._cached.inlineFlow}},{key:"rightAligned",get:function(){return void 0===this._cached.rightAligned&&(this._cached.rightAligned="right"===this.float||this.autoMargin.left||this.inlineVertical&&"right"===this.cssParent("textAlign",!0)||!this.pageFlow&&this.has("right")),this._cached.rightAligned||this.hasAlign(512)}},{key:"bottomAligned",get:function(){return void 0===this._cached.bottomAligned&&(this._cached.bottomAligned=!this.pageFlow&&this.has("bottom")&&this.bottom>=0),this._cached.bottomAligned}},{key:"autoMargin",get:function(){if(void 0===this._cached.autoMargin)if(!this.pageFlow||this.blockStatic||"table"===this.display){var e=-1===this._initial.iteration?this._styleMap:this._initial.styleMap,t="auto"===e.marginLeft&&(!!this.pageFlow||this.has("right")),n="auto"===e.marginRight&&(!!this.pageFlow||this.has("left")),i="auto"===e.marginTop&&(!!this.pageFlow||this.has("bottom")),r="auto"===e.marginBottom&&(!!this.pageFlow||this.has("top"));this._cached.autoMargin={horizontal:t||n,left:t&&!n,right:!t&&n,leftRight:t&&n,vertical:i||r,top:i&&!r,bottom:!i&&r,topBottom:i&&r}}else this._cached.autoMargin={horizontal:!1,left:!1,right:!1,leftRight:!1,top:!1,bottom:!1,vertical:!1,topBottom:!1};return this._cached.autoMargin}},{key:"floating",get:function(){if(void 0===this._cached.floating)if(this.pageFlow){var e=this.css("cssFloat");this._cached.floating="left"===e||"right"===e}else this._cached.floating=!1;return this._cached.floating}},{key:"float",get:function(){return void 0===this._cached.float&&(this._cached.float=this.floating?this.css("cssFloat"):"none"),this._cached.float}},{key:"zIndex",get:function(){return this.toInt("zIndex")}},{key:"textContent",get:function(){if(void 0===this._cached.textContent){var e=this._element,t="";e&&(e instanceof HTMLElement?t=e.textContent||e.innerText:this.plainText&&(t=e.textContent||"")),this._cached.textContent=t}return this._cached.textContent}},{key:"overflow",set:function(e){0!==e&&16!==e&&8!==e&&24!==e||(this._cached.overflow=e)},get:function(){if(void 0===this._cached.overflow){var e=[this.css("overflow"),this.css("overflowX"),this.css("overflowY")],t=e[0],n=e[1],i=e[2],r=this._element,s=0;this.hasWidth&&("scroll"===t||"scroll"===n||"auto"===n&&r&&r.clientWidth!==r.scrollWidth)&&(s|=8),this.hasHeight&&("scroll"===t||"scroll"===i||"auto"===i&&r&&r.clientHeight!==r.scrollHeight)&&(s|=16),this._cached.overflow=s}return this._cached.overflow}},{key:"overflowX",get:function(){return _.hasBit(this.overflow,8)}},{key:"overflowY",get:function(){return _.hasBit(this.overflow,16)}},{key:"baseline",get:function(){if(void 0===this._cached.baseline){var e=this.verticalAlign,t=this.cssInitial("verticalAlign");this._cached.baseline=this.pageFlow&&!this.floating&&!this.svgElement&&("baseline"===e||"initial"===e||_.isUnit(t)&&0===parseInt(t))}return this._cached.baseline}},{key:"verticalAlign",get:function(){return this.css("verticalAlign")}},{key:"multiLine",set:function(e){this._cached.multiLine=e},get:function(){return void 0===this._cached.multiLine&&(this._cached.multiLine=this.plainText||this.inlineFlow&&this.inlineText?m.getRangeClientRect(this._element).multiLine:0),this._cached.multiLine}},{key:"visibleStyle",get:function(){if(void 0===this._cached.visibleStyle){var e=this.borderTopWidth>0||this.borderRightWidth>0||this.borderBottomWidth>0||this.borderLeftWidth>0,t=_.REGEX_PATTERN.CSS_URL.test(this.css("backgroundImage"))||_.REGEX_PATTERN.CSS_URL.test(this.css("background")),n=this.has("backgroundColor"),i=this.css("backgroundRepeat"),r=this.paddingLeft+this.paddingRight>0,s=this.paddingTop+this.paddingBottom>0;this._cached.visibleStyle={padding:r||s,paddingHorizontal:r,paddingVertical:s,background:e||t||n,borderWidth:e,backgroundImage:t,backgroundColor:n,backgroundRepeat:"no-repeat"!==i,backgroundRepeatX:"repeat"===i||"repeat-x"===i||i.startsWith("repeat "),backgroundRepeatY:"repeat"===i||"repeat-y"===i||i.endsWith(" repeat")}}return this._cached.visibleStyle}},{key:"preserveWhiteSpace",get:function(){if(void 0===this._cached.preserveWhiteSpace){var e=this.css("whiteSpace");this._cached.preserveWhiteSpace="pre"===e||"pre-wrap"===e}return this._cached.preserveWhiteSpace}},{key:"layoutHorizontal",get:function(){return this.hasAlign(8)}},{key:"layoutVertical",get:function(){return this.hasAlign(16)}},{key:"controlName",set:function(e){this.rendered&&void 0!==this._controlName||(this._controlName=e)},get:function(){return this._controlName||""}},{key:"documentParent",set:function(e){this._documentParent=e},get:function(){return this._documentParent||this.actualParent||this.parent||this}},{key:"absoluteParent",get:function(){var e=this.actualParent;if(!this.pageFlow)for(;e&&0!==e.id;){var t=e.cssInitial("position",!1,!0);if(e.documentBody||"static"!==t&&"initial"!==t&&"unset"!==t)return e;e=e.actualParent}return e}},{key:"renderParent",set:function(e){e&&(e!==this&&-1===e.renderChildren.indexOf(this)&&e.renderChildren.push(this),this._renderParent=e)},get:function(){return this._renderParent}},{key:"renderPositionId",set:function(e){this._renderPositionId=e},get:function(){return this._renderPositionId||this.id+(-1!==this.renderPosition?"^".concat(this.renderPosition):"")}},{key:"actualParent",get:function(){return this.baseElement&&this.baseElement.parentElement?m.getElementAsNode(this.baseElement.parentElement):void 0}},{key:"actualChildren",get:function(){return void 0===this._cached.actualChildren&&(this._cached.actualChildren=this.htmlElement?_.flatMap(Array.from(this.element.childNodes),function(e){return m.getElementAsNode(e)}):this.groupParent?this._initial.children.slice():[]),this._cached.actualChildren}},{key:"actualHeight",get:function(){return this.plainText?this.bounds.bottom-this.bounds.top:this.bounds.height}},{key:"firstChild",get:function(){var e=this._element;if(e)for(var t=0;t<e.childNodes.length;t++){var n=m.getElementAsNode(e.childNodes[t]);if(n)return n}}},{key:"lastChild",get:function(){var e=this._element;if(e)for(var t=e.childNodes.length-1;t>=0;t--){var n=m.getElementAsNode(e.childNodes[t]);if(n)return n}}},{key:"dir",get:function(){if(void 0===this._cached.dir)switch(this._cached.dir=this.css("direction"),this._cached.dir){case"unset":case"inherit":for(var e=this.actualParent;e&&0!==e.id;){var t=e.dir;if(""!==t){this._cached.dir=t;break}e=e.actualParent}this._cached.dir=document.body.dir}return this._cached.dir}},{key:"nodes",get:function(){return this.rendered?this.renderChildren:this.children}},{key:"center",get:function(){return{x:this.bounds.left+Math.floor(this.bounds.width/2),y:this.bounds.top+Math.floor(this.actualHeight/2)}}}]),n}(),te=squared.lib.dom,ne=function(e){function t(){return r(this,t),u(this,l(t).apply(this,arguments))}return c(t,ee),a(t,[{key:"init",value:function(){if(this.length){for(var e=Number.MAX_VALUE,t=Array.isArray(i=this.children),n=0,i=t?i:i[Symbol.iterator]();;){var r;if(t){if(n>=i.length)break;r=i[n++]}else{if((n=i.next()).done)break;r=n.value}var s=r;e=Math.min(e,s.siblingIndex),s.parent=this}this.siblingIndex===Number.MAX_VALUE&&(this.siblingIndex=e),this.parent&&this.parent.sort(B.siblingIndex),this.setBounds();var a=this.actualParent;a&&this.css("direction",a.dir),this.saveAsInitial()}}},{key:"setBounds",value:function(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this.length){var e=this.outerRegion;this._bounds=Object.assign({width:e.right-e.left,height:e.bottom-e.top},e)}}},{key:"previousSiblings",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.item(0);return i?i.previousSiblings(e,t,n):[]}},{key:"nextSiblings",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.item();return i?i.nextSiblings(e,t,n):[]}},{key:"actualParent",get:function(){return B.actualParent(this._initial.children)}},{key:"firstChild",get:function(){var e=B.actualParent(this.nodes);if(e)for(var t=e.element,n=0;n<e.element.childNodes.length;n++){var i=te.getElementAsNode(t.childNodes[n]);if(i&&this.nodes.includes(i))return i}if(this._initial.children.length)return this._initial.children[0]}},{key:"lastChild",get:function(){var e=B.actualParent(this.nodes);if(e)for(var t=e.element,n=e.element.childNodes.length-1;n>=0;n--){var i=te.getElementAsNode(t.childNodes[n]);if(i&&this.nodes.includes(i))return i}if(this._initial.children.length)return this._initial.children[this._initial.children.length-1]}},{key:"inline",get:function(){return this.every(function(e){return e.inline})}},{key:"pageFlow",get:function(){return this.every(function(e){return e.pageFlow})}},{key:"inlineFlow",get:function(){return this.inlineStatic||this.hasAlign(128)}},{key:"inlineStatic",get:function(){return this.every(function(e){return e.inlineStatic})}},{key:"inlineVertical",get:function(){return this.every(function(e){return e.inlineVertical})}},{key:"block",get:function(){return this.some(function(e){return e.block})}},{key:"blockStatic",get:function(){return this.some(function(e){return e.blockStatic})}},{key:"blockDimension",get:function(){return this.some(function(e){return e.blockDimension})}},{key:"floating",get:function(){return this.every(function(e){return e.floating})}},{key:"float",get:function(){return this.floating?this.hasAlign(512)?"right":"left":"none"}},{key:"baseline",get:function(){var e=this.cssInitial("verticalAlign",!0);return""!==e?"baseline"===e:this.every(function(e){return e.baseline})}},{key:"multiLine",get:function(){return this.children.reduce(function(e,t){return e+t.multiLine},0)}},{key:"display",get:function(){return this.css("display")||this.some(function(e){return e.block})?"block":this.some(function(e){return e.blockDimension})?"inline-block":"inline"}},{key:"element",get:function(){var e=this.cascade(!0);return e.length?e[0].element:g(l(t.prototype),"element",this)}},{key:"groupParent",get:function(){return!0}},{key:"outerRegion",get:function(){var e=this.children.slice(),t=e[0],n=t,i=t,r=t;this.each(function(t){return t.companion&&!t.companion.visible&&e.push(t.companion)});for(var s=1;s<e.length;s++){var a=e[s];a.linear.top<t.linear.top&&(t=a),a.linear.right>n.linear.right&&(n=a),a.linear.bottom>i.linear.bottom&&(i=a),a.linear.left<r.linear.left&&(r=a)}return{top:t.linear.top,right:n.linear.right,bottom:i.linear.bottom,left:r.linear.left}}}]),t}(),ie=squared.lib.dom,re=squared.lib.util,se=function(e){function t(){return r(this,t),u(this,l(t).apply(this,arguments))}return c(t,M),a(t,[{key:"afterInit",value:function(){for(var e=this,t=function(){if(n){if(i>=r.length)return"break";s=r[i++]}else{if((i=r.next()).done)return"break";s=i.value}var t=s,a=t.baseElement;if(a instanceof HTMLInputElement&&!t.hasBit("excludeProcedure",A.ACCESSIBILITY))switch(a.type){case"radio":case"checkbox":[ie.getPreviousElementSibling(a),ie.getNextElementSibling(a)].some(function(n){if(n){var i=ie.getElementAsNode(n),r=n.parentElement&&"LABEL"===n.parentElement.tagName?ie.getElementAsNode(n.parentElement):null;if(i&&i.visible&&i.pageFlow&&(re.hasValue(n.htmlFor)&&n.htmlFor===a.id?t.companion=i:i.textElement&&r&&(t.companion=i,r.renderAs=t),t.companion))return e.options&&!e.options.showLabel&&i.hide(),!0}return!1})}},n=Array.isArray(r=this.application.processing.cache.elements),i=0,r=n?r:r[Symbol.iterator]();;){var s;if("break"===t())break}}}]),t}(),ae=squared.lib.util,he="[\\d.]+[a-z%]+|auto|max-content|min-content",ce="minmax\\((.*?), (.*?)\\)",le="fit-content\\(([\\d.]+[a-z%]+)\\)",oe="repeat\\((auto-fit|auto-fill|[0-9]+), ((?:minmax|fit-content)\\(.*?\\)|.*?)\\)",ue="\\[([\\w\\-\\s]+)\\]",fe={UNIT:RegExp("^(".concat(he,")$")),NAMED:RegExp("\\s*(".concat(ue,"|").concat(oe,"|").concat(ce,"|").concat(le,"|").concat(he,")\\s*"),"g")},ge=function(e){function t(){return r(this,t),u(this,l(t).apply(this,arguments))}return c(t,M),a(t,[{key:"condition",value:function(e){return e.gridElement&&e.length>0}},{key:"processNode",value:function(e){var n=Object.assign(t.createDataAttribute(),{alignItems:e.css("alignItems"),alignContent:e.css("alignContent"),justifyItems:e.css("justifyItems"),justifyContent:e.css("justifyContent")}),i=e.css("gridAutoFlow"),r=-1!==i.indexOf("row"),s=-1!==i.indexOf("dense"),a=[],h=[],c=[],l={};function o(t){return ae.isUnit(t)?e.convertPX(t):t}if(n.row.gap=parseInt(e.convertPX(e.css("rowGap"),!1,!1)),n.column.gap=parseInt(e.convertPX(e.css("columnGap"),!0,!1)),[e.cssInitial("gridTemplateRows",!0),e.cssInitial("gridTemplateColumns",!0),e.css("gridAutoRows"),e.css("gridAutoColumns")].forEach(function(t,i){t&&"none"!==t&&"auto"!==t&&function(){for(var r,s=1;null!==(r=fe.NAMED.exec(t));)i<2?function(){var e=n[0===i?"row":"column"];if("["===r[1].charAt(0))void 0===e.name[r[2]]&&(e.name[r[2]]=[]),e.name[r[2]].push(s);else if(r[1].startsWith("minmax"))e.unit.push(o(r[6])),e.unitMin.push(o(r[5])),e.repeat.push(!1),s++;else if(r[1].startsWith("repeat")){var t=1;switch(r[3]){case"auto-fit":e.autoFit=!0;break;case"auto-fill":e.autoFill=!0;break;default:t=ae.convertInt(r[3])}if(r[4].startsWith("minmax"))for(var a,h=RegExp(ce,"g");null!==(a=h.exec(r[4]));)e.unit.push(o(a[2])),e.unitMin.push(o(a[1])),e.repeat.push(!0),s++;else if("["===r[4].charAt(0)){var c=r[4].split(" ");if(2===c.length){var l=c[0].substring(1,c[0].length-1);void 0===e.name[l]&&(e.name[l]=[]);for(var u=0;u<t;u++)e.name[l].push(s),e.unit.push(c[1]),e.unitMin.push(""),e.repeat.push(!0),s++}}else r[4].split(" ").forEach(function(n){if(fe.UNIT.test(n))for(var i=0;i<t;i++)e.unit.push(n),e.unitMin.push(""),e.repeat.push(!0),s++})}else fe.UNIT.test(r[1])&&(e.unit.push(o(r[1])),e.unitMin.push(""),e.repeat.push(!1),s++)}():n[2===i?"row":"column"].auto.push(e.convertPX(r[1]))}()}),e.cssSort("order"),!e.has("gridTemplateAreas")&&e.every(function(e){return"auto"===e.css("gridRowStart")&&"auto"===e.css("gridColumnStart")})){var u,f=r?["top","bottom"]:["left","right"],g=0,d=0,v=0;e.each(function(e,t){(void 0===u||e.linear[f[0]]>=u.linear[f[1]]||d>0&&d===v)&&(v=Math.max(d,v),g++,d=1);var i=e.css("gridRowEnd"),s=e.css("gridColumnEnd"),a=1,h=1;if(i.startsWith("span")?a=parseInt(i.split(" ")[1]):ae.isNumber(i)&&(a=parseInt(i)-g),s.startsWith("span")?h=parseInt(s.split(" ")[1]):ae.isNumber(s)&&(h=parseInt(s)-d),1===d&&v>0){var l=r?[2,1,3]:[3,0,2],o=!1;do{for(var p=Array(v-1).fill(1),y=0;y<c.length;y++){var k=c[y].placement;if(k[l[0]]>g)for(var b=k[l[1]];b<k[l[2]];b++)p[b-1]=0}for(var S=0,A=0,w=0;S<p.length;S++)if(p[S]){if(0===A&&(w=S),++A===h){d=w+1,o=!0;break}}else A=0;o||(n.emptyRows[g-1]=p,g++)}while(!o)}c[t]={placement:r?[g,d,g+a,d+h]:[d,g,d+h,g+a],rowSpan:a,columnSpan:h},d+=h,u=e})}else e.css("gridTemplateAreas").split(/"[\s\n]+"/).map(function(e){return ae.trimString(e.trim(),'"')}).forEach(function(e,t){e.split(" ").forEach(function(e,i){"."!==e&&(void 0===n.templateAreas[e]?n.templateAreas[e]={rowStart:t,rowSpan:1,columnStart:i,columnSpan:1}:(n.templateAreas[e].rowSpan=t-n.templateAreas[e].rowStart+1,n.templateAreas[e].columnSpan++))})}),e.each(function(e,t){for(var i=[e.css("gridRowStart"),e.css("gridColumnStart"),e.css("gridRowEnd"),e.css("gridColumnEnd")],r=[],s=1,a=1,h=0;h<i.length;h++){var l=i[h],o=n.templateAreas[l];if(void 0===o){var u=/^([\w\-]+)-(start|end)$/.exec(l);if(u&&(o=n.templateAreas[u[1]]))if("start"===u[2])switch(h){case 0:case 2:r[h]=o.rowStart+1;break;case 1:case 3:r[h]=o.columnStart+1}else switch(h){case 0:case 2:r[h]=o.rowStart+o.rowSpan+1;break;case 1:case 3:r[h]=o.columnStart+o.columnSpan+1}}else switch(h){case 0:r[h]=o.rowStart+1;break;case 1:r[h]=o.columnStart+1;break;case 2:r[h]=o.rowStart+o.rowSpan+1;break;case 3:r[h]=o.columnStart+o.columnSpan+1}}if(r.filter(function(e){return e}).length<4)for(var f=function(e,t){if(ae.isNumber(e))return r[t]=parseInt(e),!0;if(e.startsWith("span")){var n=parseInt(e.split(" ")[1]);return r[t-2]?r[t]=r[t-2]+n:t%2==0?s=n:a=n,!0}return!1},g=0;g<i.length;g++){var d=i[g];if("auto"!==d&&!r[g]&&!f(d,g)){var v=n[g%2==0?"row":"column"],p=d.split(" ");1===p.length&&(p[1]=p[0],p[0]="1");var y=parseInt(p[0]);if(v.name[p[1]]){var k=v.name[p[1]].length;y<=k?r[g]=v.name[p[1]][y-1]+(p[1]===i[g-2]?1:0):v.autoFill&&y>k&&(r[g]=y+(p[1]===i[g-2]?1:0))}}r[g]||f(d,g)}c[t]={placement:r,rowSpan:s,columnSpan:a}});var p=n[r?"column":"row"];p.count=Math.max(p.unit.length,1);for(var y=0;y<c.length;y++){var k=c[y];k&&(p.count=ae.maxArray([p.count,r?k.columnSpan:k.rowSpan,k.placement[r?1:0]||0,(k.placement[r?3:2]||0)-1]))}if(p.autoFill||p.autoFit){var b=function(e){for(var t=[],n=[],i=0;i<e.length;i++)p.repeat[i]?n.push(e[i]):t.push(e[i]);for(var r=p.count-t.length,s=[],a=0;a<p.count;a++){if(p.repeat[a]){for(var h=0,c=0;h<r;a++,h++,c++)c===n.length&&(c=0),s[a]=n[c];break}t.length&&(s[a]=t.shift())}return s};0===p.unit.length&&(p.unit.push("auto"),p.unitMin.push(""),p.repeat.push(!0)),p.unit=b(p.unit),p.unitMin=b(p.unitMin)}if(e.each(function(e,t){for(var i=c[t],o=i.placement,u=r?i.rowSpan:i.columnSpan,f=r?i.columnSpan:i.rowSpan,g=r?n.column.count:n.row.count,d=r?0:1,v=r?1:0,p=r?2:3,y=r?3:2;!o[0]||!o[1];){var k=o.slice();if(!k[d])for(var b=a.length,S=0,A=0,w=-1;S<b;S++)if(!l[S])if(void 0===h[S]||h[S]<g){if(0===A&&(w=S,b=Math.max(b,S+u)),++A===u){k[d]=w+1;break}}else A=0,w=-1,b=a.length;if(k[d]){if(!k[v]){k[p]||(k[p]=k[d]+u);for(var T=[],E=k[d]-1;E<k[p]-1;E++)if(void 0===a[E])T.push([[0,-1]]);else{if(!(a[E].map(function(e){return e}).length+f<=g))break;for(var B=[],R=0,x=0,I=-1;x<g;x++)void 0===a[E][x]&&(-1===I&&(I=x),R++),(a[E][x]||x===g-1)&&(R>=f&&B.push([I,I+R]),I=-1,R=0);if(!B.length)break;T.push(B)}if(f===T.length)if(T.length>1)e:for(var C=Array.isArray(H=T[0]),L=0,H=C?H:H[Symbol.iterator]();;){var P;if(C){if(L>=H.length)break;P=H[L++]}else{if((L=H.next()).done)break;P=L.value}for(var O=P,D=O[0];D<O[1];D++)for(var V=1;V<T.length;V++)for(var q=0;q<T[V].length;q++){var W=T[V][q];if(D>=W[0]&&(-1===W[1]||D+f<=W[1])){k[v]=D+1;break e}}}else k[v]=T[0][0][0]+1}}else o[d]=a.length+1,o[v]||(o[v]=1);k[d]&&k[v]?(o[d]=k[d],o[v]=k[v]):k[d]&&(l[k[d]-1]=!0)}o[p]||(o[p]=o[d]+u),o[y]||(o[y]=o[v]+f),function(e,t){if(t.every(function(e){return e>0})){for(var n=t[r?0:1]-1;n<t[r?2:3]-1;n++){void 0===a[n]&&(a[n]=[]);for(var i=t[r?1:0]-1;i<t[r?3:2]-1;i++)void 0===h[n]&&(h[n]=0),void 0===a[n][i]&&(a[n][i]=[],h[n]++),a[n][i].push(e)}return!0}return!1}(e,o)&&(e.data(j.CSS_GRID,"cellData",{rowStart:o[0]-1,rowSpan:o[2]-o[0],columnStart:o[1]-1,columnSpan:o[3]-o[1]}),s&&(l={}))}),r)n.rowData=a;else for(var S=0;S<a.length;S++)for(var A=0;A<a[S].length;A++)void 0===n.rowData[A]&&(n.rowData[A]=[]),n.rowData[A][S]=a[S][A];if(n.rowData.length){for(var w=Array.isArray(E=n.rowData),T=0,E=w?E:E[Symbol.iterator]();;){var B;if(w){if(T>=E.length)break;B=E[T++]}else{if((T=E.next()).done)break;B=T.value}var R=B;n.column.count=Math.max(R.length,n.column.count);for(var x=Array.isArray(C=R),I=0,C=x?C:C[Symbol.iterator]();;){var L;if(x){if(I>=C.length)break;L=C[I++]}else{if((I=C.next()).done)break;L=I.value}L&&L.forEach(function(e){return n.children.add(e)})}}n.children.size===e.length&&function(){n.row.count=n.rowData.length;for(var t=new Set,i=function(e){for(var i=function(i){var r=n.rowData[e][i];r&&r.forEach(function(r){if(r&&!t.has(r)){var s=r.data(j.CSS_GRID,"cellData"),a=e+(s?s.rowSpan-1:0);i+(s?s.columnSpan-1:0)<n.column.count-1&&r.modifyBox(4,n.column.gap),a<n.row.count-1&&r.modifyBox(8,n.row.gap),t.add(r)}})},r=0;r<n.column.count;r++)i(r)},r=0;r<n.row.count;r++)i(r);e.retain(Array.from(n.children)),e.cssSort("zIndex"),e.data(j.CSS_GRID,"mainData",n)}()}return{output:""}}}],[{key:"createDataAttribute",value:function(){return{children:new Set,rowData:[],templateAreas:{},row:t.createDataRowAttribute(),column:t.createDataRowAttribute(),emptyRows:[],alignItems:"",alignContent:"",justifyItems:"",justifyContent:""}}},{key:"createDataRowAttribute",value:function(){return{count:0,gap:0,unit:[],unitMin:[],repeat:[],auto:[],autoFill:!1,autoFit:!1,name:{},normal:!0}}}]),t}(),de=squared.lib.util,ve=function(e){function t(){return r(this,t),u(this,l(t).apply(this,arguments))}return c(t,M),a(t,[{key:"condition",value:function(e){return e.flexElement&&e.length>0}},{key:"processNode",value:function(e){var n=this.application.controllerHandler,i=e.children.filter(function(e){return e.pageFlow}),r=e.flexbox,s=Object.assign(t.createDataAttribute(i),{wrap:r.wrap.startsWith("wrap"),wrapReverse:"wrap-reverse"===r.wrap,directionReverse:r.direction.endsWith("reverse"),justifyContent:r.justifyContent,rowDirection:r.direction.startsWith("row"),columnDirection:r.direction.startsWith("column")});if(e.cssTry("display","block")){for(var a=Array.isArray(c=i),h=0,c=a?c:c[Symbol.iterator]();;){var l;if(a){if(h>=c.length)break;l=c[h++]}else{if((h=c.next()).done)break;l=h.value}var o=l,u=o.element.getBoundingClientRect(),f=o.unsafe("initial");Object.assign(f.bounds,{width:u.width,height:u.height})}e.cssFinally("display")}if(s.wrap){var g=function(t,r,a){var h=new Map;i.sort(function(e,n){return e.linear[t]<n.linear[t]?e.linear[t]<n.linear[t]?-1:1:e.linear[r]<n.linear[r]?-1:1});for(var c=Array.isArray(o=i),l=0,o=c?o:o[Symbol.iterator]();;){var u;if(c){if(l>=o.length)break;u=o[l++]}else{if((l=o.next()).done)break;u=l.value}var f=u,g=Math.round(f.linear[t]),d=h.get(g)||[];d.push(f),h.set(g,d)}if(h.size){var v=0;Array.from(h.values()).forEach(function(t,i){var r=n.createNodeGroup(t[0],t,e);r.siblingIndex=i;var s=r.unsafe("box");s&&(s[a]=e.box[a]),r.alignmentType|=128,v=Math.max(t.length,v)}),e.sort(B.siblingIndex),s.rowDirection?(s.rowCount=h.size,s.columnCount=v):(s.rowCount=v,s.columnCount=h.size)}};s.rowDirection?g(s.wrapReverse?"bottom":"top","left","right"):g("left","top","bottom")}else i.some(function(e){return 0!==e.flexbox.order})&&(s.directionReverse?de.sortDesc(e.children,"flexbox.order"):de.sortAsc(e.children,"flexbox.order")),s.rowDirection?(s.rowCount=1,s.columnCount=e.length):(s.rowCount=e.length,s.columnCount=1);return e.data(j.FLEXBOX,"mainData",s),{output:""}}}],[{key:"createDataAttribute",value:function(e){return{wrap:!1,wrapReverse:!1,directionReverse:!1,justifyContent:"",rowDirection:!1,rowCount:0,columnDirection:!1,columnCount:0,children:e}}}]),t}(),pe=squared.lib.dom,ye=squared.lib.dom,ke=squared.lib.util,be=squared.lib.util;function Se(e){return e.visibleStyle.backgroundImage&&!e.visibleStyle.backgroundRepeat}var Ae=squared.lib.util,we=squared.lib.dom,Te=squared.lib.util,Ee=squared.lib.dom,Be=squared.lib.dom,Re=squared.lib.util,xe=squared.lib.util,Ie=squared.lib.dom,Ce=squared.lib.util;function Le(e,t){var n=e.has("minHeight",2)?e.toInt("minHeight"):0;e.css("minHeight",Ce.formatPX(Math.max(t,n)))}function He(e,t,n){!t.lineBreak&&!t.plainText&&t===e[n?"firstChild":"lastChild"]&&e[n?"marginTop":"marginBottom"]>0&&0===e[n?"borderTopWidth":"borderBottomWidth"]&&0===e[n?"paddingTop":"paddingBottom"]&&t.modifyBox(n?2:8,null)}var Pe={Accessibility:se,CssGrid:ge,External:function(e){function t(){return r(this,t),u(this,l(t).apply(this,arguments))}return c(t,M),a(t,[{key:"beforeInit",value:function(e){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1]||this.included(e))&&!pe.getElementCache(e,"squaredExternalDisplay")){for(var t=[],n=e;n;)t.push(pe.getStyle(n).display),n.style.display="block",n=n.parentElement;pe.setElementCache(e,"squaredExternalDisplay",t)}}},{key:"init",value:function(e){return this.included(e)&&this.application.parseElements.add(e),!1}},{key:"afterInit",value:function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||this.included(e)){var t=pe.getElementCache(e,"squaredExternalDisplay");if(t){for(var n=t,i=e,r=0;i;)i.style.display=n[r],i=i.parentElement,r++;pe.deleteElementCache(e,"squaredExternalDisplay")}}}}]),t}(),Flexbox:ve,Grid:function(e){function t(){var e;return r(this,t),(e=u(this,l(t).apply(this,arguments))).options={columnBalanceEqual:!1},e}return c(t,M),a(t,[{key:"condition",value:function(e){return e.length>1&&!e.flexElement&&!e.gridElement&&!e.has("listStyle")&&(e.every(function(e){return e.pageFlow&&!e.visibleStyle.background&&(!e.inlineFlow||e.blockStatic)})&&(e.some(function(e){return e.length>1})&&e.every(function(e){return e.length>0&&B.linearX(e.children)})||e.every(function(e){return"list-item"===e.display&&!e.has("listStyleType")}))||"table"===e.display&&e.every(function(e){return"table-row"===e.display&&e.every(function(e){return"table-cell"===e.display})}))}},{key:"processNode",value:function(e){var n=[],i=this.options.columnBalanceEqual,r=[];if(i){var s=[];e.each(function(e,t){s[t]=[],e.each(function(e){return s[t].push(e.bounds.width)}),r.push(e.duplicate())});var a=r[s.findIndex(function(e){return e===s.reduce(function(e,t){return e.length===t.length?e.reduce(function(e,t){return e+t},0)<t.reduce(function(e,t){return e+t},0)?e:t:e.length<t.length?e:t})})];if(a&&a.length>1)for(var h=[],c=!1,l=function(e){var t=a[e].bounds,n=[];if(e<a.length-1)for(var i=function(i){if(r[i]===a)n.push(e);else{var s=r[i].findIndex(function(n,s){return s>=e&&Math.floor(n.bounds.width)===Math.floor(t.width)&&s<r[i].length-1});if(-1===s)return n.length=0,"break";n.push(s)}},s=0;s<r.length;s++){if("break"===i(s))break}else for(s=0;s<r.length;s++)if(r[s].length>a.length){var l=r[s].splice(h[s]+(c?2:1),r[s].length-a.length);r[s][h[s]+(c?1:0)].data(j.GRID,"cellData",{siblings:v(l)})}if(n.length===r.length){var o=n.reduce(function(e,t){return Math.min(e,t)});if(n.reduce(function(e,t){return Math.max(e,t)})>o)for(var u=0;u<r.length;u++)if(n[u]>o){var f=r[u].splice(o,n[u]-o);r[u][h[u]+(c?1:0)].data(j.GRID,"cellData",{siblings:v(f)})}h=n,c=!0}else h=Array(r.length).fill(e),c=!1},o=0;o<a.length;o++)l(o);else r.length=0}else{for(var u=function(e){for(var t=0;t<r.length;t++){var n=r[t].findIndex(function(t){return ke.withinFraction(e.linear.top,t.linear.top)||e.linear.top>t.linear.top&&e.linear.top<t.linear.bottom});if(-1!==n)return n}return-1},f={},g=Array.isArray(p=e),d=0,p=g?p:p[Symbol.iterator]();;){var y;if(g){if(d>=p.length)break;y=p[d++]}else{if((d=p.next()).done)break;y=d.value}for(var k=Array.isArray(S=y),b=0,S=k?S:S[Symbol.iterator]();;){var A;if(k){if(b>=S.length)break;A=S[b++]}else{if((b=S.next()).done)break;A=b.value}var w=A,T=Math.floor(w.linear.left);void 0===f[T]&&(f[T]=[]),f[T].push(w)}}var E=Object.keys(f);if(E.length){var B=[];for(o=0;o<E.length;o++){var R=f[E[o]];if(0===o&&0===R.length)return{output:""};B[o]=0===o?0:B[o-1];for(var x=0;x<R.length;x++){var I=R[x],C=[I.linear.left,I.linear.right],L=C[0],H=C[1];if(0===o||L>=B[o-1])if(void 0===r[o]&&(r[o]=[]),0===o||r[0].length===R.length)r[o][x]=I;else{var P=u(I);if(-1===P)return{output:""};r[o][P]=I}else{var O=r.length-1;if(r[O]){var D=ke.minArray(r[O].map(function(e){return e.linear.left})),V=ke.maxArray(r[O].map(function(e){return e.linear.right}));if(L>D&&H>V){var q=r.filter(function(e){return e}),W=u(I);-1!==W&&void 0===q[q.length-1][W]&&(r[O].length=0)}}}B[o]=Math.max(H,B[o])}}for(var F=0,G=-1;F<B.length;F++)void 0===r[F]?-1===G?G=F-1:F===B.length-1&&(B[G]=B[F]):-1!==G&&(B[G]=B[F-1],G=-1);for(var N=(r=r.filter(function(e,t){return!!(e&&e.length>0)&&(n.push(B[t]),!0)})).reduce(function(e,t){return Math.max(e,t.length)},0),U=0;U<N;U++)for(var Y=0;Y<r.length;Y++)void 0===r[Y][U]&&(r[Y][U]={spacer:1})}n.push(e.box.right)}if(r.length>1&&r[0].length===e.length){var z=Object.assign(t.createDataAttribute(),{columnCount:i?r[0].length:r.length});e.duplicate().forEach(function(t){return e.remove(t)&&t.hide()});for(var M=0,Q=0;M<r.length;M++)for(var X=0,Z=function(s,a){var h=r[M][a];if(h.spacer)1===h.spacer&&X++;else{h.parent=e;var c=Object.assign(t.createDataCellAttribute(),h.data(j.GRID,"cellData")||{});if(i)c.rowStart=0===a,c.rowEnd=a===r[M].length-1,c.cellStart=0===M&&0===a,c.cellEnd=M===r.length-1&&c.rowEnd,c.index=a;else{for(var l,o=1,u=1+X,f=M+1;f<r.length&&1===r[f][a].spacer;f++)u++,r[f][a].spacer=2;if(1===u)for(var g=a+1;g<r[M].length&&1===r[M][g].spacer;g++)o++,r[M][g].spacer=2;var d=Math.min(M+(u-1),n.length-1);(l=c.siblings).push.apply(l,v(ke.flatMap(Array.from(h.documentParent.element.children),function(e){var t=ye.getElementAsNode(e);return J=s,t&&t.visible&&!t.rendered&&t.linear.left>=h.linear.right&&t.linear.right<=n[d]?t:null}))),c.rowSpan=o,c.columnSpan=u,c.rowStart=0==s++,c.rowEnd=u+M===r.length,c.cellStart=0==Q++,c.cellEnd=c.rowEnd&&a===r[M].length-1,c.index=M,X=0}h.data(j.GRID,"cellData",c)}J=s},K=0,J=0;K<r[M].length;K++)Z(J,K);ke.sortAsc(e.children,"documentParent.siblingIndex","siblingIndex"),e.each(function(e,t){return e.siblingIndex=t}),e.tableElement&&"collapse"===e.css("borderCollapse")&&(e.modifyBox(32,null),e.modifyBox(64,null),e.modifyBox(128,null),e.modifyBox(256,null)),e.data(j.GRID,"mainData",z)}return{output:""}}}],[{key:"createDataAttribute",value:function(){return{paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,columnCount:0}}},{key:"createDataCellAttribute",value:function(){return{rowSpan:0,columnSpan:0,index:-1,cellStart:!1,cellEnd:!1,rowEnd:!1,rowStart:!1,siblings:[]}}}]),t}(),List:function(e){function t(){return r(this,t),u(this,l(t).apply(this,arguments))}return c(t,M),a(t,[{key:"condition",value:function(e){return g(l(t.prototype),"condition",this).call(this,e)&&e.length>0&&(e.every(function(e){return e.blockStatic})||e.every(function(e){return e.inlineVertical})||e.every(function(e){return e.floating})&&1===B.floated(e.children).size||e.every(function(t,n){return!t.floating&&(0===n||n===e.length-1||t.blockStatic||t.inlineFlow&&e.item(n-1).blockStatic&&e.item(n+1).blockStatic)}))&&(e.some(function(e){return"list-item"===e.display&&("none"!==e.css("listStyleType")||Se(e))})||e.every(function(e){return"LI"!==e.tagName&&"none"===e.cssInitial("listStyleType")&&Se(e)}))}},{key:"processNode",value:function(e){var n=0;return e.each(function(e){var i=t.createDataAttribute();if("list-item"===e.display||e.has("listStyleType")||Se(e)){var r=e.css("listStyleImage");if(r&&"none"!==r)i.imageSrc=r;else switch(e.css("listStyleType")){case"disc":i.ordinal="●";break;case"square":i.ordinal="■";break;case"decimal":i.ordinal="".concat(""+(n+1),".");break;case"decimal-leading-zero":i.ordinal="".concat((n<9?"0":"")+(n+1),".");break;case"lower-alpha":case"lower-latin":i.ordinal="".concat(be.convertAlpha(n).toLowerCase(),".");break;case"upper-alpha":case"upper-latin":i.ordinal="".concat(be.convertAlpha(n),".");break;case"lower-roman":i.ordinal="".concat(be.convertRoman(n+1).toLowerCase(),".");break;case"upper-roman":i.ordinal="".concat(be.convertRoman(n+1),".");break;case"none":r="";var s="";e.visibleStyle.backgroundRepeat||(r=e.css("backgroundImage"),s=e.css("backgroundPosition")),r&&"none"!==r&&(i.imageSrc=r,i.imagePosition=s,e.exclude({resource:S.IMAGE_SOURCE}));break;default:i.ordinal="○"}n++}e.data(j.LIST,"mainData",i)}),{output:""}}},{key:"postBaseLayout",value:function(e){e.modifyBox(16,null),e.modifyBox(256,null)}}],[{key:"createDataAttribute",value:function(){return{ordinal:"",imageSrc:"",imagePosition:""}}}]),t}(),Relative:function(e){function t(){return r(this,t),u(this,l(t).apply(this,arguments))}return c(t,M),a(t,[{key:"condition",value:function(e){return e.positionRelative&&!e.positionStatic||0!==Ae.convertInt(e.cssInitial("verticalAlign"))}},{key:"processNode",value:function(){return{output:"",include:!0}}},{key:"postProcedure",value:function(e){var t=e.renderParent;if(t){var n=e,i=Ae.convertInt(e.verticalAlign);if(t.support.container.positionRelative&&0===e.length&&(0!==e.top||0!==e.bottom||0!==i)){n=e.clone(this.application.nextId,!0,!0),e.hide(!0);var r=new x(t,n,n.containerType,n.alignmentType);this.application.controllerHandler.appendAfter(e.id,this.application.renderLayout(r)),this.application.session.cache.append(n,!1)}0!==e.top?n.modifyBox(2,e.top):0!==e.bottom&&n.modifyBox(2,-1*e.bottom),0!==i&&n.modifyBox(2,-1*i),0!==e.left?n.autoMargin.left?n.modifyBox(4,-1*e.left):n.modifyBox(16,e.left):0!==e.right&&n.modifyBox(16,-1*e.right)}}}]),t}(),Sprite:function(e){function t(){return r(this,t),u(this,l(t).apply(this,arguments))}return c(t,M),a(t,[{key:"condition",value:function(e){var t=!1;if(e.hasWidth&&e.hasHeight&&0===e.length&&!e.inlineText){var n=e.css("backgroundImage");if(!Te.hasValue(n)||"none"===n){n="";var i=Te.REGEX_PATTERN.CSS_URL.exec(e.css("background"));i&&(n=i[0])}if(""!==n){n=we.cssResolveUrl(n);var r=this.application.session.image.get(n);if(r){var s=e.dpi,a=e.fontSize,h=we.convertClientUnit(e.has("width")?e.css("width"):e.css("minWidth"),e.bounds.width,s,a),c=we.convertClientUnit(e.has("height")?e.css("width"):e.css("minHeight"),e.bounds.height,s,a),l=we.getBackgroundPosition("".concat(e.css("backgroundPositionX")," ").concat(e.css("backgroundPositionY")),e.bounds,s,a);l.left<=0&&l.top<=0&&r.width>h&&r.height>c&&(r.position={x:l.left,y:l.top},e.data(j.SPRITE,"mainData",r),t=!0)}}}return t&&(!Te.hasValue(e.dataset.use)||this.included(e.element))}}]),t}(),Substitute:function(e){function t(e,n,i,s){var a;return r(this,t),(a=u(this,l(t).call(this,e,n,i,s))).require(j.EXTERNAL,!0),a}return c(t,M),a(t,[{key:"processNode",value:function(e,t){var n=this,i=Ee.getDataSet(e.element,this.name),r="";return i.tag&&(e.setControlType(i.tag),e.render(t),r=this.application.controllerHandler.renderNodeStatic(i.tag,e.renderDepth,{},"","",e,e.length>0)),i.tagChild&&e.each(function(e){e.styleElement&&(e.dataset.use=n.name,e.dataset.squaredSubstituteTag=i.tagChild)}),{output:r}}}]),t}(),Table:function(e){function t(){return r(this,t),u(this,l(t).apply(this,arguments))}return c(t,M),a(t,[{key:"processNode",value:function(e){function n(t){t.data(j.TABLE,"percent","".concat(Math.round(t.bounds.width/e.bounds.width*100),"%")),t.data(j.TABLE,"expand",!0)}function i(e){e.css("width",Re.formatPX(e.bounds.width),!0)}var r=t.createDataAttribute(),s=[],a=e.filter(function(e){return"THEAD"===e.tagName}),h=e.filter(function(e){return"TBODY"===e.tagName}),c=e.filter(function(e){return"TFOOT"===e.tagName}),l=Array.from(e.element.children).find(function(e){return"COLGROUP"===e.tagName});a.length&&(a[0].cascade().filter(function(e){return"TH"===e.tagName||"TD"===e.tagName}).forEach(function(e){return e.inherit(a[0],"styleMap")}),s.push.apply(s,v(a[0].children)),a.forEach(function(e){return e.hide()})),h.length&&h.forEach(function(e){s.push.apply(s,v(e.children)),e.hide()}),c.length&&(c[0].cascade().filter(function(e){return"TH"===e.tagName||"TD"===e.tagName}).forEach(function(e){return e.inherit(c[0],"styleMap")}),s.push.apply(s,v(c[0].children)),c.forEach(function(e){return e.hide()}));var o="fixed"===e.css("tableLayout"),u="collapse"===e.css("borderCollapse"),f=d(u?[0,0]:e.css("borderSpacing").split(" ").map(function(e){return parseInt(e)}),2),g=f[0],p=f[1];g>0?(e.modifyBox(256,g),e.modifyBox(64,g)):(e.modifyBox(256,null),e.modifyBox(64,null)),p>0?(e.modifyBox(32,p),e.modifyBox(128,p)):(e.modifyBox(32,null),e.modifyBox(128,null));for(var y=Re.formatPX(g>1?Math.round(g/2):g),k=Re.formatPX(p>1?Math.round(p/2):p),b=[],S=[],A=[],w=Array(s.length).fill(0),T=[],E=0,B=0;B<s.length;B++){var R=s[B];b[B]=g,A[B]=[];for(var x=0;x<R.length;x++){for(var I=R.item(x),C=I.element,L=0;L<C.rowSpan-1;L++){var H=B+1+L;void 0!==w[H]&&(w[H]+=C.colSpan)}if(!I.visibleStyle.backgroundImage&&!I.visibleStyle.backgroundColor)if(l){var P=Be.getStyle(l.children[w[B]]);P.background?C.style.background=P.background:P.backgroundColor&&(C.style.backgroundColor=P.backgroundColor)}else{var O=Be.cssInherit(C,"background",["rgba(0, 0, 0, 0)","transparent"],["TABLE"]);""!==O?C.style.background=O:""!==(O=Be.cssInherit(C,"backgroundColor",["rgba(0, 0, 0, 0)","transparent"],["TABLE"]))&&(C.style.backgroundColor=O)}switch(I.tagName){case"TH":I.cssInitial("textAlign")||I.css("textAlign","center");case"TD":I.cssInitial("verticalAlign")||I.css("verticalAlign","middle")}var D=I.cssInitial("width"),V=w[B],q=void 0===T[V]||"auto"===T[V];if(0===B||q||!o)if(""===D||"auto"===D)void 0===T[V]?(T[V]=D||"0px",S[V]=0):B===s.length-1&&q&&0===S[V]&&(S[V]=I.bounds.width);else{var W=Re.isUnit(T[V]),F=Re.isPercent(D);(q||I.bounds.width<S[V]||I.bounds.width===S[V]&&(W||F||W&&F||F&&Re.isPercent(T[V])&&Re.convertFloat(D)>Re.convertFloat(T[V])||W&&Re.isUnit(D)&&Re.convertInt(D)>Re.convertInt(T[V])))&&(T[V]=D),(q||1===C.colSpan)&&(S[V]=I.bounds.width)}0===E&&(E=I.multiLine),(I.length||I.inlineText)&&(b[B]+=I.bounds.width+g),I.css({marginTop:0===B?"0px":k,marginRight:x<R.length-1?y:"0px",marginBottom:B+C.rowSpan-1>=s.length-1?"0px":k,marginLeft:0===w[B]?"0px":y},"",!0),w[B]+=C.colSpan}}if(e.has("width",2)&&T.some(function(e){return Re.isPercent(e)})&&(T=T.map(function(e,t){return"auto"===e&&S[t]>0&&(e=Re.formatPX(S[t])),e})),T.every(function(e){return Re.isPercent(e)})&&T.reduce(function(e,t){return e+parseFloat(t)},0)>1){var G=100;T=T.map(function(e){var t=parseFloat(e);return G<=0?e="0px":G-t<0&&(e=Re.formatPercent(G)),G-=t,e})}else if(T.every(function(e){return Re.isUnit(e)})){var N=T.reduce(function(e,t){return e+parseInt(t)},0);N<e.width?T=T.map(function(e){return"0px"!==e?"".concat(parseInt(e)/N*100,"%"):e}):N>e.width&&(e.css("width","auto",!0),o||e.cascade().forEach(function(e){return e.css("width","auto",!0)}))}var U=T.reduce(function(e,t){return e+(Re.isPercent(t)?parseFloat(t):0)},0);r.layoutType=function(){if(T.some(function(e){return Re.isPercent(e)})||T.every(function(e){return Re.isUnit(e)&&"0px"!==e}))return 3;if(T.every(function(e){return e===T[0]})){if(E)return e.some(function(e){return e.has("height")})?2:3;if("auto"===T[0])return e.has("width")?3:0;if(e.hasWidth)return 2}return T.every(function(e){return"auto"===e||Re.isUnit(e)&&"0px"!==e})?1:0}(),(E||1===r.layoutType&&!e.hasWidth)&&(r.expand=!0);var Y=Re.maxArray(w),z=s.length,M=e.find(function(e){return"CAPTION"===e.tagName});e.clear(),M&&(M.hasWidth||Be.isUserAgent(8)||(M.textElement?M.has("maxWidth")||M.css("maxWidth",Re.formatPX(M.bounds.width)):M.bounds.width>Re.maxArray(b)&&i(M)),M.cssInitial("textAlign")||M.css("textAlign","center"),z++,M.data(j.TABLE,"colSpan",Y),M.parent=e),w=Array(s.length).fill(0);for(var Q=e.hasWidth,X=0;X<s.length;X++){for(var Z=s[X],K=Z.duplicate(),J=0;J<K.length;J++){for(var $=K[J],m=$.element,_=m.rowSpan,ee=m.colSpan,te=0;te<_-1;te++){var ne=X+1+te;void 0!==w[ne]&&(w[ne]+=ee)}_>1&&$.data(j.TABLE,"rowSpan",_),ee>1&&$.data(j.TABLE,"colSpan",ee),$.has("verticalAlign")||$.css("verticalAlign","middle");var ie=T[w[X]];if("undefined"!==ie)switch(r.layoutType){case 3:"auto"===ie?U>=1?(i($),$.data(j.TABLE,"exceed",!Q),$.data(j.TABLE,"downsized",!0)):n($):Re.isPercent(ie)?($.data(j.TABLE,"percent",ie),$.data(j.TABLE,"expand",!0)):Re.isUnit(ie)&&parseInt(ie)>0?$.bounds.width>=parseInt(ie)?(i($),$.data(j.TABLE,"expand",!1),$.data(j.TABLE,"downsized",!1)):o?(n($),$.data(j.TABLE,"downsized",!0)):(i($),$.data(j.TABLE,"expand",!1)):($.has("width")&&!$.has("width",32)||i($),$.data(j.TABLE,"expand",!1));break;case 2:$.css("width","0px");break;case 1:"auto"===ie?$.css("width","0px"):(o?$.data(j.TABLE,"downsized",!0):i($),$.data(j.TABLE,"expand",!1))}w[X]+=ee;for(var re=0;re<_;re++)for(var se=0;se<ee;se++)A[X+re].push($);$.parent=e}if(w[X]<Y)K[K.length-1].data(j.TABLE,"spaceSpan",Y-w[X]);Z.hide()}if(u){for(var ae=e.css("borderTopColor"),he=e.css("borderTopStyle"),ce=e.css("borderTopWidth"),le=e.css("borderRightColor"),oe=e.css("borderRightStyle"),ue=e.css("borderRightWidth"),fe=e.css("borderBottomColor"),ge=e.css("borderBottomStyle"),de=e.css("borderBottomWidth"),ve=e.css("borderLeftColor"),pe=e.css("borderLeftStyle"),ye=e.css("borderLeftWidth"),ke=0;ke<z;ke++)for(var be=0;be<Y;be++){var Se=A[ke][be];if(Se&&"visible"===Se.css("visibility")){if(0===ke&&Se.borderTopWidth<parseInt(ce)&&Se.css({borderTopColor:ae,borderTopStyle:he,borderTopWidth:ce}),ke>=0&&ke<z-1){var Ae=A[ke+1][be];Ae&&Ae!==Se&&"visible"===Ae.css("visibility")&&(Se.borderBottomWidth>=Ae.borderTopWidth?Ae.css("borderTopWidth","0px"):Se.css("borderBottomWidth","0px"))}if(ke===z-1&&Se.borderBottomWidth<parseInt(de)&&Se.css({borderBottomColor:fe,borderBottomStyle:ge,borderBottomWidth:de}),0===be&&Se.borderLeftWidth<parseInt(ye)&&Se.css({borderLeftColor:ve,borderLeftStyle:pe,borderLeftWidth:ye}),be>=0&&be<Y-1){var we=A[ke][be+1];we&&we!==Se&&"visible"===we.css("visibility")&&(Se.borderRightWidth>=we.borderLeftWidth?we.css("borderLeftWidth","0px"):Se.css("borderRightWidth","0px"))}be===Y-1&&Se.borderRightWidth<parseInt(ue)&&Se.css({borderRightColor:le,borderRightStyle:oe,borderRightWidth:ue})}}e.css({borderTopWidth:"0px",borderRightWidth:"0px",borderBottomWidth:"0px",borderLeftWidth:"0px"})}return r.rowCount=z,r.columnCount=Y,e.data(j.TABLE,"mainData",r),{output:""}}}],[{key:"createDataAttribute",value:function(){return{layoutType:0,rowCount:0,columnCount:0,expand:!1}}}]),t}(),VerticalAlign:function(e){function t(){return r(this,t),u(this,l(t).apply(this,arguments))}return c(t,M),a(t,[{key:"condition",value:function(e){var t=e.filter(function(e){return e.inlineVertical});return t.length>1&&t.some(function(e){return 0!==xe.convertInt(e.verticalAlign)})&&B.linearX(e.children)}},{key:"processNode",value:function(e){var t=[],n=[],i=Number.MAX_VALUE;return e.each(function(e){e.inlineVertical&&e.linear.top<=i&&(e.linear.top<i&&(n.length=0),n.push(e),i=e.linear.top)}),e.every(function(e){return e.positionStatic||e.positionRelative&&e.length>0})?n.length!==e.length&&e.each(function(e){var i=!1;n.includes(e)?i=!0:e.inlineVertical&&!e.baseline&&xe.isUnit(e.verticalAlign)&&(e.modifyBox(2,e.linear.top-n[0].linear.top),t.push(e),i=!0),i&&e.css("verticalAlign","0px",!0)}):n=n.filter(function(e){return xe.isUnit(e.verticalAlign)&&xe.convertInt(e.verticalAlign)>0}),n.length&&e.data(j.VERTICAL_ALIGN,"mainData",{aboveBaseline:n,belowBaseline:t}),{output:""}}},{key:"postProcedure",value:function(e){var t=e.data(j.VERTICAL_ALIGN,"mainData");if(t){var n=e.find(function(e){return e.baselineActive});n?n.modifyBox(2,n.linear.top-t.aboveBaseline[0].linear.top):[].concat(v(t.belowBaseline),v(t.aboveBaseline)).some(function(e){var t=xe.convertInt(e.cssInitial("verticalAlign"));return t>0&&(e.modifyBox(8,t),!0)})}}}]),t}(),WhiteSpace:function(e){function t(){return r(this,t),u(this,l(t).apply(this,arguments))}return c(t,M),a(t,[{key:"afterBaseLayout",value:function(){for(var e=new Set,t=Array.isArray(i=this.application.processing.cache),n=0,i=t?i:i[Symbol.iterator]();;){var r;if(t){if(n>=i.length)break;r=i[n++]}else{if((n=i.next()).done)break;r=n.value}var s=r;if(s.htmlElement&&s.blockStatic){for(var a=void 0,h=void 0,c=0;c<s.element.children.length;c++){var l=Ie.getElementAsNode(s.element.children[c]);if(l&&l.pageFlow&&(void 0===a&&(a=l),h=l,!l.lineBreak&&l.blockStatic)){var o=l.previousSiblings();if(o.length){var u=o[0];if(u.blockStatic&&!u.lineBreak){u=u.renderAs||u;var f=Ce.convertInt((l=l.renderAs||l).cssInitial("marginTop",!1,!0)),g=Ce.convertInt(l.cssInitial("marginBottom",!1,!0)),d=Ce.convertInt(u.cssInitial("marginTop",!1,!0)),v=Ce.convertInt(u.cssInitial("marginBottom",!1,!0));if(u.excluded&&!l.excluded){var p=Math.min(d,v);p<0&&(l.modifyBox(2,Math.abs(p)>=f?null:p),e.add(u))}else if(!u.excluded&&l.excluded){var y=Math.min(f,g);y<0&&(u.modifyBox(8,Math.abs(y)>=v?null:y),e.add(l))}else{if(0===f&&l.length>0){var k=l.firstChild;k&&k.blockStatic&&(f=Ce.convertInt(k.cssInitial("marginTop",!1,!0)),l=k)}if(0===v&&u.length>0){var b=u.lastChild;b&&b.blockStatic&&(v=Ce.convertInt(b.cssInitial("marginBottom",!1,!0)),u=b)}v>0&&f>0&&(f<=v?l.modifyBox(2,null):u.modifyBox(8,null))}}}}}a&&He(s,a,!0),h&&He(s,h,!1)}}this.application.processing.node&&Ce.flatMap(Array.from(this.application.processing.node.element.getElementsByTagName("BR")),function(e){return Ie.getElementAsNode(e)}).forEach(function(t){if(!e.has(t)){var n=t.actualParent,i=t.previousSiblings(!0,!0,!0),r=t.nextSiblings(!0,!0,!0),s=!1;if(i.length&&r.length){if(r[0].lineBreak)return;s=!0;var a,h,c=i.pop(),l=r.pop();if(c.inlineStatic&&l.inlineStatic&&0===i.length)return void e.add(t);c.lineHeight>0&&c.cssTry("lineHeight","0px")?(a=c.element.getBoundingClientRect().bottom+c.marginBottom,c.cssFinally("lineHeight")):a=c.linear.bottom,l.lineHeight>0&&l.cssTry("lineHeight","0px")?(h=l.element.getBoundingClientRect().top-l.marginTop,l.cssFinally("lineHeight")):h=l.linear.top;var o=c.visible?c.renderParent:void 0,u=l.visible?l.renderParent:void 0,f=h-a;f>0&&(u&&u.groupParent&&u.firstChild===l?u.modifyBox(2,f):o&&o.groupParent&&o.lastChild===c?o.modifyBox(8,f):u&&u.layoutVertical&&(l.visible||l.renderAs)?(l.renderAs||l).modifyBox(2,f):o&&o.layoutVertical&&(c.visible||c.renderAs)?(c.renderAs||c).modifyBox(8,f):!u&&!o&&n&&n.visible?l.lineBreak||l.excluded?n.modifyBox(128,f):c.lineBreak||c.excluded?n.modifyBox(32,f):s=!1:s=!1)}else if(n&&n.visible){if(!n.documentRoot&&i.length){var g=i[i.length-1],d=n.box.bottom-g.linear[g.lineBreak||g.excluded?"top":"bottom"];d>0&&(g.visible?n.modifyBox(128,d):n.hasHeight||Le(n,d))}else if(r.length){var v=r[r.length-1],p=v.linear[v.lineBreak||v.excluded?"bottom":"top"]-n.box.top;p>0&&(v.visible?n.modifyBox(32,p):n.hasHeight||Le(n,p))}s=!0}s&&(e.add(t),i.forEach(function(t){return e.add(t)}),r.forEach(function(t){return e.add(t)}))}});for(var S=Array.isArray(w=this.application.processing.excluded),A=0,w=S?w:w[Symbol.iterator]();;){var T;if(S){if(A>=w.length)break;T=w[A++]}else{if((A=w.next()).done)break;T=A.value}var E=T;if(!e.has(E)&&!E.lineBreak){var B=E.marginTop+E.marginBottom;if(0!==B){var R=E.nextSiblings(!0,!0,!0);if(R.length){var x=R.pop();x.visible&&(x.modifyBox(2,B),e.add(E))}}}}}},{key:"afterConstraints",value:function(){for(var e=Array.isArray(n=this.application.processing.cache),t=0,n=e?n:n[Symbol.iterator]();;){var i;if(e){if(t>=n.length)break;i=n[t++]}else{if((t=n.next()).done)break;i=t.value}var r=i,s=r.renderAs?r.renderAs.renderParent:r.renderParent;if(s&&r.pageFlow&&!s.hasAlign(4)&&!r.alignParent("left")&&r.styleElement&&r.inlineVertical)for(var a=[],h=r;;){if(a.push.apply(a,v(h.previousSiblings())),a.length&&!a.some(function(e){return e.lineBreak||e.excluded&&e.blockStatic})){var c=a[a.length-1];if(c.inlineVertical){var l=r.linear.left-a[a.length-1].actualRight();l>0&&(r.renderAs||r).modifyBox(16,l)}else if(c.floating){a.length=0,h=c;continue}}break}}}}]),t}()},Oe={constant:$,enumeration:w};e.Application=F,e.Controller=U,e.Extension=M,e.ExtensionManager=X,e.File=K,e.Layout=x,e.Node=ee,e.NodeGroup=ne,e.NodeList=B,e.Resource=P,e.extensions=Pe,e.lib=Oe,Object.defineProperty(e,"__esModule",{value:!0})});
