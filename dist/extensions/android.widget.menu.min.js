this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.menu=function(){"use strict";var e=squared.base.lib.constant,t=squared.base.lib.enumeration,a=squared.lib.dom,n=squared.lib.util,r=android.base.Resource,i=android.lib.constant,o=android.lib.enumeration,l=android.lib.util;const s={MENU:"menu",ITEM:"item",GROUP:"group"},d={id:/^@\+id\/\w+$/,title:/^.+$/,titleCondensed:/^.+$/,icon:/^@drawable\/.+$/,onClick:/^.+$/,showAsAction:/^(ifRoom|never|withText|always|collapseActionView)$/,actionLayout:/^@layout\/.+$/,actionViewClass:/^.+$/,actionProviderClass:/^.+$/,alphabeticShortcut:/^[a-zA-Z]+$/,alphabeticModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,numericShortcut:/^[0-9]+$/,numericModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,checkable:/^(true|false)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^[0-9]+$/},c={id:/^@\+id\/\w+$/,checkableBehavior:/^(none|all|single)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^[0-9]+$/},u=["showAsAction","actionViewClass","actionProviderClass"];function m(e,t){return e.some(e=>e.element.type===t)}function h(e,t,a){for(const n in t.dataset){const r=t.dataset[n];if(r&&e[n]){const t=r.match(e[n]);t&&(a[u.includes(n)?"app":"android"][n]=Array.from(new Set(t)).join("|"))}}}function E(e){if(""!==e.title)return e.title;for(const t of n.flatMap(Array.from(e.childNodes),e=>a.getElementAsNode(e)))if(t.textElement)return t.textContent.trim();return""}const N=new class extends squared.base.Extension{constructor(t,a,n,r){super(t,a,n,r),this.require(e.EXT_NAME.EXTERNAL,!0)}init(e){if(this.included(e)){let t=!1;if(e.children.length){const a=e.children[0].tagName;t=Array.from(e.children).every(e=>e.tagName===a);let n=e.parentElement;for(;n;){if("NAV"===n.tagName&&this.application.parseElements.has(n)){t=!1;break}n=n.parentElement}}t&&(Array.from(e.querySelectorAll("NAV")).forEach(t=>{"none"===a.getStyle(e).display&&(a.setElementCache(t,"squaredExternalDisplay","none"),t.style.display="block")}),this.application.parseElements.add(e))}return!1}condition(e){return this.included(e.element)}processNode(e){e.documentRoot=!0,e.alignmentType|=4,e.setControlType(s.MENU,o.CONTAINER_NODE.INLINE),e.exclude({procedure:t.NODE_PROCEDURE.ALL,resource:t.NODE_RESOURCE.ALL});const a=this.application.controllerHandler.renderNodeStatic(s.MENU,0,{},"","",e,!0);return e.cascade().forEach(e=>this.subscribersChild.add(e)),{output:a,complete:!0}}processChild(e,u){if(e.plainText)return e.hide(),{output:"",next:!0};const N=l.createAttribute(),p=e.element;let y,g="",b=!1;switch("NAV"===e.tagName?(y=s.MENU,g=E(p),b=!0):e.some(e=>e.length>0)?(e.some(e=>"NAV"===e.tagName)?(y=s.ITEM,e.each(e=>"NAV"!==e.tagName&&e.hide())):(y=s.GROUP,e.every(e=>m(e,"radio"))?N.android.checkableBehavior="single":e.every(e=>m(e,"checkbox"))&&(N.android.checkableBehavior="all")),g=E(p),b=!0):(y=s.ITEM,g=(p.title||p.innerText).trim(),m(e,"checkbox")&&!u.android("checkableBehavior")&&(N.android.checkable="true")),y){case s.MENU:e.alignmentType|=4;break;case s.GROUP:e.alignmentType|=4,h(c,p,N);break;case s.ITEM:if(h(d,p,N),!n.hasValue(N.android.icon)){const t=a.getStyle(p);let n=r.addImageUrl("none"!==t.backgroundImage?t.backgroundImage:t.background,i.PREFIX_ANDROID.MENU);if(""!==n)N.android.icon=`@drawable/${n}`;else{const t=e.find(e=>e.imageElement);t&&""!==(n=r.addImageSrcSet(t.element,i.PREFIX_ANDROID.MENU))&&(N.android.icon=`@drawable/${n}`)}}}if(""!==g){const e=r.addString(g,"",this.application.extensionManager.optionValueAsBoolean(i.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue"));N.android.title=""!==e?`@string/${e}`:g}return e.setControlType(y,o.CONTAINER_NODE.INLINE),e.exclude({procedure:t.NODE_PROCEDURE.ALL,resource:t.NODE_RESOURCE.ALL}),e.render(u),{output:this.application.controllerHandler.renderNodeStatic(y,e.renderDepth,N,"","",e,b),complete:!0,next:y===s.MENU}}postBaseLayout(e){const t=e.element;if(this.included(t)){Array.from(t.querySelectorAll("NAV")).forEach(e=>{const t=a.getElementCache(e,"squaredExternalDisplay");t&&(e.style.display=t,a.deleteElementCache(e,"squaredExternalDisplay"))});const n=this.application.processing;e===n.node&&n.layout&&(n.layout.pathname="res/menu")}}}("android.widget.menu",2,["NAV"]);return squared&&squared.includeAsync(N),N}();
