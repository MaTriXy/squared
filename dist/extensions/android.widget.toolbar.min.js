this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";var e=android.base.Resource;const t=squared.base.lib.constant,a=squared.base.lib.enumeration,r=squared.lib.dom,n=squared.lib.util,l=squared.lib.xml,o=android.lib.constant,d=android.lib.enumeration,i=android.lib.util;class s extends squared.base.Extension{constructor(e,t,a,r){super(e,t,a,r),this.require("android.widget.menu")}init(e){if(this.included(e)&&(Array.from(e.children).some(e=>"NAV"===e.tagName&&!n.includes(e.dataset.use,t.EXT_NAME.EXTERNAL)&&(e.dataset.use=(n.hasValue(e.dataset.use)?`${e.dataset.use}, `:"")+t.EXT_NAME.EXTERNAL,!0)),e.dataset.target)){const t=document.getElementById(e.dataset.target);t&&e.parentElement!==t&&!n.includes(t.dataset.use,"android.widget.coordinator")&&this.application.parseElements.add(e)}return!1}processNode(t,u){const p=this.application,c=p.controllerHandler,h=t.element,m=n.hasValue(t.dataset.target),N=Object.assign({},this.options[h.id]),O=i.createViewAttribute(N.self),g=i.createViewAttribute(N.appBar),A=i.createViewAttribute(N.collapsingToolbar),f=s.findNestedByName(h,"android.widget.menu"),b=t.has("backgroundImage"),E=[],y=[];let I=m?0:u.renderDepth+1,R=t.filter(e=>!e.positioned).length;for(let t=0;t<h.children.length;t++){const a=h.children[t];if("IMG"===a.tagName){if(n.hasValue(a.dataset.navigationIcon)){const t=e.addImageSrcSet(a,o.PREFIX_ANDROID.MENU);""!==t&&(n.defaultWhenNull(toolbar,"app","navigationIcon",`@drawable/${t}`),"none"!==r.getStyle(a).display&&R--)}if(n.hasValue(a.dataset.collapseIcon)){const t=e.addImageSrcSet(a,o.PREFIX_ANDROID.MENU);""!==t&&(n.defaultWhenNull(toolbar,"app","collapseIcon",`@drawable/${t}`),"none"!==r.getStyle(a).display&&R--)}}if(n.hasValue(a.dataset.target))R--;else{const e=r.getElementAsNode(a);if(e)switch(a.dataset.targetModule){case"appBar":E.push(e),R--;break;case"collapsingToolbar":y.push(e),R--}}}const T=N.hasOwnProperty("collapsingToolbar")||y.length,_=N.hasOwnProperty("appBar")||E.length||T;let S="",w="";T?n.defaultWhenNull(O,"app","layout_collapseMode","pin"):(_||n.defaultWhenNull(O,"android","fitsSystemWindows","true"),n.defaultWhenNull(O,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),b?(n.defaultWhenNull(E.length?g:O,"android","background",`@drawable/${e.addImageUrl(t.css("backgroundImage"))}`),t.exclude({resource:a.NODE_RESOURCE.IMAGE_SOURCE})):n.defaultWhenNull(O,"app","layout_scrollFlags","scroll|enterAlways")),E.length?n.defaultWhenNull(g,"android","layout_height","?android:attr/actionBarSize"):(n.defaultWhenNull(O,"android","layout_height","?android:attr/actionBarSize"),t.exclude({procedure:a.NODE_PROCEDURE.LAYOUT})),f&&_&&(O.app.popupTheme&&(w=O.app.popupTheme.replace("@style/","")),O.app.popupTheme="@style/AppTheme.PopupOverlay");const D=I+(_?1:0)+(T?1:0),P=p.extensionManager.optionValueAsBoolean(o.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue");t.setControlType(o.SUPPORT_ANDROID.TOOLBAR,d.CONTAINER_NODE.BLOCK);let W=c.renderNodeStatic(o.SUPPORT_ANDROID.TOOLBAR,D,e.formatOptions(O,P),"match_parent","wrap_content",t,R>0);if(T&&b){const r=i.createViewAttribute(N.backgroundImage);let l="center";switch(t.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":l="centerCrop";break;case"contain":case"100% 100%":l="fitXY";break;case"auto":l="matrix"}n.defaultWhenNull(r,"android","id",`${t.documentId}_image`),n.defaultWhenNull(r,"android","src",`@drawable/${e.addImageUrl(t.css("backgroundImage"))}`),n.defaultWhenNull(r,"android","scaleType",l),n.defaultWhenNull(r,"android","fitsSystemWindows","true"),n.defaultWhenNull(r,"app","layout_collapseMode","parallax"),W=c.renderNodeStatic(o.CONTAINER_ANDROID.IMAGE,D,e.formatOptions(r,P),"match_parent","match_parent")+W,t.exclude({resource:a.NODE_RESOURCE.IMAGE_SOURCE})}let C,B,L="";if(_&&(n.defaultWhenNull(g,"android","id",`${t.documentId}_appbar`),n.defaultWhenNull(g,"android","layout_height",t.hasHeight?n.formatPX(t.height):"wrap_content"),n.defaultWhenNull(g,"android","fitsSystemWindows","true"),f?(g.android.theme&&(S=g.android.theme),g.android.theme="@style/AppTheme.AppBarOverlay",t.data("android.widget.toolbar","themeData",{target:m,appBarOverlay:S,popupOverlay:w})):n.defaultWhenNull(g,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(C=this.createPlaceholder(t,E)).parent=t.parent,C.controlId=i.stripId(g.android.id),C.setControlType(o.SUPPORT_ANDROID.APPBAR,d.CONTAINER_NODE.BLOCK),p.processing.cache.append(C,E.length>0),L=c.renderNodeStatic(o.SUPPORT_ANDROID.APPBAR,m?-1:I,e.formatOptions(g,P),"match_parent","wrap_content",C,!0),T&&(I++,n.defaultWhenNull(A,"android","id",`${t.documentId}_collapsingtoolbar`),n.defaultWhenNull(A,"android","fitsSystemWindows","true"),b||n.defaultWhenNull(A,"app","contentScrim","?attr/colorPrimary"),n.defaultWhenNull(A,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),n.defaultWhenNull(A,"app","toolbarId",t.documentId),(B=this.createPlaceholder(t,y)).parent=C,B))){B.each(e=>e.dataset.target=B.controlId),B.setControlType(o.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,d.CONTAINER_NODE.BLOCK),p.processing.cache.append(B,y.length>0);const t=c.renderNodeStatic(o.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,m&&!_?-1:I,e.formatOptions(A,P),"match_parent","match_parent",B,!0);L=l.replacePlaceholder(L,C.id,t)}return C?(W=l.replacePlaceholder(L,B?B.id:C.id,W),C.render(m?C:u),B?(B.parent=C,B.render(C),t.parent=B):t.parent=C,t.data("android.widget.toolbar","outerParent",C.documentId),t.render(t.parent)):B?(B.render(m?B:u),t.parent=B,t.render(B)):t.render(m?t:u),t.containerType=d.CONTAINER_NODE.BLOCK,t.exclude({resource:a.NODE_RESOURCE.FONT_STYLE}),{output:W}}processChild(e){let t=!1;return e.imageElement&&(n.hasValue(e.dataset.navigationIcon)||n.hasValue(e.dataset.collapseIcon))&&(e.hide(),t=!0),{output:"",next:t}}postProcedure(e){const t=n.optionalAsString(s.findNestedByName(e.element,"android.widget.menu"),"dataset.layoutName");if(""!==t){const a=i.createViewAttribute((e.element&&this.options[e.element.id]||{}).self);n.defaultWhenNull(a,"app","menu",`@menu/${t}`),e.app("menu",a.app.menu)}const a=e.data("android.widget.toolbar","themeData");a&&this.setStyleTheme(a)}setStyleTheme(t){const a=i.createStyleAttribute(Object.assign({},this.options.resource)),r=i.createStyleAttribute({name:".NoActionBar",output:a.output}),l=i.createStyleAttribute({name:".AppBarOverlay",output:a.output}),o=i.createStyleAttribute({name:".PopupOverlay",output:a.output});n.defaultWhenNull(a,"parent","Theme.AppCompat.Light.DarkActionBar"),n.defaultWhenNull(r.items,"windowActionBar","false"),n.defaultWhenNull(r.items,"windowNoTitle","true"),n.defaultWhenNull(l,"parent",t.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),n.defaultWhenNull(o,"parent",t.popupOverlay||"ThemeOverlay.AppCompat.Light"),e.addTheme(a,r,l,o)}createPlaceholder(e,t){const n=this.application.createNode(r.createElement(e.actualParent?e.actualParent.element:null,e.block));n.inherit(e,"base"),n.exclude({resource:a.NODE_RESOURCE.ALL}),n.positioned=!0;let l=Number.MAX_VALUE;return t.forEach(e=>{l=Math.min(l,e.siblingIndex),e.parent=n}),n.siblingIndex=l,n}}const u=new s("android.widget.toolbar",2);return squared&&squared.includeAsync(u),u}();
