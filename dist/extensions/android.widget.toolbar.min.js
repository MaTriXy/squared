this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";var e='<?xml version="1.0" encoding="utf-8"?>\n<resources>\n!1\n\t<style name="{&appTheme}" parent="{~parentTheme}">\n!items\n\t\t<item name="{&name}">{&value}</item>\n!items\n\t</style>\n!1\n\t<style name="{&appTheme}.NoActionBar">\n\t\t<item name="windowActionBar">false</item>\n\t\t<item name="windowNoTitle">true</item>\n\t</style>\n\t<style name="{&appTheme}.AppBarOverlay" parent="{~appBarOverlay}" />\n\t<style name="{&appTheme}.PopupOverlay" parent="{~popupOverlay}" />\n</resources>',a=squared.base.lib.constant,t=squared.base.lib.enumeration,n=squared.lib.dom,r=squared.lib.util,l=squared.lib.xml,o=android.base.Resource,d=android.base.View,i=android.lib.constant,s=android.lib.enumeration,p=android.lib.util;class u extends squared.base.Extension{constructor(e,a,t,n){super(e,a,t,n),this.require("android.widget.menu")}init(e){if(this.included(e)&&(Array.from(e.children).some(e=>"NAV"===e.tagName&&!r.includes(e.dataset.use,a.EXT_NAME.EXTERNAL)&&(e.dataset.use=(r.hasValue(e.dataset.use)?`${e.dataset.use}, `:"")+a.EXT_NAME.EXTERNAL,!0)),e.dataset.target)){const a=document.getElementById(e.dataset.target);a&&e.parentElement!==a&&!r.includes(a.dataset.use,"android.widget.coordinator")&&this.application.parseElements.add(e)}return!1}processNode(e,a){const d=this.application,c=d.controllerHandler,h=e.element,m=r.hasValue(e.dataset.target),N=Object.assign({},this.options[h.id]),O=p.createAttribute(N.self),g=p.createAttribute(N.appBar),A=p.createAttribute(N.collapsingToolbar),f=u.findNestedByName(h,"android.widget.menu"),T=e.has("backgroundImage"),y=[],E=[];let b=m?0:a.renderDepth+1,I=e.filter(e=>!e.positioned).length;Array.from(h.children).forEach(e=>{if("IMG"===e.tagName){if(r.hasValue(e.dataset.navigationIcon)){const a=o.addImageSrcSet(e,i.PREFIX_ANDROID.MENU);""!==a&&(r.defaultWhenNull(toolbar,"app","navigationIcon",`@drawable/${a}`),"none"!==n.getStyle(e).display&&I--)}if(r.hasValue(e.dataset.collapseIcon)){const a=o.addImageSrcSet(e,i.PREFIX_ANDROID.MENU);""!==a&&(r.defaultWhenNull(toolbar,"app","collapseIcon",`@drawable/${a}`),"none"!==n.getStyle(e).display&&I--)}}if(r.hasValue(e.dataset.target))I--;else{const a=n.getElementAsNode(e);if(a)switch(e.dataset.targetModule){case"appBar":y.push(a),I--;break;case"collapsingToolbar":E.push(a),I--}}});const R=N.hasOwnProperty("collapsingToolbar")||E.length,_=N.hasOwnProperty("appBar")||y.length||R;let S="",D="";R?r.defaultWhenNull(O,"app","layout_collapseMode","pin"):(_||r.defaultWhenNull(O,"android","fitsSystemWindows","true"),r.defaultWhenNull(O,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),T?(r.defaultWhenNull(y.length?g:O,"android","background",`@drawable/${o.addImageUrl(e.css("backgroundImage"))}`),e.exclude({resource:t.NODE_RESOURCE.IMAGE_SOURCE})):r.defaultWhenNull(O,"app","layout_scrollFlags","scroll|enterAlways")),y.length?r.defaultWhenNull(g,"android","layout_height","?android:attr/actionBarSize"):(r.defaultWhenNull(O,"android","layout_height","?android:attr/actionBarSize"),e.exclude({procedure:t.NODE_PROCEDURE.LAYOUT})),f&&_&&(O.app.popupTheme&&(D=O.app.popupTheme.replace("@style/","")),O.app.popupTheme="@style/AppTheme.PopupOverlay");const P=b+(_?1:0)+(R?1:0),w=d.extensionManager.optionValueAsBoolean(i.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue");e.setControlType(i.SUPPORT_ANDROID.TOOLBAR,s.CONTAINER_NODE.BLOCK);let W=c.renderNodeStatic(i.SUPPORT_ANDROID.TOOLBAR,P,o.formatOptions(O,w),"match_parent","wrap_content",e,I>0);if(R&&T){const a=p.createAttribute(N.backgroundImage);let n="center";switch(e.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":n="centerCrop";break;case"contain":case"100% 100%":n="fitXY";break;case"auto":n="matrix"}r.defaultWhenNull(a,"android","id",`${e.documentId}_image`),r.defaultWhenNull(a,"android","src",`@drawable/${o.addImageUrl(e.css("backgroundImage"))}`),r.defaultWhenNull(a,"android","scaleType",n),r.defaultWhenNull(a,"android","fitsSystemWindows","true"),r.defaultWhenNull(a,"app","layout_collapseMode","parallax"),W=c.renderNodeStatic(i.CONTAINER_ANDROID.IMAGE,P,o.formatOptions(a,w),"match_parent","match_parent")+W,e.exclude({resource:t.NODE_RESOURCE.IMAGE_SOURCE})}let B,C,v="";if(_&&(r.defaultWhenNull(g,"android","id",`${e.documentId}_appbar`),r.defaultWhenNull(g,"android","layout_height",e.hasHeight?r.formatPX(e.height):"wrap_content"),r.defaultWhenNull(g,"android","fitsSystemWindows","true"),f?(g.android.theme&&(S=g.android.theme),g.android.theme="@style/AppTheme.AppBarOverlay",e.data("android.widget.toolbar","themeData",{target:m,appBarOverlay:S,popupOverlay:D})):r.defaultWhenNull(g,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(B=this.createPlaceholder(d.nextId,e,y)).parent=e.parent,B.controlId=p.stripId(g.android.id),B.setControlType(i.SUPPORT_ANDROID.APPBAR,s.CONTAINER_NODE.BLOCK),d.processing.cache.append(B,y.length>0),v=c.renderNodeStatic(i.SUPPORT_ANDROID.APPBAR,m?-1:b,o.formatOptions(g,w),"match_parent","wrap_content",B,!0),R&&(b++,r.defaultWhenNull(A,"android","id",`${e.documentId}_collapsingtoolbar`),r.defaultWhenNull(A,"android","fitsSystemWindows","true"),T||r.defaultWhenNull(A,"app","contentScrim","?attr/colorPrimary"),r.defaultWhenNull(A,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),r.defaultWhenNull(A,"app","toolbarId",e.documentId),(C=this.createPlaceholder(d.nextId,e,E)).parent=B,C))){C.each(e=>e.dataset.target=C.controlId),C.setControlType(i.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,s.CONTAINER_NODE.BLOCK),d.processing.cache.append(C,E.length>0);const e=c.renderNodeStatic(i.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,m&&!_?-1:b,o.formatOptions(A,w),"match_parent","match_parent",C,!0);v=l.replacePlaceholder(v,B.id,e)}return B?(W=l.replacePlaceholder(v,C?C.id:B.id,W),B.render(m?B:a),C?(C.parent=B,C.render(B),e.parent=C):e.parent=B,e.data("android.widget.toolbar","outerParent",B.documentId),e.render(e.parent)):C?(C.render(m?C:a),e.parent=C,e.render(C)):e.render(m?e:a),e.containerType=s.CONTAINER_NODE.BLOCK,e.exclude({resource:t.NODE_RESOURCE.FONT_STYLE}),{output:W}}processChild(e){let a=!1;return e.imageElement&&(r.hasValue(e.dataset.navigationIcon)||r.hasValue(e.dataset.collapseIcon))&&(e.hide(),a=!0),{output:"",next:a}}postProcedure(e){const a=r.optionalAsString(u.findNestedByName(e.element,"android.widget.menu"),"dataset.layoutName");if(""!==a){const t=p.createAttribute((e.element&&this.options[e.element.id]||{}).self);r.defaultWhenNull(t,"app","menu",`@menu/${a}`),e.app("menu",t.app.menu)}const t=e.data("android.widget.toolbar","themeData");t&&this.setStyleTheme(t)}setStyleTheme(a){if(this.application.resourceHandler.fileHandler){const t=Object.assign({},this.options.resource);r.defaultWhenNull(t,"appTheme",p.getAppTheme(this.application.resourceHandler.fileHandler.assets)||"AppTheme"),r.defaultWhenNull(t,"parentTheme","Theme.AppCompat.Light.DarkActionBar");const n={appTheme:t.appTheme,appBarOverlay:a.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar",popupOverlay:a.popupOverlay||"ThemeOverlay.AppCompat.Light",1:[{appTheme:t.appTheme,parentTheme:t.parentTheme,items:[]}]};a.target?n[1]=[]:n.items=n[1][0].items,r.defaultWhenNull(t,"output","path","res/values"),r.defaultWhenNull(t,"output","file","android.widget.toolbar.xml"),this.application.resourceHandler.addStyleTheme(e,n,t)}}createPlaceholder(e,a,r){const l=new d(e,n.createElement(a.actualParent?a.actualParent.element:null,a.block),this.application.controllerHandler.afterInsertNode);l.inherit(a,"base"),l.exclude({resource:t.NODE_RESOURCE.ALL}),l.positioned=!0;let o=Number.MAX_VALUE;return r.forEach(e=>{o=Math.min(o,e.siblingIndex),e.parent=l}),l.siblingIndex=o,l}}const c=new u("android.widget.toolbar",2);return squared&&squared.includeAsync(c),c}();
