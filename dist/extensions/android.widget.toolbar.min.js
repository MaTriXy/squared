this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";var e=android.base.Resource,t=android.base.View;const a=squared.base.lib.constant,r=squared.base.lib.enumeration,n=squared.lib.dom,l=squared.lib.util,o=squared.lib.xml,d=android.lib.constant,i=android.lib.enumeration,s=android.lib.util;class u extends squared.base.Extension{constructor(e,t,a,r){super(e,t,a,r),this.require("android.widget.menu")}init(e){if(this.included(e)&&(Array.from(e.children).some(e=>"NAV"===e.tagName&&!l.includes(e.dataset.use,a.EXT_NAME.EXTERNAL)&&(e.dataset.use=(l.hasValue(e.dataset.use)?`${e.dataset.use}, `:"")+a.EXT_NAME.EXTERNAL,!0)),e.dataset.target)){const t=document.getElementById(e.dataset.target);t&&e.parentElement!==t&&!l.includes(t.dataset.use,"android.widget.coordinator")&&this.application.parseElements.add(e)}return!1}processNode(t,a){const p=this.application,c=p.controllerHandler,h=t.element,m=l.hasValue(t.dataset.target),N=Object.assign({},this.options[h.id]),O=s.createViewAttribute(N.self),g=s.createViewAttribute(N.appBar),A=s.createViewAttribute(N.collapsingToolbar),f=u.findNestedByName(h,"android.widget.menu"),b=t.has("backgroundImage"),E=[],y=[];let I=m?0:a.renderDepth+1,R=t.filter(e=>!e.positioned).length;Array.from(h.children).forEach(t=>{if("IMG"===t.tagName){if(l.hasValue(t.dataset.navigationIcon)){const a=e.addImageSrcSet(t,d.PREFIX_ANDROID.MENU);""!==a&&(l.defaultWhenNull(toolbar,"app","navigationIcon",`@drawable/${a}`),"none"!==n.getStyle(t).display&&R--)}if(l.hasValue(t.dataset.collapseIcon)){const a=e.addImageSrcSet(t,d.PREFIX_ANDROID.MENU);""!==a&&(l.defaultWhenNull(toolbar,"app","collapseIcon",`@drawable/${a}`),"none"!==n.getStyle(t).display&&R--)}}if(l.hasValue(t.dataset.target))R--;else{const e=n.getElementAsNode(t);if(e)switch(t.dataset.targetModule){case"appBar":E.push(e),R--;break;case"collapsingToolbar":y.push(e),R--}}});const T=N.hasOwnProperty("collapsingToolbar")||y.length,_=N.hasOwnProperty("appBar")||E.length||T;let S="",w="";T?l.defaultWhenNull(O,"app","layout_collapseMode","pin"):(_||l.defaultWhenNull(O,"android","fitsSystemWindows","true"),l.defaultWhenNull(O,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),b?(l.defaultWhenNull(E.length?g:O,"android","background",`@drawable/${e.addImageUrl(t.css("backgroundImage"))}`),t.exclude({resource:r.NODE_RESOURCE.IMAGE_SOURCE})):l.defaultWhenNull(O,"app","layout_scrollFlags","scroll|enterAlways")),E.length?l.defaultWhenNull(g,"android","layout_height","?android:attr/actionBarSize"):(l.defaultWhenNull(O,"android","layout_height","?android:attr/actionBarSize"),t.exclude({procedure:r.NODE_PROCEDURE.LAYOUT})),f&&_&&(O.app.popupTheme&&(w=O.app.popupTheme.replace("@style/","")),O.app.popupTheme="@style/AppTheme.PopupOverlay");const D=I+(_?1:0)+(T?1:0),P=p.extensionManager.optionValueAsBoolean(d.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue");t.setControlType(d.SUPPORT_ANDROID.TOOLBAR,i.CONTAINER_NODE.BLOCK);let W=c.renderNodeStatic(d.SUPPORT_ANDROID.TOOLBAR,D,e.formatOptions(O,P),"match_parent","wrap_content",t,R>0);if(T&&b){const a=s.createViewAttribute(N.backgroundImage);let n="center";switch(t.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":n="centerCrop";break;case"contain":case"100% 100%":n="fitXY";break;case"auto":n="matrix"}l.defaultWhenNull(a,"android","id",`${t.documentId}_image`),l.defaultWhenNull(a,"android","src",`@drawable/${e.addImageUrl(t.css("backgroundImage"))}`),l.defaultWhenNull(a,"android","scaleType",n),l.defaultWhenNull(a,"android","fitsSystemWindows","true"),l.defaultWhenNull(a,"app","layout_collapseMode","parallax"),W=c.renderNodeStatic(d.CONTAINER_ANDROID.IMAGE,D,e.formatOptions(a,P),"match_parent","match_parent")+W,t.exclude({resource:r.NODE_RESOURCE.IMAGE_SOURCE})}let C,B,L="";if(_&&(l.defaultWhenNull(g,"android","id",`${t.documentId}_appbar`),l.defaultWhenNull(g,"android","layout_height",t.hasHeight?l.formatPX(t.height):"wrap_content"),l.defaultWhenNull(g,"android","fitsSystemWindows","true"),f?(g.android.theme&&(S=g.android.theme),g.android.theme="@style/AppTheme.AppBarOverlay",t.data("android.widget.toolbar","themeData",{target:m,appBarOverlay:S,popupOverlay:w})):l.defaultWhenNull(g,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(C=this.createPlaceholder(p.nextId,t,E)).parent=t.parent,C.controlId=s.stripId(g.android.id),C.setControlType(d.SUPPORT_ANDROID.APPBAR,i.CONTAINER_NODE.BLOCK),p.processing.cache.append(C,E.length>0),L=c.renderNodeStatic(d.SUPPORT_ANDROID.APPBAR,m?-1:I,e.formatOptions(g,P),"match_parent","wrap_content",C,!0),T&&(I++,l.defaultWhenNull(A,"android","id",`${t.documentId}_collapsingtoolbar`),l.defaultWhenNull(A,"android","fitsSystemWindows","true"),b||l.defaultWhenNull(A,"app","contentScrim","?attr/colorPrimary"),l.defaultWhenNull(A,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),l.defaultWhenNull(A,"app","toolbarId",t.documentId),(B=this.createPlaceholder(p.nextId,t,y)).parent=C,B))){B.each(e=>e.dataset.target=B.controlId),B.setControlType(d.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,i.CONTAINER_NODE.BLOCK),p.processing.cache.append(B,y.length>0);const t=c.renderNodeStatic(d.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,m&&!_?-1:I,e.formatOptions(A,P),"match_parent","match_parent",B,!0);L=o.replacePlaceholder(L,C.id,t)}return C?(W=o.replacePlaceholder(L,B?B.id:C.id,W),C.render(m?C:a),B?(B.parent=C,B.render(C),t.parent=B):t.parent=C,t.data("android.widget.toolbar","outerParent",C.documentId),t.render(t.parent)):B?(B.render(m?B:a),t.parent=B,t.render(B)):t.render(m?t:a),t.containerType=i.CONTAINER_NODE.BLOCK,t.exclude({resource:r.NODE_RESOURCE.FONT_STYLE}),{output:W}}processChild(e){let t=!1;return e.imageElement&&(l.hasValue(e.dataset.navigationIcon)||l.hasValue(e.dataset.collapseIcon))&&(e.hide(),t=!0),{output:"",next:t}}postProcedure(e){const t=l.optionalAsString(u.findNestedByName(e.element,"android.widget.menu"),"dataset.layoutName");if(""!==t){const a=s.createViewAttribute((e.element&&this.options[e.element.id]||{}).self);l.defaultWhenNull(a,"app","menu",`@menu/${t}`),e.app("menu",a.app.menu)}const a=e.data("android.widget.toolbar","themeData");a&&this.setStyleTheme(a)}setStyleTheme(t){const a=s.createStyleAttribute(Object.assign({},this.options.resource)),r=s.createStyleAttribute({name:".NoActionBar",output:a.output}),n=s.createStyleAttribute({name:".AppBarOverlay",output:a.output}),o=s.createStyleAttribute({name:".PopupOverlay",output:a.output});l.defaultWhenNull(a,"parent","Theme.AppCompat.Light.DarkActionBar"),l.defaultWhenNull(r.items,"windowActionBar","false"),l.defaultWhenNull(r.items,"windowNoTitle","true"),l.defaultWhenNull(n,"parent",t.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),l.defaultWhenNull(o,"parent",t.popupOverlay||"ThemeOverlay.AppCompat.Light"),e.addTheme(a,r,n,o)}createPlaceholder(e,a,l){const o=new t(e,n.createElement(a.actualParent?a.actualParent.element:null,a.block),this.application.controllerHandler.afterInsertNode);o.inherit(a,"base"),o.exclude({resource:r.NODE_RESOURCE.ALL}),o.positioned=!0;let d=Number.MAX_VALUE;return l.forEach(e=>{d=Math.min(d,e.siblingIndex),e.parent=o}),o.siblingIndex=d,o}}const p=new u("android.widget.toolbar",2);return squared&&squared.includeAsync(p),p}();
