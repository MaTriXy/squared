this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";var e='<?xml version="1.0" encoding="utf-8"?>\n<resources>\n!1\n\t<style name="{&appTheme}" parent="{~parentTheme}">\n!items\n\t\t<item name="{&name}">{&value}</item>\n!items\n\t</style>\n!1\n\t<style name="{&appTheme}.NoActionBar">\n\t\t<item name="windowActionBar">false</item>\n\t\t<item name="windowNoTitle">true</item>\n\t</style>\n\t<style name="{&appTheme}.AppBarOverlay" parent="{~appBarOverlay}" />\n\t<style name="{&appTheme}.PopupOverlay" parent="{~popupOverlay}" />\n</resources>',a=squared.base.lib.constant,t=squared.base.lib.enumeration,n=squared.lib.dom,r=squared.lib.util,l=squared.lib.xml,o=android.base.Resource,d=android.base.View,i=android.lib.constant,s=android.lib.enumeration,p=android.lib.util;class u extends squared.base.Extension{constructor(e,a,t,n){super(e,a,t,n),this.require("android.widget.menu")}init(e){if(this.included(e)&&(Array.from(e.children).some(e=>"NAV"===e.tagName&&!r.includes(e.dataset.use,a.EXT_NAME.EXTERNAL)&&(e.dataset.use=(r.hasValue(e.dataset.use)?`${e.dataset.use}, `:"")+a.EXT_NAME.EXTERNAL,!0)),e.dataset.target)){const a=document.getElementById(e.dataset.target);a&&e.parentElement!==a&&!r.includes(a.dataset.use,"android.widget.coordinator")&&this.application.parseElements.add(e)}return!1}processNode(e,a){const d=this.application,c=d.controllerHandler,h=r.hasValue(e.dataset.target),m=Object.assign({},this.options[e.element.id]),N=p.createAttribute(m.self),O=p.createAttribute(m.appBar),g=p.createAttribute(m.collapsingToolbar),A=u.findNestedByName(e.element,"android.widget.menu"),f=e.has("backgroundImage"),T=[],y=[];let E=h?0:a.renderDepth+1,b=e.filter(e=>!e.positioned).length;Array.from(e.element.children).forEach(e=>{if("IMG"===e.tagName){if(r.hasValue(e.dataset.navigationIcon)){const a=o.addImageSrcSet(e,i.PREFIX_ANDROID.MENU);""!==a&&(r.defaultWhenNull(toolbar,"app","navigationIcon",`@drawable/${a}`),"none"!==n.getStyle(e).display&&b--)}if(r.hasValue(e.dataset.collapseIcon)){const a=o.addImageSrcSet(e,i.PREFIX_ANDROID.MENU);""!==a&&(r.defaultWhenNull(toolbar,"app","collapseIcon",`@drawable/${a}`),"none"!==n.getStyle(e).display&&b--)}}if(r.hasValue(e.dataset.target))b--;else{const a=n.getElementAsNode(e);if(a)switch(e.dataset.targetModule){case"appBar":T.push(a),b--;break;case"collapsingToolbar":y.push(a),b--}}});const I=m.hasOwnProperty("collapsingToolbar")||y.length,R=m.hasOwnProperty("appBar")||T.length||I;let _="",S="";I?r.defaultWhenNull(N,"app","layout_collapseMode","pin"):(R||r.defaultWhenNull(N,"android","fitsSystemWindows","true"),r.defaultWhenNull(N,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),f?(r.defaultWhenNull(T.length?O:N,"android","background",`@drawable/${o.addImageUrl(e.css("backgroundImage"))}`),e.exclude({resource:t.NODE_RESOURCE.IMAGE_SOURCE})):r.defaultWhenNull(N,"app","layout_scrollFlags","scroll|enterAlways")),T.length?r.defaultWhenNull(O,"android","layout_height","?android:attr/actionBarSize"):(r.defaultWhenNull(N,"android","layout_height","?android:attr/actionBarSize"),e.exclude({procedure:t.NODE_PROCEDURE.LAYOUT})),A&&R&&(N.app.popupTheme&&(S=N.app.popupTheme.replace("@style/","")),N.app.popupTheme="@style/AppTheme.PopupOverlay");const D=E+(R?1:0)+(I?1:0),P=d.extensionManager.optionValueAsBoolean(i.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue");e.setControlType(i.SUPPORT_ANDROID.TOOLBAR,s.CONTAINER_NODE.BLOCK);let w=c.renderNodeStatic(i.SUPPORT_ANDROID.TOOLBAR,D,o.formatOptions(N,P),"match_parent","wrap_content",e,b>0);if(I&&f){const a=p.createAttribute(m.backgroundImage);let n="center";switch(e.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":n="centerCrop";break;case"contain":case"100% 100%":n="fitXY";break;case"auto":n="matrix"}r.defaultWhenNull(a,"android","id",`${e.documentId}_image`),r.defaultWhenNull(a,"android","src",`@drawable/${o.addImageUrl(e.css("backgroundImage"))}`),r.defaultWhenNull(a,"android","scaleType",n),r.defaultWhenNull(a,"android","fitsSystemWindows","true"),r.defaultWhenNull(a,"app","layout_collapseMode","parallax"),w=c.renderNodeStatic(i.CONTAINER_ANDROID.IMAGE,D,o.formatOptions(a,P),"match_parent","match_parent")+w,e.exclude({resource:t.NODE_RESOURCE.IMAGE_SOURCE})}let W,B,C="";if(R&&(r.defaultWhenNull(O,"android","id",`${e.documentId}_appbar`),r.defaultWhenNull(O,"android","layout_height",e.hasHeight?r.formatPX(e.height):"wrap_content"),r.defaultWhenNull(O,"android","fitsSystemWindows","true"),A?(O.android.theme&&(_=O.android.theme),O.android.theme="@style/AppTheme.AppBarOverlay",e.data("android.widget.toolbar","themeData",{target:h,appBarOverlay:_,popupOverlay:S})):r.defaultWhenNull(O,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(W=this.createPlaceholder(d.nextId,e,T)).parent=e.parent,W.controlId=p.stripId(O.android.id),W.setControlType(i.SUPPORT_ANDROID.APPBAR,s.CONTAINER_NODE.BLOCK),d.processing.cache.append(W,T.length>0),C=c.renderNodeStatic(i.SUPPORT_ANDROID.APPBAR,h?-1:E,o.formatOptions(O,P),"match_parent","wrap_content",W,!0),I&&(E++,r.defaultWhenNull(g,"android","id",`${e.documentId}_collapsingtoolbar`),r.defaultWhenNull(g,"android","fitsSystemWindows","true"),f||r.defaultWhenNull(g,"app","contentScrim","?attr/colorPrimary"),r.defaultWhenNull(g,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),r.defaultWhenNull(g,"app","toolbarId",e.documentId),(B=this.createPlaceholder(d.nextId,e,y)).parent=W,B))){B.each(e=>e.dataset.target=B.controlId),B.setControlType(i.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,s.CONTAINER_NODE.BLOCK),d.processing.cache.append(B,y.length>0);const e=c.renderNodeStatic(i.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,h&&!R?-1:E,o.formatOptions(g,P),"match_parent","match_parent",B,!0);C=l.replacePlaceholder(C,W.id,e)}return W?(w=l.replacePlaceholder(C,B?B.id:W.id,w),W.render(h?W:a),B?(B.parent=W,B.render(W),e.parent=B):e.parent=W,e.data("android.widget.toolbar","outerParent",W.documentId),e.render(e.parent)):B?(B.render(h?B:a),e.parent=B,e.render(B)):e.render(h?e:a),e.containerType=s.CONTAINER_NODE.BLOCK,e.exclude({resource:t.NODE_RESOURCE.FONT_STYLE}),{output:w}}processChild(e){let a=!1;return e.imageElement&&(r.hasValue(e.dataset.navigationIcon)||r.hasValue(e.dataset.collapseIcon))&&(e.hide(),a=!0),{output:"",next:a}}postProcedure(e){const a=r.optionalAsString(u.findNestedByName(e.element,"android.widget.menu"),"dataset.layoutName");if(""!==a){const t=Object.assign({},this.options[e.element.id]),n=p.createAttribute(t.self);r.defaultWhenNull(n,"app","menu",`@menu/${a}`),e.app("menu",n.app.menu)}const t=e.data("android.widget.toolbar","themeData");t&&this.setStyleTheme(t)}setStyleTheme(a){if(this.application.resourceHandler.fileHandler){const t=Object.assign({},this.options.resource);r.defaultWhenNull(t,"appTheme",p.getAppTheme(this.application.resourceHandler.fileHandler.assets)||"AppTheme"),r.defaultWhenNull(t,"parentTheme","Theme.AppCompat.Light.DarkActionBar");const n={appTheme:t.appTheme,appBarOverlay:a.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar",popupOverlay:a.popupOverlay||"ThemeOverlay.AppCompat.Light",1:[{appTheme:t.appTheme,parentTheme:t.parentTheme,items:[]}]};a.target?n[1]=!1:n.items=n[1][0].items,r.defaultWhenNull(t,"output","path","res/values"),r.defaultWhenNull(t,"output","file","android.widget.toolbar.xml"),this.application.resourceHandler.addStyleTheme(e,n,t)}}createPlaceholder(e,a,r){const l=new d(e,n.createElement(a.actualParent?a.actualParent.baseElement:null,a.block),this.application.controllerHandler.afterInsertNode);l.inherit(a,"base"),l.exclude({resource:t.NODE_RESOURCE.ALL}),l.positioned=!0;let o=Number.MAX_VALUE;return r.forEach(e=>{o=Math.min(o,e.siblingIndex),e.parent=l}),l.siblingIndex=o,l}}const c=new u("android.widget.toolbar",2);return squared&&squared.includeAsync(c),c}();
